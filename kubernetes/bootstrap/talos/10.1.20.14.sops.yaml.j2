version: v1alpha1
debug: false
persist: true
machine:
  type: worker
  token: ENC[AES256_GCM,data:IPbuuYyOlK5m50qTzcUu7MrjfH2WwSw=,iv:tbw4pvnVymNXWU79gxasfGNFGV+MhqyXCE1BYCggmBo=,tag:0eOMGc2m2Cfd/pKsOQI+Kw==,type:str]
  ca:
    crt: ENC[AES256_GCM,data:oF3mREsF/VQKbF922keyibgz8ML95/EO35KQDEwaz+Pgn0Y6JpGgGMlyqxjRuhM6MuBGdq+WI8DB/klFa+JUZ1PfdmE7/acyVb3fOkwmRF6XGMwhQ3P16bpygQRIOUEIz0DslIbT1L5QAvF0Th4q9vCfHhIAyy1qv1PHW/b1JCxpTZPXuZn81OLwyCtm3ooz0Rg5PsAMvUpQc9ESzkoymQ8XHkMexpd2kwBZLZyDoM+8zY8cSEm4rJdxh3SoAzYDVaeTS5OGe6f4qLWNuT3gxFnTx/0iT+veecHVP1/8PR1n4boDR5UzuLfWMz6eA7+Yje452M6rKNjNz73N6qv8bQMZJrVRUDTBfAkPSBYtvX0ylN5BLhqRJNf05C7eem3WZCDN9GPU/4iPPUzaHTLITmCb6UMncS5WOdcQUe2jO0s5Fo1e5gMTueRFQK+5+mbwdXLsHMdEI5uP2FxK/4tMebqm9/88JjPSzZV+CMEK45LZCMmmccTr6ME7XaYzxY72MfDexYGedzIbglS/WZBPabXCGfz/CTBrYkCcMQwJMMbOiPjGLuhT8uAFyvAMdUc7fqkLwt88FIjRiS2AxLVXn+ENHFZElZaZVZe3LX0ZryOyjFUU85cblk+SO3/2gjqPeVzhp/Bzmz7l84QYEQoQz0M4V7et2ALmZeB30i44xejshNVvM/iujK+DdOi6lwGv+kt5FqznBlBNOVkV3M5ZDN0NQy1pO3bTKZ2cmONEytgXOSTJhyR7Z2Ekk9wJuIfi/bmfPKaVMJniUb2dMvrNM2mbo42QfafU4N7N8/kJ6BxJrdBuppomHENusvRWEDRMpQ9bpJDTOT0muOTkeWByIaL3ztmP7TnNoc+dpap+DjSboyO/,iv:I/Z9pVzPupIQA2/q7F7pfWYEaQnPLTUOXQhcmZv820E=,tag:dSHwoHee8zMEbtyslZipdw==,type:str]
    key: ""
  certSANs:
    - 10.1.20.120
    - k8s.robsonhome.cloud
    - 127.0.0.1
  kubelet:
    image: ghcr.io/siderolabs/kubelet:{{ ENV.KUBERNETES_VERSION }}
    extraMounts:
      - destination: /var/openebs/local
        type: bind
        source: /var/openebs/local
        options:
          - bind
          - rshared
          - rw
    extraConfig:
      maxPods: 150
    defaultRuntimeSeccompProfileEnabled: true
    nodeIP:
      validSubnets:
        - 10.1.20.0/24
    disableManifestsDirectory: true
  network:
    hostname: k8s-4
    interfaces:
      - deviceSelector:
          hardwareAddr: ac:e2:d3:15:fd:f9
        vlans:
          - routes: []
            dhcp: true
            vlanId: 40
            mtu: 1500
            dhcpOptions:
              routeMetric: 4096
        mtu: 9000
        dhcp: true
    nameservers:
      - 10.1.20.43
      - 10.1.20.1
    disableSearchDomain: true
  install:
    disk: /dev/nvme0n1
    extraKernelArgs:
      - apparmor=0
      - init_on_alloc=0
      - init_on_free=0
      - intel_iommu=on
      - iommu=pt
      - mitigations=off
      - security=none
      - net.ifnames=0
    image: factory.talos.dev/installer/520de4225301b3fd080dfa5613482544286ae7a379ccd0744a375799d25bd5fa:v1.9.3
    wipe: false
  files:
    - op: create
      path: /etc/cri/conf.d/20-customization.part
      content: |
        [plugins."io.containerd.cri.v1.images"]
          discard_unpacked_layers = false
    - op: overwrite
      path: /etc/nfsmount.conf
      permissions: 420
      content: |
        [ NFSMount_Global_Options ]
        nfsvers=4.2
        hard=True
        nconnect=16
        noatime=True
  time:
    disabled: false
    servers:
      - 10.1.20.1
  sysctls:
    fs.inotify.max_user_instances: "8192"
    fs.inotify.max_user_watches: "1048576"
    net.core.rmem_max: "7500000"
    net.core.wmem_max: "7500000"
  sysfs:
    devices.system.cpu.cpu0.cpufreq.energy_performance_preference: balance_performance
    devices.system.cpu.cpu1.cpufreq.energy_performance_preference: balance_performance
    devices.system.cpu.cpu2.cpufreq.energy_performance_preference: balance_performance
    devices.system.cpu.cpu3.cpufreq.energy_performance_preference: balance_performance
    devices.system.cpu.intel_pstate.hwp_dynamic_boost: "1"
  features:
    rbac: true
    stableHostname: true
    apidCheckExtKeyUsage: true
    diskQuotaSupport: true
    kubePrism:
      enabled: true
      port: 7445
    hostDNS:
      enabled: true
      resolveMemberNames: true
      # Incompatible with Cilium bpf masquerade
      forwardKubeDNSToHost: false
  udev:
    rules:
      # Thunderbolt
      - ACTION=="add", SUBSYSTEM=="thunderbolt", ATTR{authorized}=="0", ATTR{authorized}="1"
      # Coral Edge M.2 TPU
      - SUBSYSTEM=="apex", KERNEL=="apex*", GROUP="44", MODE="0660"
      # Intel GPU
      - SUBSYSTEM=="drm", KERNEL=="renderD*", GROUP="44", MODE="0660"
  nodeLabels:
    topology.kubernetes.io/region: main
    topology.kubernetes.io/zone: w
cluster:
  id: ENC[AES256_GCM,data:4ivnslXfUsLDGtzB+VpiB6MfVQzlg3/XE7tEczmDiWs6cMzWOLDkSbrBXwA=,iv:qRQcPraaiFtO5T3m1cRZaT4j/8OlrkX5TVJc87+eTH4=,tag:CAj0UjIteN9PZGKL3TI7Pw==,type:str]
  secret: ENC[AES256_GCM,data:Y/T9rLRSgzrZHVT7TuTKXAiQLDyjaLybFT/5f80QpZvD8TG0TuLouQJ9bs4=,iv:kQX+gmCxblMn62EdiOL0Gj5lEF6GXuBysSfefa/RF1A=,tag:ZmzG6IvzN7iSzzeK7FBxvA==,type:str]
  controlPlane:
    endpoint: https://10.1.20.120:6443
  clusterName: homelab-ops
  network:
    cni:
      name: none
    dnsDomain: cluster.local
    podSubnets:
      - 10.42.0.0/16
    serviceSubnets:
      - 10.43.0.0/16
  token: ENC[AES256_GCM,data:oglj9BMzdwc+mPQNioXKEKTJVvGFksU=,iv:j/IG1R18RMw7c6/i/6PjXfpYFRItGF7ARSGvdwQ1a9k=,tag:/5iLn0NeGFSmD3sZhgigZQ==,type:str]
  ca:
    crt: ENC[AES256_GCM,data:XW3QfxDl1SWwR89Cm4w7iZkrHfeHg6xSPfrntLoONzHVuAdBHIIlbu6RqfQtOEm0u/NO+IA7rI2yRwWS6oY3gBeb5kEIWRkmw9NqWPNbIZ4R1esaUt7RczvjxgcoSPfwJY5u4UGlR+fhd6H6DCi/VKHOsCQC4QADhXvNVtpYk2edGabfk/pbGUN7uZPetIajnQVlGPicbRo5YXkck97byRHM4uobSIjJLfSFUG01a8ejClzPmXpAFv6ubi9fL5LVz4rX1o09zZYclYB8HkciAo7XPL1rNEYYGcwX4efCrGKl0omoozC7+Ln6NZPRN29LDaaXrY88SxS6EXoEECU93/qllGgLFya5tqLcQmqTxAVuT0J9FBDh3seRvyQ1R+0JgmNOgLb5fEktVWta5Y8gftWBT0rAicry5IFsmuWoPuLTNsDRkox+ERxPqks4ZwctQ77RW3kPLjJaOOwJBNubJDRwmtRXw3zVuZ9Y/GheRbT9JkMRNXoVWFSxfO2UZf8ietZcGuHOUTQMTVt/3Eoe5i3ViTLNEiFVdD/rb8LSxx6C1GExfEBcmA6cAliktQ+GHRIqaW0KA1jBkuNTPm8/ceAgR//SqLggLlmcQYGCpHgxtmXyNlkjNvIEdSVamTlLqs/KsuLzYaJUJnRlBkpLqUhcTXdyIXrOyFqKBkZNun7DpFj62zrZRiihxrZbhtMPNpwLNjNIPCM357hLleY1N4WBsFsH1dvQdL+4ZkLne+D7IodrIeksh1LOE8kj2xDncvW35nDma+GXn6/vNRkLyN/YKws2Cp0MmGR2T45ZOv0zRHsTZiu7T4ZUUGhtX+FwESjK6YsWTwhppgWH8OQ3y6tn4RGNw6vNyoFRIzccSNIujvcigBZlhCmj+d7tiUureYG0PPNHm+epxtFDkky0a1ocHodA6+ph+6z9shs8mHK9WUfHkLCpVmHIoCxb7C2L05cnplgRsE7rP9m0Ro60MxAp+zHh5SN5+NVZ3oeE19oIiqhZljiUZxs+1SYJVFxeHdg9cp5d7oEKXyIXN17AMN5g66E=,iv:9FGpun/cRLqvL9yZAKbmIT+AQ5/bwC8GVf8A2/UqBAA=,tag:mPrxioKKGG+FZKDwkCyyjA==,type:str]
    key: ""
  discovery:
    enabled: true
    registries:
      kubernetes:
        disabled: true
      service: {}
sops:
  kms: []
  gcp_kms: []
  azure_kv: []
  hc_vault: []
  age:
    - recipient: age1jwm8ccjgfy04r9rwh65rehk72j6rkawkpjnf4rcu4ukwlcfyquhq4p2q23
      enc: |
        -----BEGIN AGE ENCRYPTED FILE-----
        YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSAxdkwxNzBvNXZ3NmJxZWFh
        a29xRFY2ZldMbjhwZDVQUzhyOXo0alYvUHljCmJSTFV6ZjQ5RHYrZEVjalBCUTdH
        aTJSUjhES3NqOENBUnYzbDgxVnFjSlUKLS0tIGRoUGY3T0huZnltUTQxRndFWVMy
        b04xUzQ5UWMrUmFXYUM5alZvbDdKUGsKc8i6iVvWpLSfr9+6JPyAY0GXjlhotN2U
        LJbVigbJkJJ8onY839enfzgLs7akfywhcfdBj3Y2iv/q3F2Z3Cu9oA==
        -----END AGE ENCRYPTED FILE-----
  lastmodified: "2025-01-30T04:10:58Z"
  mac: ENC[AES256_GCM,data:qGjasOTEibQOXPlZaN+/Xc7j3VUYFG3G5atAOvqbUKqwDn/Z8JjFqGAoIFgVpHJcSBylJ770LhHBi3utZgitUyqqMUZm6dr1zfywNzjGnv7/mGn6H40KyCNgQDGflVLgwTardi4qJ75d/+Oh6Wk/9ZgKJSRk5z7PLWekro+zqmI=,iv:KZrv21/EhT0LMUoMz/tcnq9QuK6S+7Ck5dBMIR3Nu0E=,tag:OMsGjMKSeXX1BrePpccjOA==,type:str]
  pgp: []
  encrypted_regex: ^(token|crt|key|id|secret|secretboxEncryptionSecret|ca)$
  mac_only_encrypted: true
  version: 3.9.3
