version: v1alpha1
debug: false
persist: true
machine:
  type: worker
  token: ENC[AES256_GCM,data:kvMjOiS0k99H0vmtEg0hCk6T6kvVN3k=,iv:uUAaehgMmN3QLYdDPdKOHpXZFjIWiYn4Rl9QEIRrX7E=,tag:zDwPofcE+3b+gfFXlSxPkw==,type:str]
  ca:
    crt: ENC[AES256_GCM,data:lRLrn0F01mVlGchyWZR/NpcHH8j0VTXOMG2CW9YvQzztkhtYJYmdt7iRb/gbiBmGAtlbzEAuMQF46VyL6/LSOAjRGo6JM6gxGmhNZpH5xHRuVRDTLlCHuvk1KnmZ8NPOlvbtH8Vu2h3nTRxGeWzsQpFhK3obACC6BThD8e90cRYvrvnZD0TFPQznf6TeJtwH1IIPBK4sg1eb7CHPPimAsBpoSXTJ0gS6BCROd4t34jfDP/wB4zsWnsPuqU/bToCsB+AkTyYOqPyGhmbphNMZLZwsAJ4dKXwJ6hZ9zoe3R7Aydo95DJkmTZtM9hE8cc3r2g3ek+1FGvDyb2238f+uB0+Cu86gIIw9f1DPmxbqDRnbKZ8Cdjo66ebIHmMz6wWFYhgHxrg+FS5q0jWpvis7FTu+FNGcn8KMRBcPTjohFcLGTf5zVx+R19ecNknxzw0gGzCIjulO/7dzHwmSBXhafTM/o9lXuRbjFU0+wvKlbmVPpPB2twn51JCQcqndrbVBNe19qFwRqrBNFbH8lZIW3shR40283Dpsc3UIaeO5OyDYxhuXrVxeP0Dj0REQ28i9VNBehjFijlyXvQETxcfxiMASoX+VNdKmtjf6fNLO4SokE7vw86IIABsIL9AuNgOztQvKNIZ4L9DVeUahe9q4WSOXVlq1Cvdknuddq2sk/eWJ5w8OJfPxvaDNIc97sp9vlssefYVDGiWL5KAmKQT17iWmbp4X1xcv+dPHpHPV4CVejT6qT4kwXcm57teHDVeLA/p/SSY9zbs6nOFldlCfor3BUwHysSIr3xeHt3VswlDOjXRFiunh0nUkwmHqeMaZ5/IIXCNgP1z/+tnFtxLVxP9IEbByfnYIwyM/sLkP/aEpZWxO,iv:bLgQUAs7IEuUipg0qP3UHTg4LpHyIacSnXkgOslU9SA=,tag:3GTM5q0Rk31hteLdGO9abg==,type:str]
    key: ""
  certSANs:
    - 127.0.0.1
    - 10.1.20.120
  kubelet:
    image: ghcr.io/siderolabs/kubelet:v1.32.2
    extraMounts:
      - destination: /var/openebs/local
        type: bind
        source: /var/openebs/local
        options:
          - bind
          - rshared
          - rw
    extraConfig:
      maxPods: 150
      serializeImagePulls: false
    defaultRuntimeSeccompProfileEnabled: true
    nodeIP:
      validSubnets:
        - 10.1.20.0/24
    disableManifestsDirectory: true
  network:
    hostname: k8s-4
    interfaces:
      - deviceSelector:
          hardwareAddr: ac:e2:d3:15:fd:f9
        addresses:
          - 10.1.20.14/24
        routes:
          - network: 0.0.0.0/0
            gateway: 10.1.20.1
        mtu: 1500
        dhcp: false
    nameservers:
      - 10.1.20.43
      - 10.1.20.1
    disableSearchDomain: true
  install:
    disk: /dev/nvme0n1
    image: factory.talos.dev/installer/a0b4991356a74f14e884e8b9192ac3864397894fa5223317098564de42ce0a0f:v1.9.4
    wipe: false
  files:
    - op: create
      path: /etc/cri/conf.d/20-customization.part
      content: |
        [plugins."io.containerd.cri.v1.images"]
          discard_unpacked_layers = false
    - op: overwrite
      path: /etc/nfsmount.conf
      permissions: 420
      content: |
        [ NFSMount_Global_Options ]
        nfsvers=4.2
        hard=True
        nconnect=16
        noatime=True
  time:
    disabled: false
    servers:
      - 10.1.20.1
  sysctls:
    fs.inotify.max_user_instances: "8192"
    fs.inotify.max_user_watches: "1048576"
    net.core.rmem_max: "7500000"
    net.core.wmem_max: "7500000"
  features:
    rbac: true
    stableHostname: true
    apidCheckExtKeyUsage: true
    diskQuotaSupport: true
    kubePrism:
      enabled: true
      port: 7445
    hostDNS:
      enabled: true
      forwardKubeDNSToHost: true
  udev:
    rules:
      # Thunderbolt
      - ACTION=="add", SUBSYSTEM=="thunderbolt", ATTR{authorized}=="0", ATTR{authorized}="1"
      # Coral TPU
      - SUBSYSTEM=="apex", KERNEL=="apex*", GROUP="44", MODE="0660"
      # Intel GPU
      - SUBSYSTEM=="drm", KERNEL=="renderD*", GROUP="44", MODE="0660"
  nodeLabels:
    intel.feature.node.kubernetes.io/gpu: "true"
    topology.kubernetes.io/region: main
    topology.kubernetes.io/zone: w
cluster:
  id: ENC[AES256_GCM,data:7W2n9yFS5nUhUhG2Qn9l0EU9mGpyuJPPls3djRO5CWgU3jRjO/53AUkb9P8=,iv:mxawacIf1xrnl+vqWsDUYf6Su/MCtbyhr6vRXdKVRCk=,tag:AzxAyM39ID3J6biSxNIWSQ==,type:str]
  secret: ENC[AES256_GCM,data:MxahvUH17BuzEfY6dUhqmB4rCTMMwIfrhY4vQTrnXK5YhY/9jokRMcP1UrI=,iv:bPA6PLLfALCPnb2xGUFduSlNH5CG/TaMGGOLlJAkvWA=,tag:G1AtCTg/4E8JT4QLZ2Qjkw==,type:str]
  controlPlane:
    endpoint: https://10.1.20.120:6443
  clusterName: main
  network:
    cni:
      name: none
    dnsDomain: cluster.local
    podSubnets:
      - 10.42.0.0/16
    serviceSubnets:
      - 10.43.0.0/16
  coreDNS:
    disabled: true
  extraManifests:
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_alertmanagerconfigs.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_alertmanagers.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_podmonitors.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_probes.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_prometheusagents.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_prometheuses.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_prometheusrules.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_scrapeconfigs.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_servicemonitors.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_thanosrulers.yaml
  token: ENC[AES256_GCM,data:JFr54olPJRAbPD38jbU6cZHHlRigWQw=,iv:4D3LOAWs5UIshigrW7IfaliFusRi21nT9sKs81Fac1A=,tag:xGMul6JUenvUZSPk8GeorQ==,type:str]
  ca:
    crt: ENC[AES256_GCM,data:XyVxKHfrpF9JMnGm15UZ0weRtFzU9GlVU2CxXUcB+kYE45FUs0mjXanDfn0pVx3qFKyn5TcVk18KkWSpkyKdhWOCUqBxdGgb+EObJyBMQETReD2Wji9tnh0KyAvGSmQY5aDL7yuw874uGHnXinFYH4KdORosesjXwKCz7eCFErD8ZW011a8Ji1jD9TAL2U7Hk7Z+SLtbk60qOXIbynlyzrDSVtO9Jf+CXpJ1yuHKfNvy2BJl1JhwGpG2B2mz961knmLbNATdXXL02oQV7IiDqpi5gnNIiBlNnue2UZ+KodbYMF6L7tDN4NVoBwCQIO0VefExwoTl7QMUW0QIyJ09f7Fx55xdOQJ3Ad6F2f97q7vPfxqNXr9F6pOUWQ0qAe39CCX1WdCeaky2bZCG0rT61H4v3jvlaKuVTtr1CK+oHGEWWLRaICT3zmRBTWJTW42fxmGGDbQ7yAL4DryC2B9K1eu0watt3jfTaXkYPGYLdFnDQAMtjoJ2NxqeuhWfg5AOKUvAKHliFZ/1t3Mrw80D6q5YNfxxRqBIZIqi2c519HqkIraAAIccMf0YAyv3MUU0cNS7Kt97KDuVIwTA3cXOylFvKr/H/RCkMfVJvyXCilFPU/Hp6iuTm93Bha0lepoXJrnLL7RUFaNrI4YB5oxctV/8EpA+ZRPG0dfR9TUOGcwKjcHsvBjeO+osmYaLOQ8HAihBHhRYxsy/f6/YTksoVFduApHrY3/T67oROlzxy/80Ap8pQNHLL0Yfl5xlDdBhqSqZ1u7TDaJi7KUJPAEHMEIeLT6SQqktjX9+c4uvfHvWgWjXBj1ndljMig3agbwRiWclwwRdD/91XFFW+cfImY0kd/49sS3EmnE6gSp8mtARMU9Ql1Qq4yRgfTevgQI2GH7v7Qc2msguJisntJAEUqXN/CHlNdMl1OJdCbQt+7ZZ/IFDScdjM6nanwltsLLXLquzWZnpwX3+255y/fnHoxd3toDsA/TJvolz1VziIlkA7GTnal86f2X+48r3canaA7+t0ReFmYLxlON0ecIS8XGBPrxn9DvquPuIQg==,iv:jyI+KfSLEndGkE+61Cjhw9OI5RYiDdFCgXpeRe3eo0M=,tag:9mewaAqkRdS/s0vLJxG04g==,type:str]
    key: ""
  discovery:
    enabled: true
    registries:
      kubernetes:
        disabled: true
      service: {}
sops:
  kms: []
  gcp_kms: []
  azure_kv: []
  hc_vault: []
  age:
    - recipient: age109xxk5j8q09kprdd5wta9fw7nwpz8t95phq49eclrefjy3zjncmqa9lgtk
      enc: |
        -----BEGIN AGE ENCRYPTED FILE-----
        YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSA3M2JhQ3VZdUxCYVd3a3ov
        amJyN0dJRmZWa29ZbC9HdWI1KzhLRHg4SzJVClpkY0E0V1A3L0hLOUNOUmxBbC9F
        NVppU0dzSW81VUFUeVJwa3lqeGQ1QjAKLS0tIEpVTHVFc2RjUGUxUDRkdy9LQVFh
        RTdwMTY2cFBObmhmZXoxbHA3NEtjVk0K3kfdOtlkLiVOvILzWANNpWRgRjKgmNvH
        4m7ZTrVHnSSy/1FeRTNNykzeMcUCDeWlcXoYbQoLgU1xOOZBhTHKww==
        -----END AGE ENCRYPTED FILE-----
  lastmodified: "2025-03-13T00:50:39Z"
  mac: ENC[AES256_GCM,data:8EoSll4AHjlwWdONzgJ+fpIOHFFBzmYj8NBR3H5i3lZffv2GHu3CDVQBfeGyOsx3OHap9FGKmeddFI3eXbqPqzim5gPFR9Y4mcbT/9Sd3X5cYlP1DkmF2fDnya+UyO9Nat4WkS9ypTWvV0VJA+cTfeRj9QZYYWxaHQ7pYuX8nEE=,iv:53JjAWmQTvTyAaJI1xaXcKYZiWh5fg6a6wx2SVUaHe0=,tag:Mf5HhVsTKr5oEfLWoBkyYw==,type:str]
  pgp: []
  encrypted_regex: ^(token|crt|key|id|secret|secretboxEncryptionSecret|ca)$
  mac_only_encrypted: true
  version: 3.9.4
