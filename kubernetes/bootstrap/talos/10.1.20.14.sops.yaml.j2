version: v1alpha1
debug: false
persist: true
machine:
  type: worker
  token: ENC[AES256_GCM,data:5e2ue38onnGqndnvLsUwVJi8VLmRh9U=,iv:XS0kvMgVoRsIADlwICwsMOeqlkK6GR4U1SHiOUVCcHk=,tag:W7ts1eOJOa2Fa+b9kkiezQ==,type:str]
  ca:
    crt: ENC[AES256_GCM,data:SKu4O3guuaqanNgnwExlrZ8FLSZ3zW9f8zoSTvcW9IqIka5trompuQXZzjeOH29pzfqGBtBK/HAjWn5mfSP8EwHDFd0avYVkiP0A7g1ohtT2QBZYZ6rVxBRRmSliQ1Jrgk3UVig6ZKe4hEn/0kizepJK++aQCplULrDZAdXxvfInzFhw4Px5ivJd8Y2dCEf+ZhqsMYD27vBYHH3RP3z/xhmCcFrDAb8id0a6r7mkeuPVbf5CN3CgTTygI0HGWS6sMkNGJIgfLwf8IGjXaVsvf7LMU2oRgm/G62GusM/HFEZt4ECbuuykaPZoNCyxxGY8sbPVJvXhStPSkOkL/SBtCXoodCtrYSLm/2v3Y1NQXQqCE7WNeI02kAZ7oXBH/NxNsHc/h6XKoVCt4KnIb0LC1tuvN2AWoa0wzIEblK3DIPJorgB4Ub/j2/K5db+hmiaVXGL+TE+cmx9m43GT9W6pif/CYAJ1zjtYd63g8DewZ39oiaOo33WUusuJbe1nT5cLdbAJAzoX10IXv98y3GwsrUDxXVPxpE7DSpmDtR3PYmYRXPm0lEkADWFsSoNE5Sfwod8O2oEyy9eI+up8znUz2a/qp9FPLD4Jws2xxeV/Ti5spx9lZS9D4WRlM5BTDsKsMihoD8+y/s4QwNA8iW11wapA7JJWJNhEC9ctdkGKScb30Faak/7O0fzIbc2fmyGJFINkdFEbjldqZSAK603ciisJwvrQIlfSt3yVMboCKNqkxBN74HIeaf4X1AX7TENPfWF9M9w+dK7i8FevTiFGIendyZxg7pjleVfCX9x7WMfU+WFeTbHTpa++QczPh4c2M1844NXCO4JmIEOOXxySjSQRJiALo1JuT/A50zXEexSFCwJV,iv:K9CdcmTin/Tjy0fGIjq8cE+IAH85bMmw7tyRwDl0XK4=,tag:VXzrrb1DcVyvdbRgpVj67g==,type:str]
    key: ""
  certSANs:
    - 127.0.0.1
    - 10.1.20.120
  kubelet:
    image: ghcr.io/siderolabs/kubelet:v1.32.2
    extraMounts:
      - destination: /var/openebs/local
        type: bind
        source: /var/openebs/local
        options:
          - bind
          - rshared
          - rw
    extraConfig:
      maxPods: 150
      serializeImagePulls: false
    defaultRuntimeSeccompProfileEnabled: true
    nodeIP:
      validSubnets:
        - 10.1.20.0/24
    disableManifestsDirectory: true
  network:
    hostname: k8s-4
    interfaces:
      - deviceSelector:
          hardwareAddr: ac:e2:d3:15:fd:f9
        addresses:
          - 10.1.20.14/24
        routes:
          - network: 0.0.0.0/0
            gateway: 10.1.20.1
        mtu: 1500
        dhcp: false
    nameservers:
      - 10.1.20.43
      - 10.1.20.1
    disableSearchDomain: true
  install:
    disk: /dev/nvme0n1
    image: factory.talos.dev/installer/a0b4991356a74f14e884e8b9192ac3864397894fa5223317098564de42ce0a0f:v1.9.4
    wipe: false
  files:
    - op: create
      path: /etc/cri/conf.d/20-customization.part
      content: |
        [plugins."io.containerd.cri.v1.images"]
          discard_unpacked_layers = false
    - op: overwrite
      path: /etc/nfsmount.conf
      permissions: 420
      content: |
        [ NFSMount_Global_Options ]
        nfsvers=4.2
        hard=True
        nconnect=16
        noatime=True
  time:
    disabled: false
    servers:
      - 10.1.20.1
  sysctls:
    fs.inotify.max_user_instances: "8192"
    fs.inotify.max_user_watches: "1048576"
    net.core.rmem_max: "7500000"
    net.core.wmem_max: "7500000"
  features:
    rbac: true
    stableHostname: true
    apidCheckExtKeyUsage: true
    diskQuotaSupport: true
    kubePrism:
      enabled: true
      port: 7445
    hostDNS:
      enabled: true
      forwardKubeDNSToHost: true
  udev:
    rules:
      # Thunderbolt
      - ACTION=="add", SUBSYSTEM=="thunderbolt", ATTR{authorized}=="0", ATTR{authorized}="1"
      # Coral TPU
      - SUBSYSTEM=="apex", KERNEL=="apex*", GROUP="44", MODE="0660"
      # Intel GPU
      - SUBSYSTEM=="drm", KERNEL=="renderD*", GROUP="44", MODE="0660"
  nodeLabels:
    intel.feature.node.kubernetes.io/gpu: "true"
    topology.kubernetes.io/region: main
    topology.kubernetes.io/zone: w
cluster:
  id: ENC[AES256_GCM,data:H6vgfsdmmwwl6a72DIvNdCDQeG0MTMnxFCf9iVA49sTXHt+J3V5RT6EZn2k=,iv:/nFe5vwNQlrAju0JHgGfz297od4txW+clYvp8hmlSbA=,tag:1kDLeLq2RWGXib/NR3oLxA==,type:str]
  secret: ENC[AES256_GCM,data:7SAb6Nj8qmvHC7GJW0xQpZi2TarW8dfjvXJilQxZ/Xiw6gtPsdfN3Bsfg4s=,iv:5Yvab5QSGG86ZSLwHVfyO6WKyI1IhQWou6myd+vgIfc=,tag:EpId0xCQA/70GsxOQr7Hxw==,type:str]
  controlPlane:
    endpoint: https://10.1.20.120:6443
  clusterName: main
  network:
    cni:
      name: none
    dnsDomain: cluster.local
    podSubnets:
      - 10.42.0.0/16
    serviceSubnets:
      - 10.43.0.0/16
  coreDNS:
    disabled: true
  extraManifests:
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_alertmanagerconfigs.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_alertmanagers.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_podmonitors.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_probes.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_prometheusagents.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_prometheuses.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_prometheusrules.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_scrapeconfigs.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_servicemonitors.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_thanosrulers.yaml
  token: ENC[AES256_GCM,data:uBeauQnDiuIJY/8Ha9cTGXMpEpNn3Us=,iv:D9J/MQQdKLh5owWJbEYC5Vee2SXk49uzaIgi3T94J+4=,tag:WaDib1nvObB49sA1tih93Q==,type:str]
  ca:
    crt: ENC[AES256_GCM,data:ieu5JDNk391MZ25wSEgpLJwjqh1gNHgQhdKg9pi2UVsWIkusgXkw7uR/+71ELHW1UxDzxj3mI9O8HzyxApva/whF7dFXyRWoujWqk5gnwxnDl6EIIC/bPtnSCPMYF9fq2k4v/Qfc3Y0lArPv3KxWpdibp3ER1/P2VtY3AxREWWwDjBCiDVMaI7zkVcNxGbFDxzX18EjtudAiZZGCt0N3fn4ozev5GXp5b0OprLJMai4yLmJ6MAddx9YDrfJh77TEX8uirHOH3O9uuGHCnLQiH+4aN/bupoN9pZ+UNBuXkJEAqTr6jR+DTcyvDwGYlxVKjGpYADvobRQSXaXOEgSSk045Zp7hI31Soofjl0ugACIP7/+5bbNr/7mWk02kb7p8iFE/irOl9Wa9AAku1CL4zD4xVK1RBg52i7Lttnc75crV8WZPQcNwRjwns7E2UeqjnglMEV3Be0frXftpaXeHIEjLc3LGNXJOvpybLXC5NfKW+Z8p9ed2XQD4+/aUwC2ij2zdZIH/k+8mFhL76oUqJLpURedkOQs+kIsPWgvmTpp3E4za/6DBfSgEkUOdCLY5uBWLkC6fxjYOmXn6rde/PMXVH4eDBgwNt89wG1l25IGodNu0yXxA5iAjjcABCFZyLpqJzazg05aVvlRYGdjFOPSsZ2Bi5Y/4exHh2tsXt3+3ilzQaQaReF+C6MCKUoE62f1Jufy1kKxKN8GvG946ZpfytbS30pL2+vQK7KI0rTG7/dQN+kXFkr/hSccaJkbRdM4XVgv2b5qrhvNrBYu+aT8eNgRO/nfhyprnq8e1HhjNMwefvhxOpuk38CD+vB8N7T0WVMoKg0bDt/OjdzPuq9PyA/CfRzWCUJr71eaE+9CR7R6CkK208LoWxHD3lTNqKQJgB/PxwOgR1KfCo7ScNcuvG/wokwepOFFdWXaC1Or+RwzCN+r3m/pTJxYFDXHJIM/F5zZaZBOHFIIG7J5zKWG7coQarBR4+NblHErOCizH6HkGbCwaZCo4OKpG5traqtUzJFWdl2NThcDRVqyl2tArCg1vDZ1RlnFaiw==,iv:AY0CsekdAN29PobqMR5sqf8iEJyaxhbVBTrUMrqS7FY=,tag:6UilmAGf0hIZTRFA1/CkYA==,type:str]
    key: ""
  discovery:
    enabled: true
    registries:
      kubernetes:
        disabled: true
      service: {}
sops:
  kms: []
  gcp_kms: []
  azure_kv: []
  hc_vault: []
  age:
    - recipient: age109xxk5j8q09kprdd5wta9fw7nwpz8t95phq49eclrefjy3zjncmqa9lgtk
      enc: |
        -----BEGIN AGE ENCRYPTED FILE-----
        YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSAybzMrVmtQMDlpRnpQZ1Ex
        dDE3d3pBdzVyODBDeVB0M0p4cmpqMVh6bWpzCjFqK2l6L3VLUlFQempTNE85QWsy
        ZlhJWUdmT01zYUJJS1paa1daclVHREUKLS0tIDY4U1R0OEViM0J1MkloRHFyVTBY
        OXd2M3R0TERxYWU0V0hFWklETEpDZlkKziRiTlzpty6GRfugbogHnoY1OXHVXExB
        jmoXfH45l65jajBbWw+Mnx1ksQ1XrapiPKMcLHflvafngPVGE3E0Tw==
        -----END AGE ENCRYPTED FILE-----
  lastmodified: "2025-03-12T21:03:44Z"
  mac: ENC[AES256_GCM,data:JKfXqWTX6ZsqqOPK1n0i4MkskdnkpIbpywZoopGEGQPdoimWYiX1zK4nj4BTHXacWIphoSvDLUgPjtAVqpvsDVhLodGh6GJWc/vENQdZZ8faAJY9RE2SzwFkbp/mhdejOJzRxICSCYmAmo/RNtxOiifk9ySZA3OYAHYfetiMmGQ=,iv:FqyIxz9RajWbN2fxNN3mk++VrlhIDAL0cflts3qtJTk=,tag:4rjVHnEvApNOMNpHVYXQkg==,type:str]
  pgp: []
  encrypted_regex: ^(token|crt|key|id|secret|secretboxEncryptionSecret|ca)$
  mac_only_encrypted: true
  version: 3.9.4
