version: v1alpha1
debug: false
persist: true
machine:
  type: worker
  token: ENC[AES256_GCM,data:0sAkU/FmCeG+1EG9vBHCkfgwWscynTA=,iv:TSiXf2U/8vGCbJgby0cOfiE8ewDWund9bbR+spkdft8=,tag:3q9SPGeJcm1JIZUUQ0P+1A==,type:str]
  ca:
    crt: ENC[AES256_GCM,data:fxXMFqpNR7he5dtm1y9gPI0lAGO0zeqO0UewpC0mxTV9itnwIKWaqeTRjVR3LhdTFeQOzIJAfWKYuOZIiXvNY9quvsG474JpoS1KTcxxLGPWmbgX3HENCpH73mxXSGHYAXXdc0PUzMSeegVEUpj2+Bm0ooT/tZT5T9oS5C/PYOI6qvS9loeHtzv85lI4+AwvQHRxR6mQQ1BKatWK/nKRjivFEBe8XDTt4O0S6ZsYfJk48OFrGMsTjwMJkHO/3CPZonnhBEWmZlZrwV3v7Ufzrkb0TiuXYKv2t53L4YwS/u5NCPmshKGnwdb8tWE5naXFirLrdnY2fQUXNYiVu2+o80oz4W7xsyjHSkrafNbrC9C3B51IFBIfPKVKoMaqx71reeUpTcrtpn4uNjgUvHVEcOjaXNW4u99b1ACAum6xWSgZi1G5hf2Z/S2qmP291qJTVI2Wy0QKmt6rC1uOwRkY+h92OtzkbhVJiNS7/Vn/yYMlEs9FZQXUwP4PcxvzanvafIhBD3jYkNxKZaPjU1jYmBfl+gRpYhPx2XvKaUSfJRPdf10EJYVT3oGp1CQ4ohJ/NiKq1u/mi2r5gC7ZM+gvnA08ap+/NmMrv+gwOKu8+iYy3TSqWKnjazRNtdx9VPIPvWVBVTz7w0ge56vmXw5zka26C5pc7L/rIgW/EA3N1PEK1ekfhGcJmDjY8/sWmsjiE0qyOAjX87r+B/gTuKCzMhtS8W0/xPOORWk6ilG/TXEQuzowmzo3MbdDk0c7elK6veqEKMOc+HBNES7KmXlj4nXxQ72Ao6NHpu9j6ksUEclQzlglbjQs+gaM1NrHYqVldL18R7zeNSrdDeXffhPauKnyApDCzI1ouFd9UzwHiJNKEs2z,iv:MTRi2Y+HKQVIy86OW90aoRoj4TntBqIRDqjqvsyeyoE=,tag:55XWGLBsfhqBtPkus+ejjg==,type:str]
    key: ""
  certSANs:
    - 127.0.0.1
    - 10.1.20.120
  kubelet:
    image: ghcr.io/siderolabs/kubelet:v1.32.2
    extraMounts:
      - destination: /var/openebs/local
        type: bind
        source: /var/openebs/local
        options:
          - bind
          - rshared
          - rw
    extraConfig:
      maxPods: 150
      serializeImagePulls: false
    defaultRuntimeSeccompProfileEnabled: true
    nodeIP:
      validSubnets:
        - 10.1.20.0/24
    disableManifestsDirectory: true
  network:
    hostname: k8s-4
    interfaces:
      - deviceSelector:
          hardwareAddr: ac:e2:d3:15:fd:f9
        addresses:
          - 10.1.20.14/24
        routes:
          - network: 0.0.0.0/0
            gateway: 10.1.20.1
        mtu: 1500
        dhcp: false
    nameservers:
      - 10.1.20.43
      - 10.1.20.1
    disableSearchDomain: true
  install:
    disk: /dev/nvme0n1
    image: factory.talos.dev/installer/a0b4991356a74f14e884e8b9192ac3864397894fa5223317098564de42ce0a0f:v1.9.4
    wipe: false
  files:
    - op: create
      path: /etc/cri/conf.d/20-customization.part
      content: |
        [plugins."io.containerd.cri.v1.images"]
          discard_unpacked_layers = false
    - op: overwrite
      path: /etc/nfsmount.conf
      permissions: 420
      content: |
        [ NFSMount_Global_Options ]
        nfsvers=4.2
        hard=True
        nconnect=16
        noatime=True
  time:
    disabled: false
    servers:
      - 10.1.20.1
  sysctls:
    fs.inotify.max_user_instances: "8192"
    fs.inotify.max_user_watches: "1048576"
    net.core.rmem_max: "7500000"
    net.core.wmem_max: "7500000"
  features:
    rbac: true
    stableHostname: true
    apidCheckExtKeyUsage: true
    diskQuotaSupport: true
    kubePrism:
      enabled: true
      port: 7445
    hostDNS:
      enabled: true
      forwardKubeDNSToHost: true
  udev:
    rules:
      # Thunderbolt
      - ACTION=="add", SUBSYSTEM=="thunderbolt", ATTR{authorized}=="0", ATTR{authorized}="1"
      # Coral TPU
      - SUBSYSTEM=="apex", KERNEL=="apex*", GROUP="44", MODE="0660"
      # Intel GPU
      - SUBSYSTEM=="drm", KERNEL=="renderD*", GROUP="44", MODE="0660"
  nodeLabels:
    intel.feature.node.kubernetes.io/gpu: "true"
    topology.kubernetes.io/region: main
    topology.kubernetes.io/zone: w
cluster:
  id: ENC[AES256_GCM,data:Jkfe26af02Lq9PLhX56pgNlJ+59YLoevnq9VsfU2dLcv0HoO9eAfRw8i0AU=,iv:K2KQJzJXG6JRSEfoNT25Uq5zcYWc9sMuqb/Y9MeoeI8=,tag:/dRqq/n5v7gfmosr3FNiag==,type:str]
  secret: ENC[AES256_GCM,data:7GfVeS2qE4xomy5X913lEfTPK9647ncuePZmn+m6CzWgrCKOEqRuReUQo1k=,iv:2Ag0+JLl18mMYbRK2soO6yEugO1Ai1ybaXjpTsrNTsE=,tag:rhKc9Gp2m3PnAIVlqxbzOQ==,type:str]
  controlPlane:
    endpoint: https://10.1.20.120:6443
  clusterName: main
  network:
    cni:
      name: none
    dnsDomain: cluster.local
    podSubnets:
      - 10.42.0.0/16
    serviceSubnets:
      - 10.43.0.0/16
  coreDNS:
    disabled: true
  extraManifests:
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_alertmanagerconfigs.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_alertmanagers.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_podmonitors.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_probes.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_prometheusagents.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_prometheuses.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_prometheusrules.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_scrapeconfigs.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_servicemonitors.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_thanosrulers.yaml
  token: ENC[AES256_GCM,data:qCfNxJZ9BkxQCwgM9DJKPEw/c4e0UPI=,iv:UHqLmLyYdjWJsyjUBahMRL/6CcXEPeURsExJZD+G+So=,tag:0zYvDPQteObZfA6n9XkswA==,type:str]
  ca:
    crt: ENC[AES256_GCM,data:rKcVTUUINRRbnyu0PPBfSkAZU2G7VnuIUO96CLgCR1n/PdZG9Rq4hui+116CnLOOg8ajrzUdaucnSzFI5RkIi8oTv2IIZdlmls5PZoexT1gqSKsbaiy0fw/vl5Gak+0ovLpuPTTNPBex+yon7LdmAQyWgptyH0GPUginQiiXjiCRJsmg8PUEMoT2baE/ItcCL7GBGk/sZ36r7ehWNFLBHcv6rjyhcDOVxqY0loOmV6ZA/C6AxEHmw3839KI5J9wGg8G/+yiprnWgkdP6TYu3fuZIO0MJ+VpCOEPiSZPb2l+Hp2nWMlcUoO4dxfJL6ZV4AwOEYu0oscp3ZNTCBjdRwq+ZAKu8n+fdBoPuLzqu2245j3ByAhMAm9HE/oWlmyk03U55y0w54+BmGuRkIo3VA7geXYqbH5PrMuPw5m9dKjqZap3V91jfDdfNiZyj9ja2XY0fO02X4j6ZzZ+da8hU6Jb3tWoajYxGl7wgUbowezogz3/rGSHxgPOcuBEV4bYiE5cF9/JlI8To+OYohTQeYi02H1kistoluD+8OArzcVnaBdlH3Eu4XqOUVgAojpNUaTtPQQ5/VdMsq8QJQ0oIAcjp4UcbrJdLVdPDrlfZIkXecZ0qoJYOWMuyCNRgbeLpIa9nk4TseEqHmc2qD0+3BnRZ/RrwjaaJCkicmk9klQB+OwnnaIuV0sLafIOtLkdR0JLhyX1ifTKu0hGrmsRwhV4Kgfz0JTk0kTVihrte1w94mtIerWq0qADVuXcj/YuUy1nCCq7PAxB/lNZ0YVgaTYBz7L5/eMnBtzpo5bKhVXkSARhtlpPh0NcQ1MGsoCQI5WL0Cur4NoZ3CWCbnJswV81qN0Xzbt+mGrVbBNhXpA9EUBfJANTB9+XFB3Vy13Br5vaqbnI3uYYBvZPvjvlf+7yVNtl4iIcgLA6lAR8t9mvlg6qVEyTatFhlTkMac41S4W1FMHE8awwTPjAYSgQYE6wAzsvvM1hlPWQNrbMBYx6Sk3g7L0SXxzWJ/XzK4/xsl4SLxQr14qU8dYPspfa78+UnhtjdXefaDzQ1uQ==,iv:8I7UG4PqmJKxR5ekwaHSdnJ3Osw8DMGWBYaX50svP7g=,tag:uw+e0Q2M+UCJqVZcj/OACA==,type:str]
    key: ""
  discovery:
    enabled: true
    registries:
      kubernetes:
        disabled: true
      service: {}
sops:
  kms: []
  gcp_kms: []
  azure_kv: []
  hc_vault: []
  age:
    - recipient: age1jwm8ccjgfy04r9rwh65rehk72j6rkawkpjnf4rcu4ukwlcfyquhq4p2q23
      enc: |
        -----BEGIN AGE ENCRYPTED FILE-----
        YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBIMnZFaWpqWnUyTXdwYWJt
        UTIxUjRFWENIa1ZTZUc3bUVYMkZnRzZpQ3dBCmJycnhpTzhZQ1ArVnBsT0JCWkww
        akpBWXFHYWt0cXgxdUpuNlgyUitVZTgKLS0tIElBQUlWRy9KSHJZQkFDUE5mUTRI
        eGZjRlRCOHdubkNaMVdVSFNjV2hYL00K6ShMZ9cErRActuP+zaxOYKuecrmv/bg8
        prV6+m3gcDrwQYx+CMES2M5TUIwel7VY2rlO2XFIhDP2tvnb34fq1w==
        -----END AGE ENCRYPTED FILE-----
  lastmodified: "2025-03-12T20:27:06Z"
  mac: ENC[AES256_GCM,data:jYr9PaVM3qW9bbXqV12mvXMHtVUIp6YyVewXEAmnfh0XDARz5hxOkHgoLb/pRZ2oBqpTt6Md0PY1xGoB6NT199QvTYoeAo0crz6WTBWsY7sOBT3I7Kmljsv4vl2GHjjw/TQZSKPO2A7o4F0k1V5uHyzpDBfF8kuzsKZ+6rwPsog=,iv:Cu93c/VZIuNCVWppNewaXLC3f/AgE4efjcsEY7i7GgM=,tag:yFMzLI+cF77hesDSHx+/TA==,type:str]
  pgp: []
  encrypted_regex: ^(token|crt|key|id|secret|secretboxEncryptionSecret|ca)$
  mac_only_encrypted: true
  version: 3.9.4
