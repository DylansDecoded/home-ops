version: v1alpha1
debug: false
persist: true
machine:
  type: worker
  token: ENC[AES256_GCM,data:i0uhOsDY5EWO/+hMHxYv7DAKUoyISQU=,iv:t3ME++ijzgHyN9zuMwEO2JCmm1kSqx1QcKTrt+f2MX0=,tag:+LETtbboAxjWWQ5xpIh/MA==,type:str]
  ca:
    crt: ENC[AES256_GCM,data:L1p+0tCrvMW4Wm62uRgauvqFG6vPiuNxGLS4+C57mnkXVClkXJEiF1pbeX7p+uQCnJe1iAwF9lFEcFvJa8BuUS6sJniy5qjc6X1Kx6Ji+/0RTKJrW3N5wKpITVCKAGwNIRnr16PbfmOTjmZGuIV73AFEXM6r3IW2jT1uzOULdXrn49Ff/MkHp6u7EvDT/uhVzJ5pLYj6yo4I9fhaOoMDS1yR1oWdhDRX1yYS9l9rgOaq9V/9oSxVmPdEWA+4k4b/At3txSafD+IzneN5S6MpLwnMIp/bpk1dE48glCjKnIlHTjmWH+kScIYghXloe6N1CuWibh4mIzRDC9C43J/shMnRh473nsUFbieIBwKFpeFbOKxpKQJEH6aninQVpqlbXrMQu4AAQk/p9yGtyoa/5g4hEiAE6pH4rJGvTg7/I4FHEL8fHsDfiVRlzHQuTiefZPzEMy9hlG62EGrvp2aBUaHfqmJx8pfevezP3Otfj6AI0ZAHP3R09AEJu/9xv8JLjP+Rl4n5FjHQJUaFRMr0REzB/TCZk9kL63IGa26fFtPTGvllAT24kVrvqJnzDlTOtcWSDTzFwtDzS0pJ0BpK5Fweufh/IYB7gODRNE19n2KY7qHtKpsOgtz/e/14/GaJJ/8Amp8QfqXaZ19sH0bYh2uGLqjIiJdr46V+dPxUX3zn+d0BvgRx/F99Xm/p+fMMt1SoWgBFO9S6xC3m7tDqRiwxHNe/C34T96f+tr9WogFvq6eBjMiNiGxlaK5YUAx8yGL26XlDR67m5uHdTzaM6wO+YheX9klK1hZpI6WmghGST7txmGq7x3f0I0hPzzn9uRPOV+Y7z8WbTbIO+TWIqQwC1B+uknoR9wO7AoECGg8Y2F8+,iv:nS+P3xwvks++1Yr88RuKz49gHZ1E8VFGiUTG16e8Qa4=,tag:4QKV5sNWzWQ+Pe6ooCGfbA==,type:str]
    key: ""
  certSANs:
    - 10.1.20.120
    - k8s.robsonhome.cloud
    - 127.0.0.1
  kubelet:
    image: ghcr.io/siderolabs/kubelet:{{ ENV.KUBERNETES_VERSION }}
    extraMounts:
      - destination: /var/openebs/local
        type: bind
        source: /var/openebs/local
        options:
          - bind
          - rshared
          - rw
    extraConfig:
      maxPods: 150
    defaultRuntimeSeccompProfileEnabled: true
    nodeIP:
      validSubnets:
        - 10.1.20.0/24
    disableManifestsDirectory: true
  network:
    hostname: k8s-4
    interfaces:
      - deviceSelector:
          hardwareAddr: ac:e2:d3:15:fd:f9
        vlans:
          - routes: []
            dhcp: true
            vlanId: 40
            mtu: 1500
            dhcpOptions:
              routeMetric: 4096
        mtu: 9000
        dhcp: true
    nameservers:
      - 10.1.20.43
      - 10.1.20.1
    disableSearchDomain: true
  install:
    disk: /dev/nvme4n1
    extraKernelArgs:
      - apparmor=0
      - init_on_alloc=0
      - init_on_free=0
      - intel_iommu=on
      - iommu=pt
      - mitigations=off
      - security=none
      - net.ifnames=0
    image: factory.talos.dev/installer/520de4225301b3fd080dfa5613482544286ae7a379ccd0744a375799d25bd5fa:{{ ENV.TALOS_VERSION }}
    wipe: false
  files:
    - content: |
        [plugins]
          [plugins."io.containerd.grpc.v1.cri"]
            enable_unprivileged_ports = true
            enable_unprivileged_icmp = true
        [plugins."io.containerd.grpc.v1.cri".containerd]
          discard_unpacked_layers = false
        [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc]
          discard_unpacked_layers = false
      permissions: 0
      path: /etc/cri/conf.d/20-customization.part
      op: create
    - content: |
        [ NFSMount_Global_Options ]
        nfsvers=4.2
        hard=True
        nconnect=16
        noatime=True
      permissions: 420
      path: /etc/nfsmount.conf
      op: overwrite
  time:
    disabled: false
    servers:
      - 10.1.20.1
  sysctls:
    fs.inotify.max_user_instances: "8192"
    fs.inotify.max_user_watches: "1048576"
    net.core.rmem_max: "7500000"
    net.core.wmem_max: "7500000"
  sysfs:
    devices.system.cpu.cpu0.cpufreq.energy_performance_preference: balance_performance
    devices.system.cpu.cpu1.cpufreq.energy_performance_preference: balance_performance
    devices.system.cpu.cpu2.cpufreq.energy_performance_preference: balance_performance
    devices.system.cpu.cpu3.cpufreq.energy_performance_preference: balance_performance
    devices.system.cpu.intel_pstate.hwp_dynamic_boost: "1"
  features:
    rbac: true
    stableHostname: true
    apidCheckExtKeyUsage: true
    diskQuotaSupport: true
    kubePrism:
      enabled: true
      port: 7445
    hostDNS:
      enabled: true
      resolveMemberNames: true
      # Incompatible with Cilium bpf masquerade
      forwardKubeDNSToHost: false
  udev:
    rules:
      # Thunderbolt
      - ACTION=="add", SUBSYSTEM=="thunderbolt", ATTR{authorized}=="0", ATTR{authorized}="1"
      # Coral Edge M.2 TPU
      - SUBSYSTEM=="apex", KERNEL=="apex*", GROUP="44", MODE="0660"
      # Intel GPU
      - SUBSYSTEM=="drm", KERNEL=="renderD*", GROUP="44", MODE="0660"
  nodeLabels:
    topology.kubernetes.io/region: main
    topology.kubernetes.io/zone: w
cluster:
  id: ENC[AES256_GCM,data:whIh74RgVu9cUSWgx2cC4wCvld8OGPllJMd+DxMf2Xy5i9ca2yiAHj4zVns=,iv:Xn4CcloM0r+x956LvTahkPBWEgDSgGFu33gcA9SSqgU=,tag:QPGm6YEkb1/fuZNG4tXekw==,type:str]
  secret: ENC[AES256_GCM,data:Y9xIxpftSPdE697rqrg3jjJ/bltlQ4Ap7rRREqqay45KYl2jvaf43CBgleU=,iv:7ADquIv7qCaDAtO+F6ecitmMWVAA2MStUA38Qy8Euow=,tag:OG1d8SvW0js8QXZe3Ay4CA==,type:str]
  controlPlane:
    endpoint: https://10.1.20.120:6443
  clusterName: main
  network:
    cni:
      name: none
    dnsDomain: cluster.local
    podSubnets:
      - 10.42.0.0/16
    serviceSubnets:
      - 10.43.0.0/16
  token: ENC[AES256_GCM,data:cfMx4yZG9tZoxLM2bxWnjmnpLKawFio=,iv:f801/b70N2Mk8NDDL2/dNLudmofnxjJRmosYiJ1RQxc=,tag:GnkmQlA6fVmK/By1cz07yQ==,type:str]
  ca:
    crt: ENC[AES256_GCM,data:CPAPJX3V/sEu/juxwh/g2Di4yLoYCfNEXfGU9yq8hnmt656L+Q2dvrj9C+OnVF376Q6mJPrSMOyhuitZ3DZFvP2X7wEmCWok+bXuJW+6ltsjgvG2iocyLf5Iep8/qIOHa4/Xvz2L+0qgf0jDiyIEnGI6xt7nl9YmmeD+scHcFl5ezjd0i4ytLKdIt+JOxxIXTHqZAPfzl0X7nF/X099s5o7GrMSKMydnORH9zEwdw8KPxqC7HpXW7/w/JQ6MfwJzizLG3iPiYSl4t3u/aFcZNaN+JwvlhRPxN4uf04ZbVEBWuOh1oqq/+VXWEhw2buABg4aI2n6hip+r7Us/mp2OyUN5lL+IDpi95eKZZpHPDsCtLUwEoheRQRyC6DghwH07Z5U6fnPkiAVSQNPJX2+mYlvKDo3ymQBhwrIG7rQF5nGN+Lt7H2n/s/sxLT+b2zzeFipPlohdOVeST9CD1dcLzStBCcF+aCB8tDlfRd/FnU3fc2j3kirFQUf3LaXLSuvjkBIcXLzBtbg9Gk5/XTq5GvRfMVGEb3TiFzaGRTqvSnIePJDdOiKX/JwHVLCNl/xjmwkpmN16GkpmYFz1SqTRPiI35wekV21sxIq7UtuO6FXOXxb8U6FFruZtz/UDpK3/qponnXpY1ZeD7MUgo24lYuQvfAxhZUYub8n6KpoVwuTcFUEnEB3LHaRCxEIOH5mJ136g2430UFlRxt4DZgVhJdIa7ScPb45bcQlnwPeh5w+BlNKChpg5uQPip5yGH/QeAww+/CxpBluo4Gmr6yaT8hEqLWmsEHiDsQIa4LNZLW7/lRpgF0mFqnILLbb4x/vs4UhxMG3wgvB+jUjC1hwJy1dDwz4jBsq8hNvIYylYCZutx2N5wkzroy2Yx3tE8kiTYg0A0bXAhDn6smrf5DOqoBYS5OdkZw0ug6sHINelAiU+hOi2EVIP9+PFmED7sUB/VQh+5CbZbeaVcyLQHTZ/jw9SHsdLcMrTTnXo2W55025xEdGtvZuZg724TdvNTVtILq0Ib2KZY9+YZEhtXxkhxvAohkI=,iv:b+bVXUrny9y599yY/WVXHPoZinGVnIFSaibmODVOhuA=,tag:kUKYclKGwiXMjghcQTK5qQ==,type:str]
    key: ""
  discovery:
    enabled: true
    registries:
      kubernetes:
        disabled: true
      service: {}
sops:
  kms: []
  gcp_kms: []
  azure_kv: []
  hc_vault: []
  age:
    - recipient: age1jwm8ccjgfy04r9rwh65rehk72j6rkawkpjnf4rcu4ukwlcfyquhq4p2q23
      enc: |
        -----BEGIN AGE ENCRYPTED FILE-----
        YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBoVXp3RmkwaGJDb3M5bnYx
        WWM5enoxWXVCOHE5bE9qdGNzMzNxWm95VkZrCnM2eFV2MHFPV2NhbHhVTFVEM0FE
        c09LUmtNTy8rdzZjWisxcWFUY3JpUWsKLS0tIEI1aURMaEZtS3EvVWV0M2JuREpI
        Y3dadUNOTHhWTWc4d1JLYTZ4L1pWZ1EKYr08ZYbxP5dgTNfltZrpakgRKj7a0J4x
        zRsVxppKpllOLu/49sNaX4orjmE0JiQvo2Fumifrvb5LgpejUlyeJQ==
        -----END AGE ENCRYPTED FILE-----
  lastmodified: "2025-01-30T04:58:46Z"
  mac: ENC[AES256_GCM,data:0InyuGDGBTpB0L1cSpCbKdBlV83R3VCdYdnTBvGHTSpSP61epzLZZN78IhjD2EgTARVe48z4JqZtTLawpOhlPlzEeCHAxqiNw4ycc1tcxxWLGJWZGraWA71V0wT0Z1CGkrqV8zwmLIfho31bX3f7ALy1crPEMdA06Sta57DzlzU=,iv:ihAbGFPB5fQAqnI70Knw/MjzoV87WJjltR2EUY4jIzQ=,tag:fsX1Nxmou/ddaKRdCOWGqQ==,type:str]
  pgp: []
  encrypted_regex: ^(token|crt|key|id|secret|secretboxEncryptionSecret|ca)$
  mac_only_encrypted: true
  version: 3.9.3
