version: v1alpha1
debug: false
persist: true
machine:
  type: worker
  token: ENC[AES256_GCM,data:S90GqF0RNeZLcoXK2bkMEfrSvfTkkno=,iv:Eb+BiE1iA8ItK7SZBqzbvI+P0ogmx4y5PGEJsABl3NY=,tag:HQryZhEunsf6awg6M1je1w==,type:str]
  ca:
    crt: ENC[AES256_GCM,data:Iqu9f35r3cHtcloOd4n2cVj8RD7/RmmaCMh9ZiLhzdUFkH8OmWf6EA4hur2uuw4ySesKljmWmPQz/cIpSCRjZC0s4L7sKH/iPkm5L+h9AJJKRo7+kBvCqBE6v+fFhcHlVYj7S3lBUfJHtbWJp+YYiZzMs1uIXzmmJiT1lFlnKdJE/TJmiMB7003JI0LjWmqkNWg6fnVg5uhQd4t09TRrLtOeGLpe6gc1BUXBdq8A5ami1+klxLs/RWZ76N4nWJtKj4JZGyXr9sAihPxhFfPUS+0oxnm0rslkAzN7zK6aJYEdU3V9O3ePYSljigPJbV0Xb7TbcgEdtKwkhvJax8v0MxWMxmPaNcM8bTisQuYAi36yt4jaOTQQQWJWsWI56anosKqxq0xV+twcCXXkGTkv0d/0W6SCUJrOo9EUCCOdJPeEcyyPluPJPP56sqmgxaiREcNyqwdtuD8GYGniaQhThUlRlyAW6jhRiPdFo6XnIF3NlSLkJEGBVvXkUvBMNgL0KI+v83Qr6zBmCegYyhjQUuvWko4OEa2gxFR3tyD31AW/QHNRog+iEppegmVu71JOyfAkA9UbMK6/UAtHhIi0+lenr7sbAXUZwMZONG/etvq72FTJmD5PWx6jAHCzQIO6XX75meL+QC53allLNqBsj1IPrt+X98p9sY73FVqo2hNUeF533HnqCSSF7efXB5U1F81TCwN5RjiQ5pSWKBjXH9gBSsNDsk3QLTCvjKOROZZLvvzTc/9OlCb8dM9Az8sWbQBTWz2O/z4xL4QdR+7hRHM3lULrPXdLJ3ZV/NEnYhoLZkKHvTP1OZHy8UhMEZe/mY337ST/C36u0TvTdFp48ZNP0x54QoDYsArGLfAAth0g3YYK,iv:v8gWq8JkQM7c5hLbN8a4/LLBLDjh+l2MtYGZwA4Dgng=,tag:U3x091069jfmIgON2KqPiQ==,type:str]
    key: ""
  certSANs:
    - 10.1.20.120
    - 127.0.0.1
  kubelet:
    image: ghcr.io/siderolabs/kubelet:{{ ENV.KUBERNETES_VERSION }}
    extraMounts:
      - destination: /var/openebs/local
        type: bind
        source: /var/openebs/local
        options:
          - bind
          - rshared
          - rw
    extraConfig:
      maxPods: 150
    defaultRuntimeSeccompProfileEnabled: true
    nodeIP:
      validSubnets:
        - 10.1.20.0/24
    disableManifestsDirectory: true
  network:
    hostname: k8s-3
    interfaces:
      - interface: eth0
        addresses:
          - 10.1.20.13/24
        routes:
          - network: 0.0.0.0/0
            gateway: 10.1.20.1
        mtu: 9000
        dhcp: false
        vlans:
          - vlanId: 40
            dhcp: false
            addresses:
              - 10.1.40.13/24
            routes:
              - network: 0.0.0.0/0
                gateway: 10.1.40.1
            mtu: 1500
            dhcpOptions:
              routeMetric: 4096
    nameservers:
      - 10.1.20.43
      - 10.1.20.1
  install:
    disk: /dev/nvme0n1
    extraKernelArgs:
      - net.ifnames=0
      - apparmor=0
      - init_on_alloc=0
      - init_on_free=0
      - intel_iommu=on
      - iommu=pt
      - mitigations=off
      - security=none
    image: factory.talos.dev/installer/1be6923a14b1498bc2930c02b286cbf9d98764032fb6a8659b8fce7c1476262b:{{ ENV.TALOS_VERSION }}
    wipe: false
  files:
    - content: |
        [plugins]
          [plugins."io.containerd.grpc.v1.cri"]
            enable_unprivileged_ports = true
            enable_unprivileged_icmp = true
        [plugins."io.containerd.grpc.v1.cri".containerd]
          discard_unpacked_layers = false
        [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc]
          discard_unpacked_layers = false
      permissions: 0
      path: /etc/cri/conf.d/20-customization.part
      op: create
    - content: |
        [ NFSMount_Global_Options ]
        nfsvers=4.2
        hard=True
        nconnect=16
        noatime=True
      permissions: 420
      path: /etc/nfsmount.conf
      op: overwrite
  time:
    disabled: false
    servers:
      - time.cloudflare.com
  sysctls:
    fs.inotify.max_user_instances: "8192"
    fs.inotify.max_user_watches: "1048576"
    net.core.default_qdisc: fq
    net.core.rmem_max: "67108864"
    net.core.wmem_max: "67108864"
    net.ipv4.tcp_congestion_control: bbr
    net.ipv4.tcp_mtu_probing: "1"
    net.ipv4.tcp_window_scaling: "1"
  sysfs:
    devices.system.cpu.cpu0.cpufreq.energy_performance_preference: balance_performance
    devices.system.cpu.cpu1.cpufreq.energy_performance_preference: balance_performance
    devices.system.cpu.cpu2.cpufreq.energy_performance_preference: balance_performance
    devices.system.cpu.cpu3.cpufreq.energy_performance_preference: balance_performance
    devices.system.cpu.intel_pstate.hwp_dynamic_boost: "1"
  features:
    rbac: true
    stableHostname: true
    apidCheckExtKeyUsage: true
    diskQuotaSupport: true
    kubePrism:
      enabled: true
      port: 7445
    hostDNS:
      enabled: true
      forwardKubeDNSToHost: false
      resolveMemberNames: true
  udev:
    rules:
      - ACTION=="add", SUBSYSTEM=="thunderbolt", ATTR{authorized}=="0", ATTR{authorized}="1"
      - SUBSYSTEM=="apex", KERNEL=="apex*", GROUP="44", MODE="0660"
      - SUBSYSTEM=="drm", KERNEL=="renderD*", GROUP="44", MODE="0660"
  nodeLabels:
    topology.kubernetes.io/region: main
    topology.kubernetes.io/zone: w
cluster:
  id: ENC[AES256_GCM,data:el4Wwz53oAYg24JnWZ0mSwZpuDDDCPTobZXeMXhT27GYZWf1yifoILa9QUo=,iv:DAp4FBet5dATB7m0jOUmP5ABku4dpEjE8zLoUCW/zfY=,tag:fG+WkDHB8sWKZXuS8yTfCQ==,type:str]
  secret: ENC[AES256_GCM,data:RdoOYsrp0CjpJm/m2Cfwf2jt1On57pxA4DT4xfiYnDv7gtbpzHPpb2AzUE0=,iv:cCaMceZQZL7ku0nHdk5kov4NiPjg1/2mzM2Bzls2JqY=,tag:2Eh5V1IQCGQTGiyk3dXOwQ==,type:str]
  controlPlane:
    endpoint: https://10.1.20.120:6443
  clusterName: main
  network:
    cni:
      name: none
    dnsDomain: cluster.local
    podSubnets:
      - 10.42.0.0/16
    serviceSubnets:
      - 10.43.0.0/16
  coreDNS:
    disabled: true
  token: ENC[AES256_GCM,data:VNUgybSVp4QMfEDM98I9usts+abovRg=,iv:jkXRDC/zkS804WbTZrnkjkYSN26PUeKZh+I2aSYoSEI=,tag:qTNslyN6eRCEVXNcRzv3Jw==,type:str]
  ca:
    crt: ENC[AES256_GCM,data:PO+lwQVyhoq+03GQX61PhTRv4IsGaq3Fln6RAtBK9PU+BxzOsTodkLWnhtC4UdFUtNx4yu23qjQDYrOL8hOh9ACFpxfdiiRblwFCL0mzCI1qpHHpGdPnjK7PbEv90nghPNAvFiEu0TLCydWLtDMNsDwMZjggAnW9zP2rlO1JQU8bhdLTgT/Tb00pcP2ZEitI6kZPFh/ylFbrdWrVvrehV3CNlbLwWMIxbUArSHG50UDZrO0Ttr/GpnPrWmdDH11UBg8Vf4dKWBrLq/EgaSKdzJXEEUzlaVHOfQvPxy7gqC/glFzd/+f+bXP1mgqn336B17yrI2rENgcML5ZiY1s0ccgiUDfaIPgbpXH7fHjWZR1NqdmXbXkDovQA09jluD1f0aRx37AUwWVIuxVjPupSWk1GGUXJ4UHJLGlP5iqa0phgGF8vkHyEDBsofzQHf3EMEyiSb6REDw9lmEYFs8Ut3OpdgLV2IyigQB4MQxwvv1+mr1eAPHdA3Uc2Qttf/UEIAGOLQZuuv/kb2FRsmKrH0iNVyq2F0Qba0nLuuOo4AcG2iQ/bOaftR0lrxd9VccaTL/cuAbX+A6nSAio9dV30I+SZ1AY/6dBvU4AUACoRoBFyiMwCbNZv9jfLwhH+uxfahSloIbkkGfcSqF4gPVLFuVssRn1YbTpfJczeNmhCJUX4lcTFsvWhdCnk2ANPtKzvAanv+EodNp6AZtWLiVwRKWjgRXmM5vPK+uGpLU1iNrciF/aLE103jWrGEy2np8NshMoc9KM93ejH/jZeipUSg7unxLq6JF7qXTfu4UkGfdh+Hgds9A+zgGy/gr1Am6vfb6uv6PJsn+C2nTyFcbScOG32DfTuQT44vonkjlzhGAuOHefJTwWeAmLzatmbmXQ2W39pUZCvNltSgHlwcM5WcKrHQE5XZ4vtV8BInCq/b0zsoibz1wkQlsMcOhwPzF1n5JfoMSf/19coEvJr6KVllAscPq5JvgxKhZ+syZOVvyplClqGnEvFdzx0cl25wqtKP5Zl0ThZaZN6NUTkpMOGJa40Vl2Xowm9xF0ing==,iv:9/DW6Zhskk0J3ciJuJkYkEjY6WTRm1GidGnYa+1A8eA=,tag:Vp1QrVe7i/OxLw0JNSRACw==,type:str]
    key: ""
sops:
  kms: []
  gcp_kms: []
  azure_kv: []
  hc_vault: []
  age:
    - recipient: age1jwm8ccjgfy04r9rwh65rehk72j6rkawkpjnf4rcu4ukwlcfyquhq4p2q23
      enc: |
        -----BEGIN AGE ENCRYPTED FILE-----
        YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBSUEZyRzdSSW5EVDdET2N0
        SkpUdmI3dUZIZkdSTFEwWHJHS0diUHY1SkRJCklZMmd0bjZEUHRlVjBSUWpSRjcv
        a1poTlgraXU0a1lsVzlsUlVSNTV4TTAKLS0tIEVaNXUzbXpTTDFWZHA3S1BXZlYz
        UTRIZDE2L2Z5UXFrYlhJaFhrd3ZvcXMK89JFkK4dpnlSSUpL9xYziPmKLtS9JfCU
        L5WsGs+MvtwTKJoAXesxMCyw+5HVN9B3AYvMlICElzzOPZLIkDopmA==
        -----END AGE ENCRYPTED FILE-----
  lastmodified: "2025-01-31T20:07:50Z"
  mac: ENC[AES256_GCM,data:1mfHIR/kgPz5FawDH57rmLi/n+pNTOlRBG0pUJ0LACPpnF1oMk+VmqI/DL4VNLZ89tz7RtKcp84eMKHzCL/CCLZeMeM6CHlsBwu49RO6d9/QPg3d5kM5KMDdtb3aMRzEvg6Zj9R0Dj2A43yUIegF1urZ2OE+pQsGjfMH0w+4g/g=,iv:8iY3JgDkqyFJdbuKwC4GNzRBbQUJ4rEtMVreR/+npCA=,tag:M0uV9q/7P3sVpkealhckOw==,type:str]
  pgp: []
  encrypted_regex: ^(token|crt|key|id|secret|secretboxEncryptionSecret|ca)$
  mac_only_encrypted: true
  version: 3.9.3
