version: v1alpha1
debug: false
persist: true
machine:
  type: worker
  token: ENC[AES256_GCM,data:IInsuuAVXd2+Jvt2ShevVUv+tcu1HW4=,iv:9IB1z4OnAh0W38/qDBPYwYtI1zaFJwzJW6lRQgqIPmc=,tag:4Co1ahO1x+RJwhZukdtbig==,type:str]
  ca:
    crt: ENC[AES256_GCM,data:WXN70FZREo0U4pqt+aclrleyulCnkjL1BxcT+/3U33s6/ZuPcC61i9ZE4ydXzovc1ZR6GuFEdG+bT4EVZhp+N/8QRmov4PKaCsBvR5OqJb222tPSIYAFtHUE15pj42nsQ3jePOXCkJu4xNaRbYJuu91K3JdLL/aZjIjnWLJT/zH3daTexLHKBErGwgnQKtWCS3MYnKqKsz8rMCq5g9INe0E2DKGBhvtg5HHcDWh6HMp1w4iNJQ8DgVSCwAvvLZo9BuGy2PQreLyYNhwHPpiwK0A5hO9lm9omXxdL5YKih6WKTn0RqEEsjAiILmuhBho+vP46jToVG5AYDqmUBbZHB2ug0QgGxRzCEPKItt5GAqQv0SIhQC9JBkY6JVh/ogIPyTRMY581zJlRmf+FYXQILvQZ7I9fTcHcB6ce9EWGG+0N2jJxgbo0OnupxwudEMvZm8DxU1lgYTsz4b5qYnYfXF0LtH96Gj0OVQndd7GJoTLsCRWxqZ5U5ujw+ELnFKJrx55qDwu8fzJdeqRAHc18j7UzT7e4RZb3DexSTxpTxSx1KxkIJ6tLhSVEpFv/YaZ29AjBXMeCocDprIiIyM3h1wAGWdudXRt8Rn5jeZjA1ywRV5T1h+eqlyYXHrfPgdFyxYCa5hMrHzYX0ghjmLcEl7pR7gff5FGHTkzG38vun4qkymswSJVTjmNb/NW/khN9aXN35f+fQN1dCElHpbVzdDrvDSmux38c9U6I/BuOeewHAhvYTL1xMhN0sanglNxL8Oqe/0GajhX/PEkDkel7fgMPojgCHftar/GGY43kn1bxCWjAQe9UCSf3xaEWDZCb3ouM9iSG6o2IVRhKrvkrmKn115OnbgFjj4VanUSCtkzOsDCn,iv:73Rr2wFNBzYqoBu22CcOjCTMikGsuQYulQwRUsO1NwM=,tag:sRyoC5SKVDeNiwuZNryCpA==,type:str]
    key: ""
  certSANs:
    - 127.0.0.1
    - 10.1.20.120
  kubelet:
    image: ghcr.io/siderolabs/kubelet:v1.32.2
    extraMounts:
      - destination: /var/openebs/local
        type: bind
        source: /var/openebs/local
        options:
          - bind
          - rshared
          - rw
    extraConfig:
      maxPods: 150
      serializeImagePulls: false
    defaultRuntimeSeccompProfileEnabled: true
    nodeIP:
      validSubnets:
        - 10.1.20.0/24
    disableManifestsDirectory: true
  network:
    hostname: k8s-3
    interfaces:
      - deviceSelector:
          hardwareAddr: ac:e2:d3:10:d8:25
        addresses:
          - 10.1.20.13/24
        routes:
          - network: 0.0.0.0/0
            gateway: 10.1.20.1
        mtu: 1500
        dhcp: false
    nameservers:
      - 10.1.20.43
      - 10.1.20.1
    disableSearchDomain: true
  install:
    disk: /dev/nvme0n1
    image: factory.talos.dev/installer/a0b4991356a74f14e884e8b9192ac3864397894fa5223317098564de42ce0a0f:v1.9.4
    wipe: false
  files:
    - op: create
      path: /etc/cri/conf.d/20-customization.part
      content: |
        [plugins."io.containerd.cri.v1.images"]
          discard_unpacked_layers = false
    - op: overwrite
      path: /etc/nfsmount.conf
      permissions: 420
      content: |
        [ NFSMount_Global_Options ]
        nfsvers=4.2
        hard=True
        nconnect=16
        noatime=True
  time:
    disabled: false
    servers:
      - 10.1.20.1
  sysctls:
    fs.inotify.max_user_instances: "8192"
    fs.inotify.max_user_watches: "1048576"
    net.core.rmem_max: "7500000"
    net.core.wmem_max: "7500000"
  features:
    rbac: true
    stableHostname: true
    apidCheckExtKeyUsage: true
    diskQuotaSupport: true
    kubePrism:
      enabled: true
      port: 7445
    hostDNS:
      enabled: true
      forwardKubeDNSToHost: true
  udev:
    rules:
      # Thunderbolt
      - ACTION=="add", SUBSYSTEM=="thunderbolt", ATTR{authorized}=="0", ATTR{authorized}="1"
      # Coral TPU
      - SUBSYSTEM=="apex", KERNEL=="apex*", GROUP="44", MODE="0660"
      # Intel GPU
      - SUBSYSTEM=="drm", KERNEL=="renderD*", GROUP="44", MODE="0660"
  nodeLabels:
    intel.feature.node.kubernetes.io/gpu: "true"
    topology.kubernetes.io/region: main
    topology.kubernetes.io/zone: w
cluster:
  id: ENC[AES256_GCM,data:qwr2cyNhIpneapNFqw4EpV99Cu3k8PmqaEdWCdmabnDBbGRxXzx2+gqrxmE=,iv:ndAhA37HQHTLFdghPgqgrIddGSLfjrQIGdBbdTBGGGs=,tag:oduqUO7Bqcapc0U1nAKcBA==,type:str]
  secret: ENC[AES256_GCM,data:9kespElMI49v1MoWnuGQSmm6ZwO6KSbZOUVD0XckcUlfct0Z3Lgo5B+lmus=,iv:sJZFUqD+V2EsamfRV/sWr7x4eZTqtMqFdEGJkTdMZP4=,tag:hgivFo+XDbpg+rOU5yOT3A==,type:str]
  controlPlane:
    endpoint: https://10.1.20.120:6443
  clusterName: main
  network:
    cni:
      name: none
    dnsDomain: cluster.local
    podSubnets:
      - 10.42.0.0/16
    serviceSubnets:
      - 10.43.0.0/16
  coreDNS:
    disabled: true
  extraManifests:
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_alertmanagerconfigs.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_alertmanagers.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_podmonitors.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_probes.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_prometheusagents.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_prometheuses.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_prometheusrules.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_scrapeconfigs.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_servicemonitors.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_thanosrulers.yaml
  token: ENC[AES256_GCM,data:Za2YGrmGkzJ+s6qM3Ca2fBHxxX4Uwro=,iv:y55K9YTUL5dpnlVPdAyITUxVrl56ycCCqv8bvZ9CyRc=,tag:CNNupq7F7y3XDO1PqbwsIA==,type:str]
  ca:
    crt: ENC[AES256_GCM,data:yEVwOTUBe1fSZ9NBwCKrcXvmJEtHxO+x5HBes1YkYMZAnHeL5hv42sURJl37UkQ+PsFKVITeYcZzL4tDB3xvo4sJgKFkULEDDhvRonABpvN/km6pqtynpfcHjTwZvMJ8tvjhllJGDZ0Ke37URl94QdRFt14wbVBTCig0K7m/WsvDX9BzlseT12NYBxkWTJ3RPN3satCs915OD+KAkpZ9yFxCy2szK+6ITgKGRAeAJK4ENgfU0ZfVHHAdqFzZoC1Hrjy4J0M68sJLdKm6tfzYn7iJ+fTSQtfqcoeqlro01TvVmXMNEqaDoUP0vhcYU17wO3ubWpCfyrxRMX0dTdw6hArJTXVVT5TO2lSWrqP36Ui0Il7+cF6G+JRdL2xtLQWaMwArvTWWYpCyvkhb9FhIIRRQJU9NLyHRlt4NkPsJ4bVSsaSgMyGLpD5Rw4d2hgaBLTc39n+Pt0/IUmmAzKZJNw+OP7/qpMQZppJOoXdSBDgfsYdcYXNhNg0keEbZWOAFzj0qK5k1IsYKShwuxI4JDzPadhgSkjItrMFxnoVvMlEXkurAVmVSB6scNK7UNES1eGsvsvs80+QlJyMKqMKJiK9eY5BslfxfZvx7MttXsNKzCxr3k05o2ICAVM58bx+ntT/EgQ1goja0wwyFjTO/EfyfyWILBoEkqBFAzjR/W7EBSSKKRupV45BhGZhbgzk7eoClathMVDHt7s8KjTKVRFsmV53cLJp+m2lSpYzuz8ZJHPJZzw38EWJNN/Nb3aq4s0TaO9+cG8SBtpY5ptv7yWuWLKMRP6fisUlBmCipYDphmYKnGg2ecenHU+0rz8rxDBS88+n4V8pk+mFFXAzWhsqnCUVX+G9vGTtxI61SOxkSl4SSsH680DPU6TjHyIWIFw6nth6SY1VxJxRhsnftu+EE38lNZRsQ420ODvV6FuhDKRfpSnIZ6Q8SRN68yFULNHSic5wPb8HiUKdQmm6NpwLHC33e6n/mruzQFKAe8Vbjjom288Bf+9p1zXuVltsJTcCtTEakKfgqumFWnBELv+Mzj0GlRAjkPLMG3w==,iv:bGCpkzfbKVDpmXg+tUA3gKUsCZlNVyWScnqMWUgYYc0=,tag:Uf4hvDjYlTH3qMfqEWuHaw==,type:str]
    key: ""
  discovery:
    enabled: true
    registries:
      kubernetes:
        disabled: true
      service: {}
sops:
  kms: []
  gcp_kms: []
  azure_kv: []
  hc_vault: []
  age:
    - recipient: age109xxk5j8q09kprdd5wta9fw7nwpz8t95phq49eclrefjy3zjncmqa9lgtk
      enc: |
        -----BEGIN AGE ENCRYPTED FILE-----
        YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSA3SzNQVFcxVWRxeTJMNmR3
        Tmp3TjB2SXNBQzR3cWk2RkovdkJ3S3NYS25rCld2UlZRb2VFSzlEb2tOQ0xBWlRJ
        eDdCbG5RVkNoamRhOGRHSDU3VHg5b1EKLS0tIFg4cnBCcEc2UEkxS1RGZ0VHdVJO
        VTRNRldseVNGMjNtcGw2TGhxWUJpN1UK9+/LzQJlU9j/952GYXJVx/Yhl7iqhfpH
        J0K8pMg9Sm2TiOV4lIbALxhfDemgTXqiO1mJxZfdKCy/1wJKsq8Psw==
        -----END AGE ENCRYPTED FILE-----
  lastmodified: "2025-03-13T00:50:37Z"
  mac: ENC[AES256_GCM,data:vzuFF2hPVMWYzn9yCqsx3VEjPfPiQf8sjX8Ej8/7L0mQUzP8FGKitMmgYIz0wg9ZMGwYFaiZUYdTPpViWgC1++JbfYN1yn6Ggmty34W4nqUfFP+blbznWKxyyf5XqbRDmrIwn+AFnOn8OfDtUMertQ60ogUV4fa/3wbJnU2W19c=,iv:ZvKTs/cZ7NBKGIC2Tdm5h8JGmFG2HuiNC3vd0iiJpG8=,tag:7vbmAQ50H5pVuJsNNHfoAg==,type:str]
  pgp: []
  encrypted_regex: ^(token|crt|key|id|secret|secretboxEncryptionSecret|ca)$
  mac_only_encrypted: true
  version: 3.9.4
