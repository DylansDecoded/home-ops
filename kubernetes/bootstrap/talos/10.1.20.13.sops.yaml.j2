version: v1alpha1
debug: false
persist: true
machine:
  type: worker
  token: ENC[AES256_GCM,data:VAbw2SBP+F7aYvzPGKmTE8X8HcVTSwo=,iv:HAaW5yCh+VvUlZ+CXvJ8dE2mfIaTWujm8ZSE2H1Mn+U=,tag:/i0piY1yGnH9blMLAjuEXw==,type:str]
  ca:
    crt: ENC[AES256_GCM,data:1qQqkGTOpkSyUwo0poWIFxLZaDMvsLxsXVFmNVXuvvGkG2SKwMLVdRpoEuGg2pfktOhI7Szz84M2s2s3AyE91khY2+OvImMKkkE6ZIdJ5U4mSSqEx4qprM0tNB4UT0vBkVFbutgGfqp6PSaJIvRMQGXUWgW6CRmEZAA2YDI7QKF/ywKezcm8OOYat/tXwxA0s1EggxwK6+19tm7tT/qz0kOyEXnnG6hzMo/QZvyV67YE+32ZSe07T22jgOvrplRZTMwXHLhkGjpYSfHuIfPOAUmmYq3gzIAUKv5ChGlAp+AU5DYx5gtt5VY2FPAFhjMERAptfI3wzKpy5LUekEIgPA6SwSgytheReYYCoenQw05cyWYOVzPJcGT8cfbyWdHnmhiN4TbwBaKl10h/l6WP/bxSLTsMn+zgPbL7/Gk6iMIVLl3l1if/sZYlevTLSJru9evdHv6e8TRjqCFXNTDdcGIK55+BwDExRq15TAgBGAuByJ8+KE7gwzv4ehm/rgKxKG0bgYQCF0CsvZ9pJcrAK6EY8w/PGcpl8DnLOtw2eedY/meSawXZGyv9C6QvADxsanWxrz6PyT8WMzSxTGfkHQfnpkDIYF8wNiyq/LExKeLIOuhKkXBHuLdBRMxKgbTpc5zez3bW/qAH4UKNGpfMcY6PeTsiV5y4D3u6f2pM04AJSL8s3ZJxhGluZjFndux71C41QL0hcQkGAV6rbfOPnGeH6IeP3Qcs5S+x3+HHMDS8NOIdYfIF5aHGPQ02xwawPefWqk6Bq9FNz52pg8JBi7gsAbQsphGfnIeuDXzoHXDf3fT5Nl1vZnqkOcVdSAVUhO4LEhh5OJR+Ffs3o0MtVJUOW7Di6WXSVLy7M8mT9kxghykQ,iv:ocLovqEsBuCBwZCc8Nij5iFavKotg/qcZafrq8q7XXU=,tag:iv5aKIh2VuzXzFHaAAeTtA==,type:str]
    key: ""
  certSANs:
    - 10.1.20.120
    - k8s.robsonhome.cloud
    - 127.0.0.1
  kubelet:
    image: ghcr.io/siderolabs/kubelet:{{ ENV.KUBERNETES_VERSION }}
    extraMounts:
      - destination: /var/openebs/local
        type: bind
        source: /var/openebs/local
        options:
          - bind
          - rshared
          - rw
    extraConfig:
      maxPods: 150
    defaultRuntimeSeccompProfileEnabled: true
    nodeIP:
      validSubnets:
        - 10.1.20.0/24
    disableManifestsDirectory: true
  network:
    hostname: k8s-3
    interfaces:
      - deviceSelector:
          hardwareAddr: ac:e2:d3:10:d8:25
        vlans:
          - routes: []
            dhcp: true
            vlanId: 40
            mtu: 1500
            dhcpOptions:
              routeMetric: 4096
        mtu: 9000
        dhcp: true
    nameservers:
      - 10.1.20.43
      - 10.1.20.1
    disableSearchDomain: true
  install:
    disk: /dev/nvme0n1
    extraKernelArgs:
      - apparmor=0
      - init_on_alloc=0
      - init_on_free=0
      - intel_iommu=on
      - iommu=pt
      - mitigations=off
      - security=none
      - net.ifnames=0
    image: factory.talos.dev/installer/520de4225301b3fd080dfa5613482544286ae7a379ccd0744a375799d25bd5fa:{{ ENV.TALOS_VERSION }}
    wipe: false
  files:
    - content: |
        [plugins]
          [plugins."io.containerd.grpc.v1.cri"]
            enable_unprivileged_ports = true
            enable_unprivileged_icmp = true
        [plugins."io.containerd.grpc.v1.cri".containerd]
          discard_unpacked_layers = false
        [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc]
          discard_unpacked_layers = false
      permissions: 0
      path: /etc/cri/conf.d/20-customization.part
      op: create
    - content: |
        [ NFSMount_Global_Options ]
        nfsvers=4.2
        hard=True
        nconnect=16
        noatime=True
      permissions: 420
      path: /etc/nfsmount.conf
      op: overwrite
  time:
    disabled: false
    servers:
      - 10.1.20.1
  sysctls:
    fs.inotify.max_user_instances: "8192"
    fs.inotify.max_user_watches: "1048576"
    net.core.rmem_max: "7500000"
    net.core.wmem_max: "7500000"
  sysfs:
    devices.system.cpu.cpu0.cpufreq.energy_performance_preference: balance_performance
    devices.system.cpu.cpu1.cpufreq.energy_performance_preference: balance_performance
    devices.system.cpu.cpu2.cpufreq.energy_performance_preference: balance_performance
    devices.system.cpu.cpu3.cpufreq.energy_performance_preference: balance_performance
    devices.system.cpu.intel_pstate.hwp_dynamic_boost: "1"
  features:
    rbac: true
    stableHostname: true
    apidCheckExtKeyUsage: true
    diskQuotaSupport: true
    kubePrism:
      enabled: true
      port: 7445
    hostDNS:
      enabled: true
      resolveMemberNames: true
      # Incompatible with Cilium bpf masquerade
      forwardKubeDNSToHost: false
  udev:
    rules:
      # Thunderbolt
      - ACTION=="add", SUBSYSTEM=="thunderbolt", ATTR{authorized}=="0", ATTR{authorized}="1"
      # Coral Edge M.2 TPU
      - SUBSYSTEM=="apex", KERNEL=="apex*", GROUP="44", MODE="0660"
      # Intel GPU
      - SUBSYSTEM=="drm", KERNEL=="renderD*", GROUP="44", MODE="0660"
  nodeLabels:
    topology.kubernetes.io/region: main
    topology.kubernetes.io/zone: w
cluster:
  id: ENC[AES256_GCM,data:IK/HV0xm4udaXhussMlsjNFP0W0XKhqKysiz+VrEt8BLDkL9XEEMVvRJvFc=,iv:g9lqfUnBTHJESXuCj0GrqTkYW5TSxghf5RxGNYLjqxU=,tag:LERG7p2njjUVL32PT1mSQQ==,type:str]
  secret: ENC[AES256_GCM,data:9QEdZ+DoOE9Op5LGg3jTJlG4nNueclKRoLLDqNbDC9aY1W+TzFx4id5joi0=,iv:oQdMUGk67glequ5DRAUke6hrpXyu6FxaynIxm2cw2oE=,tag:y3iknKk0bHf2P2D/sJSz+Q==,type:str]
  controlPlane:
    endpoint: https://10.1.20.120:6443
  clusterName: main
  network:
    cni:
      name: none
    dnsDomain: cluster.local
    podSubnets:
      - 10.42.0.0/16
    serviceSubnets:
      - 10.43.0.0/16
  token: ENC[AES256_GCM,data:dPlZyl8pOyazbKAkV0dsjhx6k8A2XKQ=,iv:MNSxLTu/ZySJlWDSXcQxIXRNmWiWbxaik6xN6cX6bv0=,tag:lE6JHrk31FHtrzTtqSBTXA==,type:str]
  ca:
    crt: ENC[AES256_GCM,data:2P7PdClvqI1wzz8BEohNwv8AGc7qfQ2sElqSm4K0yoZs4kuHtYBEKb9laq5g1Z0zIydZydqnMAack8HWiE6eUk/04YHR+yH2L30RVrsD6ngjUQ6QAMM8FStj80W20gXTbpSknipLErb5DZNN0W9zY+0W5fE0nPNs7pendzFVBwlkKaXkzPBhARrbBkrEproV+z4ttco0Wg9+Qp9Vv1nax9h1hWneMjSbByBNGydTOKbKyxlGVXET03+ipQeacfDOsq09eRz6ZcSpRsE5Z4bWRGAWcs2vy4HrS1M1rds13Mon2OpLgxffHthg9gec5ZctuxjX7C1sp6YYpg/xiYr7WRky0OZ5h0yMdwWZ+TzhAzPs2lcsrJIlFF+GGERCpv4gOYh6iakD7zdHjIWNBRuCtQ8gTHz412ypHm6aKteWm7BfTrpyPWir1uoU8fDxHgo0xQQmhZr2iQTToNM6LgbJbMGNxjkPxtDKDvLsGcnCjWN50w8eW1w6CGb2/8iWJTIIKme7oqWwOagVITIQvwk5o1VkpkdME9gG6HxRZqKSdZAKv9G+K+9RuM6O2Uum5OEU/vbaIQXHauGSQHk9OcMeNoREwSH+P6DTbq0HS2UUn/E1GJxi/J3p4TaSwsrU5nvijP1gY1s7/dolZ+0HwwQzMERLcfSRmhVS+J3tDsQwueTm/phWrOAiPIugdkh8bq9V4pzXlTowZhhoM8vStufeHg0ZmmK2fe9Nw8+3qB16GBlW3lpnytYIqGIvmO5cERTrcPF6a1/B49c74L+R7fue5MJmffqbNBKc6Umyr+CQMXPJAhjpoTm+Snknek418/RADtaWpLbID4OO5JQTGEb1wBiV9xY1cgp6mMQMnrZEwdGXr691ryXfui2iwii0S4v15geq1xLPyrW4zmLBSiHXhoPvZ+mReqAKcEvSiOhGcsfalDhTzM0JUNVEEhtVe034U6UMW4bYuT7vuYgwFJ9WPTrs1NfjrUNqd6wAnx0GO5kGgus5SYP5Eock9ZDa+pbvjyifONVxd7ibtT5mdQ95LjOR/BY=,iv:KRZFZ4pCgCPRIHgEixbpQKNy2CgWKPc8ix5SaPHl2oo=,tag:sEuHi13gpmEUcBda/qSHfg==,type:str]
    key: ""
  discovery:
    enabled: true
    registries:
      kubernetes:
        disabled: true
      service: {}
sops:
  kms: []
  gcp_kms: []
  azure_kv: []
  hc_vault: []
  age:
    - recipient: age1jwm8ccjgfy04r9rwh65rehk72j6rkawkpjnf4rcu4ukwlcfyquhq4p2q23
      enc: |
        -----BEGIN AGE ENCRYPTED FILE-----
        YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBGdE13cXNuREh5eC95RTUy
        TloxdUVSVVVrRE04WGduMDk0QVlsOC9RN2gwCmQzWWlnTlJXQTdqanEvSDhscVcw
        M0dxckQrWjRnbVpGL2I3SXRSMmNLUGsKLS0tIGNoQitpbHY5SlVUSkxOOHJLZ1ha
        ODZaNVVsS0luaFRDcmQ3bTlZN2NxWFEKjQZ5znqoMlUNRnAqsSiZfO0CbGUs9po9
        Ep4wUuaZ4MGxS8bw/dx0M4K3HpU1zYkNWYuL3gqrgHsmwdaQXNB2FA==
        -----END AGE ENCRYPTED FILE-----
  lastmodified: "2025-01-30T04:58:43Z"
  mac: ENC[AES256_GCM,data:MXciBdkXSqwBsdfOItcYojztKx2qkLSlRUWU5/7p1ZLYu1odaANzKnIV3tta23fQ5PkXKrg7T67DdDDMX/RrVNHIRmoDx8z4nSwhciBI90FjEuv400gO0MwJMA1OXusQU0MmGzE+d4bRjnbpvpUPNvltWJAGkZalN7TdKnBOJWU=,iv:JbcffM0T5X6BFpeZ9yebm9+geihlSz/tOKA5aiUmpBk=,tag:p28A1QxDCJPkO5XHuELM3Q==,type:str]
  pgp: []
  encrypted_regex: ^(token|crt|key|id|secret|secretboxEncryptionSecret|ca)$
  mac_only_encrypted: true
  version: 3.9.3
