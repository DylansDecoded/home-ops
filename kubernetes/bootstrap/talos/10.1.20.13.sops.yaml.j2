version: v1alpha1
debug: false
persist: true
machine:
  type: worker
  token: ENC[AES256_GCM,data:ukz0qF9u6kv+6F49Tb3OdmKIIJJH4bU=,iv:ujfJPg2XuM92mjFijzHXNpKEPQoEk8VSts4BdYhgRdU=,tag:VFCENz9zssiJbctsApqfOw==,type:str]
  ca:
    crt: ENC[AES256_GCM,data:AOdJCIGqvDw7zQAar8BUjGSdVteb9HqjRGhlkGhXKds2I3NG4JNAza4h8hI5mW3/ZODSKahI4J6uo6l7AY7ZVX480Ta+nBe/C4ebyIjDwRUCHt6HvC82fEF2Is3SfpDIGfQ1DB9atLma2EjRd+GdhAVL3TcSLLS9ofKmrA2L7MCQQNd5EarD9ZivDEJ6amqeNdr6FIUOfw+bTrYTDIKrOVvwDNJ/RGXWiENnZoprdQP+m6wZ3D2Nkq/tUTrTN+lLKyNCstB0mDFbUOCBsYwY4wDzOWgVuGsrPNZ5AUow0exJ8zJ40JHy0HaEYb1XL9kPV+I+/ovzdbd+OK0SOSG/JGBiX36JUJEkSwuzcMiSESijC8HFtwZVXg0w9GmhAwcebs/OUmOQqF1J6P5pgzg0omUzw2cHD7RmQq91zlbXGoZ1ZfBzpuHe5stCdZxD042O8Wis4cr03lBVlnXGOjvtM2RLGPE6CnbcNuRPGlvf4gFKpuP/1+L7mAgD4cAHDH1dZRg0G6/3RyIT9tQNrGfYvPS631JFoG/0ngNqcuWKjcCHgps90WzWVHab5OLXRg6tRWuW6XAX7p5LHfpYIUKW3CtpUmIqOPpZzEwxRbFsAByUsaBbVCoLYKbwczNG1uPYU97uk/E2LfnjbLyK0maOtHhWlPez3CiDeUE6B0VdxAgz4MVwzXM4BAZ5/YldRPehw7+ol+VzmPwnSAxGTs8TaF3BgAOssoQMawKKghCddEVScUyph2SfGYJpg3Nvfi8Fcry5iUBJbBx4QXt7cZzAoIkF/Z0Nu0dUnE3/w0ikWTqU7IoMIMseuxdxZRrp0iAp5A7BCNUNwWi1OLf2DCEzSyOAniy8ot3/McO5MOT2uNIMf7ew,iv:9PAKPr1+C2Ps56LuuSdTuDCbvmH4klOk13n7HPDylG0=,tag:utK6fmY7gWZokDNytyk6Dg==,type:str]
    key: ""
  certSANs:
    - 10.1.20.120
    - 127.0.0.1
  kubelet:
    image: ghcr.io/siderolabs/kubelet:{{ ENV.KUBERNETES_VERSION }}
    extraMounts:
      - destination: /var/openebs/local
        type: bind
        source: /var/openebs/local
        options:
          - bind
          - rshared
          - rw
    extraConfig:
      maxPods: 150
    defaultRuntimeSeccompProfileEnabled: true
    nodeIP:
      validSubnets:
        - 10.1.20.0/24
    disableManifestsDirectory: true
  network:
    hostname: k8s-3
    interfaces:
      - interface: eth0
        addresses:
          - 10.1.20.13/24
        routes:
          - network: 0.0.0.0/0
            gateway: 10.1.20.1
        vlans:
          - routes: []
            dhcp: false
            vlanId: 40
            mtu: 1500
            dhcpOptions:
              routeMetric: 4096
        mtu: 9000
        dhcp: false
    nameservers:
      - 10.1.20.43
    disableSearchDomain: true
  install:
    disk: /dev/nvme0n1
    extraKernelArgs:
      - net.ifnames=0
      - apparmor=0
      - init_on_alloc=0
      - init_on_free=0
      - intel_iommu=on
      - iommu=pt
      - mitigations=off
      - security=none
    image: factory.talos.dev/installer/1be6923a14b1498bc2930c02b286cbf9d98764032fb6a8659b8fce7c1476262b:{{ ENV.TALOS_VERSION }}
    wipe: false
  files:
    - content: |
        [plugins]
          [plugins."io.containerd.grpc.v1.cri"]
            enable_unprivileged_ports = true
            enable_unprivileged_icmp = true
        [plugins."io.containerd.grpc.v1.cri".containerd]
          discard_unpacked_layers = false
        [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc]
          discard_unpacked_layers = false
      permissions: 0
      path: /etc/cri/conf.d/20-customization.part
      op: create
    - content: |
        [ NFSMount_Global_Options ]
        nfsvers=4.2
        hard=True
        nconnect=16
        noatime=True
      permissions: 420
      path: /etc/nfsmount.conf
      op: overwrite
  time:
    disabled: false
    servers:
      - time.cloudflare.com
  sysctls:
    fs.inotify.max_user_instances: "8192"
    fs.inotify.max_user_watches: "1048576"
    net.core.default_qdisc: fq
    net.core.rmem_max: "67108864"
    net.core.wmem_max: "67108864"
    net.ipv4.tcp_congestion_control: bbr
    net.ipv4.tcp_mtu_probing: "1"
    net.ipv4.tcp_window_scaling: "1"
  sysfs:
    devices.system.cpu.cpu0.cpufreq.energy_performance_preference: balance_performance
    devices.system.cpu.cpu1.cpufreq.energy_performance_preference: balance_performance
    devices.system.cpu.cpu2.cpufreq.energy_performance_preference: balance_performance
    devices.system.cpu.cpu3.cpufreq.energy_performance_preference: balance_performance
    devices.system.cpu.intel_pstate.hwp_dynamic_boost: "1"
  features:
    rbac: true
    stableHostname: true
    apidCheckExtKeyUsage: true
    diskQuotaSupport: true
    kubePrism:
      enabled: true
      port: 7445
    hostDNS:
      enabled: true
      forwardKubeDNSToHost: false
      resolveMemberNames: true
  udev:
    rules:
      - ACTION=="add", SUBSYSTEM=="thunderbolt", ATTR{authorized}=="0", ATTR{authorized}="1"
      - SUBSYSTEM=="apex", KERNEL=="apex*", GROUP="44", MODE="0660"
      - SUBSYSTEM=="drm", KERNEL=="renderD*", GROUP="44", MODE="0660"
  nodeLabels:
    topology.kubernetes.io/region: main
    topology.kubernetes.io/zone: w
cluster:
  id: ENC[AES256_GCM,data:Cxbc1Ve5exAftdzRZVbqSCKDOx0vj8bAgrPqIR0RiEgxAOxMrcfRAanEAJU=,iv:8qYnw7C0JMbpg2bV1VVDOuZDNdZdkny23cpkj2ElIsw=,tag:m6xM9GcCWpNb/Z1PSmQzUQ==,type:str]
  secret: ENC[AES256_GCM,data:aorqizdX68AKpJxaftqptf72XvkKUMSOw+EhTlldAMYPaG7qy3mB95a8ZBA=,iv:lkXts2xMEwTOR0zM0oWgWMc1tuJsGLDiuU/TaCs3sHY=,tag:bvIEpB5tBhxOw+QTEHcGEg==,type:str]
  controlPlane:
    endpoint: https://10.1.20.120:6443
  clusterName: main
  network:
    cni:
      name: none
    dnsDomain: cluster.local
    podSubnets: ["10.42.0.0/16"]
    serviceSubnets: ["10.43.0.0/16"]
  coreDNS:
    disabled: true
  token: ENC[AES256_GCM,data:WwofGOIybg9Dh24MMb5m/8Gsxi9CQHM=,iv:LjuNSGdzCKFPvAF9f2pnSDbkvAzjMXGYKW6zbXJfpDE=,tag:TSdaXfGAHlVAeRxfh5iImw==,type:str]
  ca:
    crt: ENC[AES256_GCM,data:IhYyl5fUcFY/6BYXzA5sJ181l4X/ajDYhWYYfGEF2i6GSxnqbO5gcrZJbDJZ4kg3op7G4lBOXod9bMDXIxOXhKB5cP1WeZ+EyT86c+C0R3k8hKWhWfbmyCFwu9QrVfb8+ccE/u8aHaEz/pJfWXEKxdGnZ6Nm1Pi+MQiSAb/6HvnmY3Kxh2h1RLHcbQSwLvPmpG2AKMed2CbQopIG8K6ybPJPo04L+c3vVVLM7vQ5w1dSvE5XDPuOr38gdkXD2OkQuOuYPJuTE2+gh1YEOKoJPdrtAkVjSoiBCHtKRlguqaA7VajtR7vyo/J5RB3MAe+Zc1ggwjtWuiFfSJkH43lza1UAikrG0WeMmRjzBfyz4nKFWQdkkNUc4aeOBWyl2r8hY2ugrjM/Aj6FXLV7DriwFXraw/y8f9JqfhO9Yi6plrNZ5GIuXftxf3EmYzLTMDTTdd3saWyA/K7JM1WqwM+CUFplE5xKoPi3+tIl+e4cY5KqETQn0Vx14RgIjPy+Ajuu2gTnAqB1D+9JX23unRaFCVz0I3nmh4KfHu8kLE2aFD1j1+HRasRnHik5o9g9v5Wgzns6HETp33FZoOotQ7AIDSV9AQ91VMnBm3nyHXKmxSgaKKK5uSvY0JjGE/CVhUYS7GInjj5ws9Wf5RUpvUTRWbpuT2HXifgurSKqTFqfKmOFRij0cIFdEbx7npYXNKYkN5wFcr0Ww7e2XGej6ZvVgTphgfetOegn2ZbzBc6IdWDnV+AhEA4nz4ntnqJr4NliRTNBxU2yvc9U4QZ2c9wW8KGJSGAlLo1Ki81w2OMYKbqqRrNEwIjUNthlGO+2ae1DabzoykDRuW4o504ozZw3eN5uyPIXvS3XyE7M9OiijAbH74RYv5X8fHTqin+RvSpiMFu3e/C2p3p+8L50aJ10Y3I5btQRcOPth47v8FAjFqp5ljpMM6MPoFSLA4s6Vx21urSkVWmTnMvNogkTM8dwxemyhMKSY/hScxPi7VtCfBahCmieX93AZQqiM9lzlMYF/3fMHV+gYBKJeJfKdhJ5W0sIAGiKH6KGfOWL1Q==,iv:wZNsy6ofjXM7OrJG8OOifY6Ux83FG1yxkkApyqKjhOo=,tag:lPHTpDpH75pbLRRbCDv/oQ==,type:str]
    key: ""
  discovery:
    enabled: true
    registries:
      kubernetes:
        disabled: false
      service:
        disabled: true
sops:
  kms: []
  gcp_kms: []
  azure_kv: []
  hc_vault: []
  age:
    - recipient: age1jwm8ccjgfy04r9rwh65rehk72j6rkawkpjnf4rcu4ukwlcfyquhq4p2q23
      enc: |
        -----BEGIN AGE ENCRYPTED FILE-----
        YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBSTldRSWtFM1A5ZHIwdE45
        YUZOQkZETmNpZTRoTDZyVThNWXg5c3VKbkRjCk9kckpONUVnaEZvV1JtbUVuckpj
        L2ZEUVcxaDZ1Wm1QYTlLNVN5Q2tUaGsKLS0tIC9qdTE5N2tyeitvZTNyU0FwVmx6
        OWp1RE1Ud2N1UFBxM290VUhBY2NMVEEK6wwZ69EtekFFrRziHWLD0aQFBZpfNsYY
        3nh/0Hqy6W9qvPnmXRFhRfRt2wFQDngi5p9SUyrXTutBP77AG0Eh8A==
        -----END AGE ENCRYPTED FILE-----
  lastmodified: "2025-01-31T04:22:07Z"
  mac: ENC[AES256_GCM,data:/mlerYcUpLedlaQBB9+wjU+ODK8+FTGPAiQRhqlMaY9ScIo3SkLLDTrRKIWtGhchv9KgB33gSG+u7K/1Xc8DKAE1HaYyTTT1kUPnjZew1UI2KYUDY1aLDu37aGlu/vV+LRvgNprhbIRoroniXMHjeT8U9mjAfMHOo8+9l+K4EGI=,iv:vrBEYn9ZZHvLhw9WC5DvI20KIUiTwGHAlJPXWc1vKlQ=,tag:cmcK9uynH/l9wxIPkH+smg==,type:str]
  pgp: []
  encrypted_regex: ^(token|crt|key|id|secret|secretboxEncryptionSecret|ca)$
  mac_only_encrypted: true
  version: 3.9.3
