version: v1alpha1
debug: false
persist: true
machine:
  type: worker
  token: ENC[AES256_GCM,data:lTSkuFy0WPPMlJisNexTdx3EZMokGGc=,iv:+u1Ijk0noo0zIUOblBWs5Gz5NA5dvT4AFaQ2pk6zGi8=,tag:avv2Sn+2a7jGa8rs58faTw==,type:str]
  ca:
    crt: ENC[AES256_GCM,data:I3XNzQV0b8toU7LQ36E3kUrjwBulbqkzXBKNwHtk2i+pgsYZRstr+MYfg6e98lal9+DKn4WDQc8lDpzXRqV9gd6k9PcprGEx/Mhvp60PLUpB7AnbIUu/Ahdu+s6pMCKANua5vM6nJ2ZGmMqU880qc+ljeFlgkCNVTi3xkb1HyNznpCD2BsN78lA8/rJmYeS//5Da+qdFXAJj2z72x+PxLmUf/0+UFWjXSC1IHtianzqTC/IRTrCT0DLImaHcx0PCJllXqip+Hymkrz1RpZlmPF5ZwDLwHnBH4+b+Bj3u960cDRft2IEgpRIjMWQ7evqaN4JTvZYTjTWY7m9AkVmYaL5ZgRmtn5ztzWojmg9hkQwRlCDr6wFtLp94XIYIKJcS925FNcxuD58kAissK63DeFZWybad//Zj9LqfkI6XfXSZBYe12ppH3Q42zXKxfUEtl0mVGaKobXUETGzmarKNzv+BdVkOiVWuvCTAJU8FL5VbxfIM3MmbSaUajYeoaP/bV35HVOTHVCd7RjUZBGOzGnJUBY1UyZ0//6ueMwAp3XRwRNdXxjZV95PDD/vSN60EU2F2L+4nC0uU7qWxESA7GZXLPySbaMHShuZxajhyu4u8d46V6qsj108LolHpGYYHf28Mt2VjIMsbcaE+kaNaM9D/PQcc0PSx+kn4Ar3M45Mtez6d887tE22c0T0CxNp+P+A/qbobim8CVJanNuZyp2nRQe7NaAmXIXBfgc9wFJsnnPafiEVa8dibIEBRtRGGDwI+aLf19KeBGWVxpl1jzxfUbxh+fzAfFY9DxX5k8RBHO27m6cX0vCQaRb+BPn+Mal5GR0F5XIwYvLxuVgBTHcN8EtavQpY+n4Loc4/1ZLlulCJ7,iv:wrv+4urMdNLA9Yu+q6vcmJDrTxcI/HLID1Ora2EcSqs=,tag:+8PXo5RWzBr1XHX8nbvwJA==,type:str]
    key: ""
  certSANs:
    - 127.0.0.1
    - 10.1.20.120
  kubelet:
    image: ghcr.io/siderolabs/kubelet:v1.32.2
    extraMounts:
      - destination: /var/openebs/local
        type: bind
        source: /var/openebs/local
        options:
          - bind
          - rshared
          - rw
    extraConfig:
      maxPods: 150
      serializeImagePulls: false
    defaultRuntimeSeccompProfileEnabled: true
    nodeIP:
      validSubnets:
        - 10.1.20.0/24
    disableManifestsDirectory: true
  network:
    hostname: k8s-3
    interfaces:
      - deviceSelector:
          hardwareAddr: ac:e2:d3:10:d8:25
        addresses:
          - 10.1.20.13/24
        routes:
          - network: 0.0.0.0/0
            gateway: 10.1.20.1
        mtu: 1500
        dhcp: false
    nameservers:
      - 10.1.20.43
      - 10.1.20.1
    disableSearchDomain: true
  install:
    disk: /dev/nvme0n1
    image: factory.talos.dev/installer/a0b4991356a74f14e884e8b9192ac3864397894fa5223317098564de42ce0a0f:v1.9.4
    wipe: false
  files:
    - op: create
      path: /etc/cri/conf.d/20-customization.part
      content: |
        [plugins."io.containerd.cri.v1.images"]
          discard_unpacked_layers = false
    - op: overwrite
      path: /etc/nfsmount.conf
      permissions: 420
      content: |
        [ NFSMount_Global_Options ]
        nfsvers=4.2
        hard=True
        nconnect=16
        noatime=True
  time:
    disabled: false
    servers:
      - 10.1.20.1
  sysctls:
    fs.inotify.max_user_instances: "8192"
    fs.inotify.max_user_watches: "1048576"
    net.core.rmem_max: "7500000"
    net.core.wmem_max: "7500000"
  features:
    rbac: true
    stableHostname: true
    apidCheckExtKeyUsage: true
    diskQuotaSupport: true
    kubePrism:
      enabled: true
      port: 7445
    hostDNS:
      enabled: true
      forwardKubeDNSToHost: true
  udev:
    rules:
      # Thunderbolt
      - ACTION=="add", SUBSYSTEM=="thunderbolt", ATTR{authorized}=="0", ATTR{authorized}="1"
      # Coral TPU
      - SUBSYSTEM=="apex", KERNEL=="apex*", GROUP="44", MODE="0660"
      # Intel GPU
      - SUBSYSTEM=="drm", KERNEL=="renderD*", GROUP="44", MODE="0660"
  nodeLabels:
    intel.feature.node.kubernetes.io/gpu: "true"
    topology.kubernetes.io/region: main
    topology.kubernetes.io/zone: w
cluster:
  id: ENC[AES256_GCM,data:MJzu1qeKYR3lJ99P5ONT7Kfi8W/4I+5g34cAEn3XwOEi9MTMfsYbkHQ6uJA=,iv:wdPh5NyvX1/DTFIg8+ZICt6oRoDipwvE9YdiAzet5PY=,tag:G9YQzFTuewqUuLlgWlYcNA==,type:str]
  secret: ENC[AES256_GCM,data:xNCPKvCEVv53mlQUP46TKAH6sYsps7RfmkLQKUKbfmpM+cxW8xenxUxnLPY=,iv:N7K7UZ2jCZTslQeFANHOdHpYH+bMmD+VF23ksP/lemA=,tag:7IbocHd+N5r3YuqC6LpaWQ==,type:str]
  controlPlane:
    endpoint: https://10.1.20.120:6443
  clusterName: main
  network:
    cni:
      name: none
    dnsDomain: cluster.local
    podSubnets:
      - 10.42.0.0/16
    serviceSubnets:
      - 10.43.0.0/16
  coreDNS:
    disabled: true
  extraManifests:
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_alertmanagerconfigs.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_alertmanagers.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_podmonitors.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_probes.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_prometheusagents.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_prometheuses.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_prometheusrules.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_scrapeconfigs.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_servicemonitors.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_thanosrulers.yaml
  token: ENC[AES256_GCM,data:QMkVtZ8kJMN1Ycca9oa7kPXEC7QPsgo=,iv:YG8PseF04s1IXbssvHtx3q12RbCvbmLmznNzhI5zkRI=,tag:bqOy44dry80vzwpG2kDyFA==,type:str]
  ca:
    crt: ENC[AES256_GCM,data:LY59Q9yYPzkVFGIE5CPdWdBCcN9fzpcqZdJIw0dkT5iTpgneGmXbmJ69nJdeR0YQuNTSpCnCaztJrbkj9wPFwtF414p/LkjBY7IUQgeS2iJGxLTza/RNXRxMuMozgT2MD0iBPg7tryrxx6zEW2cwGIV88589XM7rXyXV0b55SZadJTaCk9/+lWK2x4RginRWsy0I1V7k0Yt3LVq/hq8wt2yhNomcd8ywzZR2eVTQUCdjx+Z1KQJaa3JWWtxMxETkj13Wkkg5bYz+02xvq5bOZvq2XV8ViIAnwExDIPAODOXYb7KAHvh02wNsIrbs3K+yYR3BSkyI7VruqiUw30Ul0tvHukxJZfkeCwH2ZShDjR0oD938Vbaq88zNo4xyZZoMCl3IlBP6mTIUa0r1xDclcbM9LvypRf/d7MlBlD/Rj22QRfZJ1Xsd+4HF+wuEzQN8IHY6u286l3+oy/lcFDHUNadesOZcs9nsLIzcaeiV3RlPRNsRZyNxiRpGXv9Fu4Yrl10YHnqkOz7gSLfYZdNrTxAPftNjFrdtvzE7zQKtHQqTT5+Rkqtg6hNOGaso5uOWETA9WGopscS9qKwPpZUyjOZXsGuNtvs9qt8SLURMMpKuzyajA0MwAx4VtvBLs8lRmQtK0qh/oh8RiBxeg0ikJsiayeIADcBgupvyR4rxs1YppLNXYF44dA6vPMQzESD9MmyyKCbxdjS8583oGHvYKPD50Ww4uvqXoFYCSBMgltkVzmuERAGX98SvKZyHe5emIAwmFAcSqopyoP4oJ7byZ1SH84lpaZ1DjsYtxAqfOvtG0TCMKHAimvgbpcG+4ewM8XplqF9UpQWTrUHarRNVTOHLHjDwQTcWc7OXdULu0F/4OxYNIgZlbnQ4Djiz11jByO+a6YhM+jWth21uCG5cGNucFavrM/AkIs1o7JuXZYmsFjF4aBR+F0iwZaZraPiAkUp44kqxllGnCeKq5eWgo+JAwRVaobh1wrZANWow0sD8t1VN2OrmJWlwjUIgLwvgX7bhFTZCvyaesglTZccHwpgucE5lVzc1sr6W/w==,iv:IGfJ+oBPR6DqaXe8xaPm+ZB+d25bHIQHuThbg/ooWTs=,tag:HVyib1CQoEYx1BokbuQJeA==,type:str]
    key: ""
  discovery:
    enabled: true
    registries:
      kubernetes:
        disabled: true
      service: {}
sops:
  kms: []
  gcp_kms: []
  azure_kv: []
  hc_vault: []
  age:
    - recipient: age109xxk5j8q09kprdd5wta9fw7nwpz8t95phq49eclrefjy3zjncmqa9lgtk
      enc: |
        -----BEGIN AGE ENCRYPTED FILE-----
        YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBQaTJ5WE1ZZjQxNW93TWVy
        aEpyeDVkcEI0ZDR3VUFpUUFVRlBnbzAxN1hrCnBFWDRLV0VLcnVCdWR5Vi9NMGhO
        LzMyNGtsWE5mZm42MDI1d1huZndia0kKLS0tIC9XWUZWOXVYOGZRSVI4R2hmU0lr
        ZmFndTd2SGc1WFMvT3BkZmJhOGw3VU0KTdJzr2H1eapdfkCLBUXZOJJ4jc+lN8WY
        VCvNoWE6bMbKneWHpvTmtK+5aXbfSk5kOD1dbGjEo/QMBGonLZelWg==
        -----END AGE ENCRYPTED FILE-----
  lastmodified: "2025-03-12T21:03:42Z"
  mac: ENC[AES256_GCM,data:foWVOcRwl88UGyI7C115NDGy9YfzaBxi0RiPxOcnLx77xbPzZoIUPnnbJWgtT9/d8Iu2sU8u119IvFOBuogTr5cShKJ4u70q6Lye0504FGu2hdClB3uTRlJXq5mbMCfNNAQJyrRnXsMNyfsRGqWUNHYz4vDxUaPT8RqG871CIwE=,iv:52N9N5Nv7RYQcy58J8Y/cYwGUoXbOAXkk37HO62R5AQ=,tag:NuY/G1CklE+iqqMR3A0WLQ==,type:str]
  pgp: []
  encrypted_regex: ^(token|crt|key|id|secret|secretboxEncryptionSecret|ca)$
  mac_only_encrypted: true
  version: 3.9.4
