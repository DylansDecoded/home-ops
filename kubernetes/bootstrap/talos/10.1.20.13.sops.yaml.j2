version: v1alpha1
debug: false
persist: true
machine:
  type: worker
  token: ENC[AES256_GCM,data:2edNTNiMBnYxy+u01229lOOu3yiNfnA=,iv:vqAGfivfdc2nxGXk7Bs/5gE5MXpM1bzAxD0ajQDeRdU=,tag:fHaHAkWJsX3mbHYdDNaP/Q==,type:str]
  ca:
    crt: ENC[AES256_GCM,data:3dzJh0g3njZXMOE//wa89ep/45hpG8sbjXD7UUxiVXTL9qQak50oU8i6agjOSGzjk3dz8+S4Amzrtl0fNLoapV7UfGwYXz/whmgrVCC/rBxjGojBWk4gBmcWg2XwZbTByZnYuD/LxsruSBq3Kxp3LzQLxga3VgChncABDfYmawV+mZ3pechynXAYrgA+gG9iAIj9+ylVfgP9fctWV3GutL6xH3+xOS1D0Bvu+aadiMnBiwPkju4XPJug+g0TBnB0XlJFWKVmMPDcNheSv39wc9ICkHHu8mG/byn5HsDzCITppFz9ZPGMSTtrDZuPibdft15cXGazy+K6F8qQwwXrS1PZaNLz7WWBZAvENcds/LR0PriZtHdzEI26L212YhIkHoIP/uSiTCrilLSXZSeBfOZ+ikpsltW8tyCEiZ00aIzDSy/vH31+zybFKVLBuAiZU+KOXtGy0kcPez+sdyx+S2TLU8y6Jn/d673MSM1Jjpaux0qtbDf2xfNtfciAUh+e2Bm4Abp57nP8pBFzcQqTgomwQr/Q45GZUF+ufk4LMnLcKxq5Nz5rHZ7e3CKY7cM5qeKcWjjAa8umqL+/lNHbBzgA1nSOBj9uHSYiAzT2fucVh7GAvEIa1irpWxJ0p9PNmo8nKUIBQJqpJQTaAEi6vdRotD7vib7L2Y+p03mqoBAPVDPn3R31/rNWf1riAbzRApeKye6kjqM5TsSJ8wLgSMNEofCyHd7n6GFhM/Ga2zuCWr0rquKCUMC0qSNaWWI0+MLB3Uas7c3EId9/kPxEppvlxvDmt5kKdjjZ7iWx0oXBP4M5pGkqRJQ7BcD1vxnIyIUNuVOlfqtqhpREbY1EzrP610QqrZknrX/+8odN4agqB5qk,iv:/BeFQv1h725p7hhjHXAIAoPtNh6XbQ28+X/cKCKTfrw=,tag:dC5k+/ATZfcYVsjlvnqrWw==,type:str]
    key: ""
  certSANs:
    - 127.0.0.1
    - 10.1.20.120
  kubelet:
    image: ghcr.io/siderolabs/kubelet:v1.32.2
    extraMounts:
      - destination: /var/openebs/local
        type: bind
        source: /var/openebs/local
        options:
          - bind
          - rshared
          - rw
    extraConfig:
      maxPods: 150
      serializeImagePulls: false
    defaultRuntimeSeccompProfileEnabled: true
    nodeIP:
      validSubnets:
        - 10.1.20.0/24
    disableManifestsDirectory: true
  network:
    hostname: k8s-3
    interfaces:
      - deviceSelector:
          hardwareAddr: ac:e2:d3:10:d8:25
        addresses:
          - 10.1.20.13/24
        routes:
          - network: 0.0.0.0/0
            gateway: 10.1.20.1
        mtu: 1500
        dhcp: false
    nameservers:
      - 10.1.20.43
      - 10.1.20.1
    disableSearchDomain: true
  install:
    disk: /dev/nvme0n1
    image: factory.talos.dev/installer/a0b4991356a74f14e884e8b9192ac3864397894fa5223317098564de42ce0a0f:v1.9.4
    wipe: false
  files:
    - op: create
      path: /etc/cri/conf.d/20-customization.part
      content: |
        [plugins."io.containerd.cri.v1.images"]
          discard_unpacked_layers = false
    - op: overwrite
      path: /etc/nfsmount.conf
      permissions: 420
      content: |
        [ NFSMount_Global_Options ]
        nfsvers=4.2
        hard=True
        nconnect=16
        noatime=True
  time:
    disabled: false
    servers:
      - 10.1.20.1
  sysctls:
    fs.inotify.max_user_instances: "8192"
    fs.inotify.max_user_watches: "1048576"
    net.core.rmem_max: "7500000"
    net.core.wmem_max: "7500000"
  features:
    rbac: true
    stableHostname: true
    apidCheckExtKeyUsage: true
    diskQuotaSupport: true
    kubePrism:
      enabled: true
      port: 7445
    hostDNS:
      enabled: true
      forwardKubeDNSToHost: true
  udev:
    rules:
      # Thunderbolt
      - ACTION=="add", SUBSYSTEM=="thunderbolt", ATTR{authorized}=="0", ATTR{authorized}="1"
      # Coral TPU
      - SUBSYSTEM=="apex", KERNEL=="apex*", GROUP="44", MODE="0660"
      # Intel GPU
      - SUBSYSTEM=="drm", KERNEL=="renderD*", GROUP="44", MODE="0660"
  nodeLabels:
    intel.feature.node.kubernetes.io/gpu: "true"
    topology.kubernetes.io/region: main
    topology.kubernetes.io/zone: w
cluster:
  id: ENC[AES256_GCM,data:EUx+IxrPN29uzjZpM7lc9K8dYp/Aib5qQPiivIBFSy44pDJ+xrMYcxerITU=,iv:LbBMT58Pgsgex1Z8rOiTdzvB2IHihPGAbJsbFv0pggY=,tag:tgyNroxzLli/mwWTX4MINQ==,type:str]
  secret: ENC[AES256_GCM,data:32aQ846mGg+Kz/BaYdUN4cKO7vl+n7IGaY2EsB1iz4NYK8/UP5z/biN5II4=,iv:VqJJ7vAkBb39Ph0Jvvh5MA6E6pNm/o6ghAKveEpofn0=,tag:OPNeSr4yK125+pUeO2Wtsw==,type:str]
  controlPlane:
    endpoint: https://10.1.20.120:6443
  clusterName: main
  network:
    cni:
      name: none
    dnsDomain: cluster.local
    podSubnets:
      - 10.42.0.0/16
    serviceSubnets:
      - 10.43.0.0/16
  coreDNS:
    disabled: true
  extraManifests:
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_alertmanagerconfigs.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_alertmanagers.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_podmonitors.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_probes.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_prometheusagents.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_prometheuses.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_prometheusrules.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_scrapeconfigs.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_servicemonitors.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_thanosrulers.yaml
  token: ENC[AES256_GCM,data:UIOeOav3W25Vn6S3gnxkm7TFt04Jv2U=,iv:N5uPYheYIw/c7izNbgj5XS4h/gs/VssxxB37ZHVAyjc=,tag:te4Fk+s23/uLR7ZSe+FubA==,type:str]
  ca:
    crt: ENC[AES256_GCM,data:3RHye3j8w/4CGUkKnUBB5Yev6NQo7UuJLuQFo/Ls+u7ig7kmshgd09+PVmJB6X5+hF8VgvSzW2QELvj8HJJEo3Zamng6y4YLkEI8BPcMlLV2OoczpkzyULKa4O1iuCeDjTxycVHIU2mcznFqELq2PTS+lypLNKHUxvF0S1G5pL6PL85ojjiMy0VMoDv0zJ7Sh7jcYG4JEHDnD0vg7/QGoHFmHYlki8gwEin55iIAUIwBKaOrMLQ2hCJOfLzrp5e8g5Jnh4RW4RpgXfVahqP+E9BF2WXRizdn2IF7Ew7wJSNPTAvNkaYOgB0QNa5PJbV3V4Gsp5zyFJZ8qkRfuNCd4IwSxUB0YXIvmU5rFmUjwsXCNin8UbanbwKigp478ufYgCXLVWGQBegYUrPM5YoXhLPy888Ecpmfl7RACFecWDVHul4Xw4bNPX5z0jfuhPDI3ziuHMtvRmwWvo7oUQJidSy21rym68qxnZsPJiir4d53d3fLAZCvunfoDtvIgIGFfSOlF6T58M22/wKWAlhKCOapQy0iAcrtivvDeXQ3SXJw4HDsyIsvoEeRxCVhtoPsMBfQQz7trlHcDumkr0+YYNU3zXUfcsirL3Dc38Kz6zaY03P9WJvK23gtkvc2RlYfwg2n+zEuK1KaMgGtCISTk30xUkqFQvpZiPn9ExOmNrNxjNswgN2zIoIe4P3aQRUYtr3ZQAvIcSkIC6pGBmhhA568BQfiQf93Ne+NXe3tKEoBbcyKz1xsP+b46wPlN8H2jvw9bZOd4id8B/f3xFGoUcfzhcjJLI+HdlF8+122r5iVupeMtcP+HY8ccn/KXe0plB7UH2sJIlwo/rO5uzDmLgCj2QvVA6rnsdHTOcSuxOdGW3CcF1gALfsStQMLMAEgi3Or9Amzpq8uz5y6IHnD8gkC8RfsOZem0G5z+AR4+iOs9AB775iYihdJH0uMi9Jtt/jBhi5o1WqD86N2HYE7EwpsP/F57EmfdxK6kkZx7qjXRVqma7IzQKxSmB8m/+fEBNmdaKB9yt+zuRoRtE98bVUdOrn7XKG4capprQ==,iv:aXyZ+wG/LHk9PP9BtrrLFR+iVjgR3Kx1XU9DqKKUt4E=,tag:QH/t8BCwKvHR+F97zwbFtw==,type:str]
    key: ""
  discovery:
    enabled: true
    registries:
      kubernetes:
        disabled: true
      service: {}
sops:
  kms: []
  gcp_kms: []
  azure_kv: []
  hc_vault: []
  age:
    - recipient: age1jwm8ccjgfy04r9rwh65rehk72j6rkawkpjnf4rcu4ukwlcfyquhq4p2q23
      enc: |
        -----BEGIN AGE ENCRYPTED FILE-----
        YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBKNi9DY0FONUxqcjBhamFz
        Sy9LaTdqVFVEVmlkd2t1WEhEM0o3bG8yanpNCmgrMVhjbFlzc3VVc0ZBNENGQ0po
        NkFqREdmeUN0c24yU0J1a3RISU81eGcKLS0tIFUyY0NoOFM0RGljRlkvYlpObHBY
        Z0FQRUJOZDdjb0pvdXZRMXpibmhVU0kKZmGW1EN/ZNgIeUTpm9b9GhQPysDTUDpc
        0fRoUKQH8U6Y6VYbFIB/C34/q3uB0oPWCcGvEWgeE/7jnvuJsnRG7A==
        -----END AGE ENCRYPTED FILE-----
  lastmodified: "2025-03-12T20:26:55Z"
  mac: ENC[AES256_GCM,data:xJZiPGKwG0XprUTzum0SyIbMSDtpzA/XA8uIsQFoueG1OfLvkiv/8wtTRZCUtAMiArTv+2pGkUMDbk1HPdLo0mJFf0d6TWShEU+ktSQg9bG0JJf32c6Q3kqgnF0TrEOzhQpQmVxMbDRE5EOdOw6sJ1aHq2i/Zoft1nBy4K7XU0U=,iv:sGd5UHA5A2Pu2N0YP5Lc3zpjmSLH8mLHoXvWNOH+JuU=,tag:dPcqSnajhsgCUDzgFSWidg==,type:str]
  pgp: []
  encrypted_regex: ^(token|crt|key|id|secret|secretboxEncryptionSecret|ca)$
  mac_only_encrypted: true
  version: 3.9.4
