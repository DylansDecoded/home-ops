version: v1alpha1
debug: false
persist: true
machine:
  type: worker
  token: ENC[AES256_GCM,data:R3KectdxKOY4Z5lDlfZ4mRvkJekBxlw=,iv:rq/7TEJm9n+M98m6xLjDp3g/MZTAX1hoGu42gpqFYOs=,tag:bBs7bM91I+4jODAe5kBFkg==,type:str]
  ca:
    crt: ENC[AES256_GCM,data:md/76gjMtpVyijaPYQDc8opTEPpZEApfBzOkm96g72Fi8Ym8P9dW3orz8N+eUFGZ4ZBYPSVGkH/6oGNJjkZ349h8bGhCMzzfSQGRJTKATq2arJ8anbbdhNuRbxd1gOvQJnHQRhNX9NORxnyIcgMquHpbUMhHQWkupvqjb5v6m6OTpZvBGP0LECgv6s0g08g/q3ONypjtLXKefy+5QhOLCJli/uVuAcNyqSj6tCb7Fa7L12zvoEvJpgHTL9Gc76sqPo5YpZJwUeKGRQ+JCf4UivgaQiTmAo65AaOApdljqHJAsvbqIqjmFHvAfY/JT+z9HgxPl1wWMoqFJbdZJiXjIGyrFY5LlH4rlkesVBp22wMaqh3l9XVg5OadVfgp9EwKKbhBqb7THduaGSEzci5n1PoF18/1CjthRfXMx+i5kRpy5yGCbbZCWdViMzUO1gC90Hx3l4aQL24cv307FOA4xuOH386AY1JlT5G/nzO39krAYY24HUoPG6dge9lPHeFds5aY7UxYsudvvg+fKjmbJJgjlQo/39X4LS0pbSIJyRfBpbpPOLuJ5/wLvGbP/mDGiBg2fV0yF7g+GhKhg3Ggc1CoS9zMXug6cWjmhR47DTz0mhhAEBgUzVQK2f/gl6jUqiRfiNCpwDM2oyzawrRd+nf3kGyDCDHcA5C61SSw4FL4ymsl51ein/PR6GPhs95uITgjVEq+Yr6PZWfCrjTKat7DEHj6J+YdH8P2AdTiAX0xpwwAzDyRizxwO7Nvmwh5Pk1yhbRZGCablUld/NZqQMv3LDifQYQOO1qP41kk1967SwUjLrBIwosQAUfOu7uZZ5pWMT3o5gxGv4rmEGrACxAX4yUor3TILGDbSRdYd9pdpT2Q,iv:5poEcvv3oYhTQ7s9GwJHRz+vRpFy2z2bzTSjQjfRxbw=,tag:FiQX4lsa7AnrMxZMjXgamA==,type:str]
    key: ""
  certSANs:
    - 10.1.20.120
    - k8s.robsonhome.cloud
    - 127.0.0.1
  kubelet:
    image: ghcr.io/siderolabs/kubelet:{{ ENV.KUBERNETES_VERSION }}
    extraMounts:
      - destination: /var/openebs/local
        type: bind
        source: /var/openebs/local
        options:
          - bind
          - rshared
          - rw
    extraConfig:
      maxPods: 150
    defaultRuntimeSeccompProfileEnabled: true
    nodeIP:
      validSubnets:
        - 10.1.20.0/24
    disableManifestsDirectory: true
  network:
    hostname: k8s-3
    interfaces:
      - deviceSelector:
          hardwareAddr: ac:e2:d3:10:d8:25
        vlans:
          - routes: []
            dhcp: true
            vlanId: 40
            mtu: 1500
            dhcpOptions:
              routeMetric: 4096
        mtu: 9000
        dhcp: true
    nameservers:
      - 10.1.20.43
      - 10.1.20.1
    disableSearchDomain: true
  install:
    disk: /dev/nvme0n1
    extraKernelArgs:
      - apparmor=0
      - init_on_alloc=0
      - init_on_free=0
      - intel_iommu=on
      - iommu=pt
      - mitigations=off
      - security=none
      - net.ifnames=0
    image: factory.talos.dev/installer/520de4225301b3fd080dfa5613482544286ae7a379ccd0744a375799d25bd5fa:v1.9.3
    wipe: false
  files:
    - op: create
      path: /etc/cri/conf.d/20-customization.part
      content: |
        [plugins."io.containerd.cri.v1.images"]
          discard_unpacked_layers = false
    - op: overwrite
      path: /etc/nfsmount.conf
      permissions: 420
      content: |
        [ NFSMount_Global_Options ]
        nfsvers=4.2
        hard=True
        nconnect=16
        noatime=True
  time:
    disabled: false
    servers:
      - 10.1.20.1
  sysctls:
    fs.inotify.max_user_instances: "8192"
    fs.inotify.max_user_watches: "1048576"
    net.core.rmem_max: "7500000"
    net.core.wmem_max: "7500000"
  sysfs:
    devices.system.cpu.cpu0.cpufreq.energy_performance_preference: balance_performance
    devices.system.cpu.cpu1.cpufreq.energy_performance_preference: balance_performance
    devices.system.cpu.cpu2.cpufreq.energy_performance_preference: balance_performance
    devices.system.cpu.cpu3.cpufreq.energy_performance_preference: balance_performance
    devices.system.cpu.intel_pstate.hwp_dynamic_boost: "1"
  features:
    rbac: true
    stableHostname: true
    apidCheckExtKeyUsage: true
    diskQuotaSupport: true
    kubePrism:
      enabled: true
      port: 7445
    hostDNS:
      enabled: true
      forwardKubeDNSToHost: false
      resolveMemberNames: true
  udev:
    rules:
      - ACTION=="add", SUBSYSTEM=="thunderbolt", ATTR{authorized}=="0", ATTR{authorized}="1"
      - SUBSYSTEM=="apex", KERNEL=="apex*", GROUP="44", MODE="0660"
      - SUBSYSTEM=="drm", KERNEL=="renderD*", GROUP="44", MODE="0660"
  nodeLabels:
    topology.kubernetes.io/region: main
    topology.kubernetes.io/zone: m
cluster:
  id: ENC[AES256_GCM,data:kXTBeGPzMJLRc48rTyQSarPvHY/H9hUcVRjzu85Zi/OdsNypBMW5yqMoL/Q=,iv:Zt79BVHBQtGZY+RpauNlIfRLMRnQ4ZI5oVUj2dOFCWg=,tag:1yLlDKeEbPn2lITpPTrg3A==,type:str]
  secret: ENC[AES256_GCM,data:eS6EmUzIyHt2Y3lu3nUMz4w/0NHYKF/Uc3+SzBWBI3866BoiqIAw0/aVAoA=,iv:vS+Fj9ySBtjDZhiZ/M1k4ET7NLjV03YCIGeW48uKmmM=,tag:HBPKw5wWEulnZnRwcBZ29A==,type:str]
  controlPlane:
    endpoint: https://10.1.20.120:6443
  clusterName: homelab-ops
  network:
    cni:
      name: none
    dnsDomain: cluster.local
    podSubnets:
      - 10.42.0.0/16
    serviceSubnets:
      - 10.43.0.0/16
  token: ENC[AES256_GCM,data:CPNpVdnHpNfL5P2SPzeEt6GLv2Q/OAs=,iv:TmQuLq4HhkPW/nnasOiluSfMogF7XB+ephr81uFfrNo=,tag:bFd/oP/lggdk5JAgIFBHIw==,type:str]
  ca:
    crt: ENC[AES256_GCM,data:jdOXe3x8yxKADRwtSFNIrrVpvAjl213U0cewL4ihpHVC/zPDeyeoIz/yKOQFLhaD0GuNM0xpsxOwHQ6c2Y7jBunF2/xCzmXuOGTqnwKEjipJzvzFY2aqp1h2tb/YXo8x4ZsL9A5MYsMoBBDKFqlkE/MnU39By7Isa6aoH2imoz17PzEYeIfgo2ZUT9f9SojJHmBUoUj0C9YNrOTqGwGecIIn7zB9pCmKry7HBTzt+/TzoDyMb+8XMOloZx0BTfeUijPyfwFk2SysbZWHFVajstNSr0yYsImzX5MpjxZQbwEybbTDHb1uwbuX7xq/5lxcGTQEuZBBanmpca6WKQXcrnBfOMXUt9AHRJRtY/4YpbTZlaqIOCu3il61adrwSZKz2UK4kgVdIN8Mn3hZ2NaEbjEZZqa656kRo5g9cxYqLsVx/3La7CXaaI5VX4Qo6enjSsvaZaPPbWL2Npv8r4fIHs5tnBge7vWoSJuHRZ5Qz2gaGNAMmglkiiDdr6LuW7wYSXt1TNcOsfFAVF50z/nWI52olL6zo7CFGSIcZbirq62QedbTJ5o/4Zetkj6x5u4RnxereFlrex8EorMdIbT+wvLbZkNw48bCdzANs6VAOzulfS4lx7UBaXpWOGoNuqgBBqMWFJZF4t5d64kQjQRxIqjEeC3jXq54CRb8nNKj4SlgzN/+PjcFmRuMQ5RObDnJYb1OwDcJ5zz6zWBnrlwBLY2eJSGjn65GUhuP0DVlPICnWOXOtedLyMA9gZvpXd2I3bC74mLmNzBc1APEN5chYSdLlrRgMi7rfSWnOBMLicqAIBpwQADsTkjpXRd+LzJ4VtgL3+oq2XSjeddJfCJNukSIBH260TuG9C6ZNVtHrD115ZZCENPmF09JDaqhtETtamN75mkn1wMnnb7SujdSv8YEMVqm1rNhgv/zMZtNKHOAG9Z5UYKpqbA+pAXAjfiCQpV3AjVelq77AkB7x+Z8WUxj4IfuPZCWJfTDDXWR0fl8Auf7aEn/IQ4sJZDcLcDjsomUOnNM4/I9ltgYbZmin+MVP6o=,iv:46KfeyJa9GVYtP3qfD3e2TN50FPBbBZL+71Ns2f9BsQ=,tag:hQW18LYNLVFjXjy3IyppEg==,type:str]
    key: ""
  discovery:
    enabled: true
    registries:
      kubernetes:
        disabled: true
      service: {}
sops:
  kms: []
  gcp_kms: []
  azure_kv: []
  hc_vault: []
  age:
    - recipient: age1jwm8ccjgfy04r9rwh65rehk72j6rkawkpjnf4rcu4ukwlcfyquhq4p2q23
      enc: |
        -----BEGIN AGE ENCRYPTED FILE-----
        YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBTaXpjT2NnREl3Zm85Ykgx
        MXdDeVppa3lwU2xHOS92NnMwTUJ4aExXR2pvCmVNSWc0ZzVNTTBhMklOWWZnblJE
        UWlqUmwwRkVUZ08weW9ZbzdpWWhMQ0EKLS0tIGRoRDc3Tjk1clB3V1NTWjFqLzkx
        dzZ6SFRhYk1oVUFKZWwzMkcxaGtvNDAKKcJBnJugaHl5Ohy2kOghH6aQeEKt51G7
        FSqgPw/PodnJjCy7gsMj9r82L/t9G0sD+HYHSa0EFj95AQptvE0KtA==
        -----END AGE ENCRYPTED FILE-----
  lastmodified: "2025-01-30T04:11:14Z"
  mac: ENC[AES256_GCM,data:/CRxY+XTu3qPAVIb2MiiX9aGqpgi1SiMI7zDmID1KoSVwQlmd57/j3uQ8Sxxsvl/J3a6svwqfWDCz1irIS0MfWtBJKnWTYEnUytLQPalqZM3l5X4erwng7N4q66rJuvGMVSZMew2r1six91LN0faEW9d+hV90UDowDJ9hFHUJ98=,iv:KCftwM8heMdv4PolmvtjoVyUpTwi07eB51Fbgn9Y0Jk=,tag:7Hso86s+GKROi2gqv8a5pw==,type:str]
  pgp: []
  encrypted_regex: ^(token|crt|key|id|secret|secretboxEncryptionSecret|ca)$
  mac_only_encrypted: true
  version: 3.9.3
