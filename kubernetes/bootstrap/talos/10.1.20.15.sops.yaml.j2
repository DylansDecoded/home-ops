version: v1alpha1
debug: false
persist: true
machine:
  type: worker
  token: ENC[AES256_GCM,data:FCQucIPdrbg/0Zlhme3er7N7eR6JUPU=,iv:XQXQ4lMvP97AWZh6sDM6xgHp96gkeOty6LCq94wgxUs=,tag:m/R0QV1DrAQjLtaq3sS3NQ==,type:str]
  ca:
    crt: ENC[AES256_GCM,data:hgekx91jUUMrBLvsS1gSON0nevRmvdCNE9GzuPpCkL+E0wbDivweNQeIYHd0SaGXVjAZSlzOcXKEuHm7rLlhou43FYiHB4z5+D2FSaap0KUIFIur3xc9C0v+8hCLByNEw2ku7Tf7rMGrUbMBt1pN7hkoTbPvYRgltkO1c0EiTujq/drgnAN5vc9gclMsKDxorzg6Iyk6INSRqad/bVt7YwaqzxAexFzTSvLensx3Az6G4Oen59fYMneCGm0Vi27Ve91aRMCpDQeVggsOzAEPqZWRJK0ZqGM5Z3JAA851qkIqBRcJR4r+lqoAzXJc/NCM9cELHddZ6N+WoPbc9+mUqdRBaLJSkeA0xVCaKt4qaWQlBvK/otudJYAXggHK1wZbNZe200Q/EspLqtWHx18JWJOITwvTI9pPS7gZUOUd2EwR+jSssIStPjwR/t+nzvv/5+lBoLMyACTEolJAz3HOtJDKbftrWjSC5bIpLxbmvFsDuJ4MQwgC5sQSgkyIzfyBIEEwlg9XcuVr3RCrgzJZa3dOr/Yfyk18KN8+aLzIClg0L252rw6TydpokrrcvWp/eSn3DLgoMAZnq6Upa2U9RGJaSOqQ1WmS+WmsSxZwNgLJlnnRKLxmPAcUINLST6izljT173JA2rx+hw87O0X4va2sKpFGddInoKthpw1I+9sxFeIQtJoEopESHuCoj/0MO3CQhVQ/IOjKB+5zv/OgR9CgOFNaYrFbYuMUf/4pvBNPyej7Xx5LKIMKSUDr9XRjAcRpVnG3j7sAABtpcS1SUrxvwoy4DqrZvzZlGXV1gplboDTUwgRP3lNXI5ifyHB0gLGNdzzTZv4cq3JrZIW/b9wUD91SEkqd7ptRwYQZQEFVwTiT,iv:IaLxMjl0qpYhK7ItL6zOs5G/lDbzz7jmRCX7s6k+9WU=,tag:9Do8vroH9MtUlPC97zra/w==,type:str]
    key: ""
  certSANs:
    - 10.1.20.120
    - k8s.robsonhome.cloud
    - 127.0.0.1
  kubelet:
    image: ghcr.io/siderolabs/kubelet:{{ ENV.KUBERNETES_VERSION }}
    extraMounts:
      - destination: /var/openebs/local
        type: bind
        source: /var/openebs/local
        options:
          - bind
          - rshared
          - rw
    extraConfig:
      maxPods: 150
    defaultRuntimeSeccompProfileEnabled: true
    nodeIP:
      validSubnets:
        - 10.1.20.0/24
    disableManifestsDirectory: true
  network:
    hostname: k8s-5
    interfaces:
      - deviceSelector:
          hardwareAddr: 10:62:e5:1a:80:18
        vlans:
          - routes: []
            dhcp: true
            vlanId: 40
            mtu: 1500
            dhcpOptions:
              routeMetric: 4096
        mtu: 9000
        dhcp: true
    nameservers:
      - 10.1.20.43
      - 10.1.20.1
    disableSearchDomain: true
  install:
    disk: /dev/nvme0n1
    extraKernelArgs:
      - apparmor=0
      - init_on_alloc=0
      - init_on_free=0
      - intel_iommu=on
      - iommu=pt
      - mitigations=off
      - security=none
      - net.ifnames=0
    image: factory.talos.dev/installer/520de4225301b3fd080dfa5613482544286ae7a379ccd0744a375799d25bd5fa:{{ ENV.TALOS_VERSION }}
    wipe: false
  files:
    - op: create
      path: /etc/cri/conf.d/20-customization.part
      content: |
        [plugins."io.containerd.cri.v1.images"]
          discard_unpacked_layers = false
    - op: overwrite
      path: /etc/nfsmount.conf
      permissions: 420
      content: |
        [ NFSMount_Global_Options ]
        nfsvers=4.2
        hard=True
        nconnect=16
        noatime=True
  time:
    disabled: false
    servers:
      - 162.159.200.1
      - 162.159.200.123
  sysctls:
    fs.inotify.max_user_instances: "8192"
    fs.inotify.max_user_watches: "1048576"
    net.core.rmem_max: "7500000"
    net.core.wmem_max: "7500000"
  sysfs:
    devices.system.cpu.cpu0.cpufreq.energy_performance_preference: balance_performance
    devices.system.cpu.cpu1.cpufreq.energy_performance_preference: balance_performance
    devices.system.cpu.cpu2.cpufreq.energy_performance_preference: balance_performance
    devices.system.cpu.cpu3.cpufreq.energy_performance_preference: balance_performance
    devices.system.cpu.intel_pstate.hwp_dynamic_boost: "1"
  features:
    rbac: true
    stableHostname: true
    apidCheckExtKeyUsage: true
    diskQuotaSupport: true
    kubePrism:
      enabled: true
      port: 7445
    hostDNS:
      enabled: true
      forwardKubeDNSToHost: false
      resolveMemberNames: true
  udev:
    rules:
      - ACTION=="add", SUBSYSTEM=="thunderbolt", ATTR{authorized}=="0", ATTR{authorized}="1"
      - SUBSYSTEM=="apex", KERNEL=="apex*", GROUP="44", MODE="0660"
      - SUBSYSTEM=="drm", KERNEL=="renderD*", GROUP="44", MODE="0660"
  nodeLabels:
    topology.kubernetes.io/region: main
    topology.kubernetes.io/zone: m
cluster:
  id: ENC[AES256_GCM,data:c9/kDvTRgv/dJaOYfagf9zaX69Q/QUG8/jKbRLrtk0YymgqCoY6QhbpYGGg=,iv:dlbZ7WoQ4eHVaDe11aHVjKYrYkuRnfIeM0uz8A9E75U=,tag:8ekiPtIYn4w8IUhEJuFOKA==,type:str]
  secret: ENC[AES256_GCM,data:Iu7hVIoZUQUztlX5+7Yq6KjNjImnYZvo0XhFI/dyjXiDgvTuoF68DEu2SvE=,iv:L+y9IP3flQdExZmTmbUFltJWTGgZh/HkwMomfg3jEzc=,tag:l3BDpNF302nz9dkOPZHEzA==,type:str]
  controlPlane:
    endpoint: https://10.1.20.120:6443
  clusterName: homelab-ops
  network:
    cni:
      name: none
    dnsDomain: cluster.local
    podSubnets:
      - 10.42.0.0/16
    serviceSubnets:
      - 10.43.0.0/16
  token: ENC[AES256_GCM,data:yHiGernG75KrFt6ldM7qaICg8XEM3Qo=,iv:YaWDu5fPc2kK6Ce/hrOeerB0iFkoPhP2oQA7u3qCUXU=,tag:EPONTAObI0F8JKWxaRFkBg==,type:str]
  ca:
    crt: ENC[AES256_GCM,data:T1jiklPSFNb1tXtjQRxy5ZOF3PgPZk09zikGebq4zSQ4nKrfM/EeX/u1Vc0HuRWnWxPpUwtXu86UM0S+XNI+1y4RG6wyBBbRFWcN+6Bg38BWuYxBxaOaUMOQh1YwPxQ9vsHSnSxrBgo/6TgOy26b3fcFJGq5aCyS0pHiFEUPVE2Tco3bnXJOQ1VXeMT1QZyxc2jqmAj705ih93J1fhpMybhwOZ1JpQaBZLqU625qUfhf2XV3VcR9ENpCpEJqf5gmivufVbUWaoYJiRPcjYMg4LOGyl0rA/l2OvlQonCe+yg57HxCBPgremrfwGJNIOajOoGp9vwYhnJMwKciYv095irU4g5t2QN2OdlZj+8r4MwSBIDnx9RR59ncuR8Og0/a9MQFRNyyfFUdkTYX4O4m9NhHjMoGnWek+hQ2cz2kVowEYNS//3R1Z5STmSt2h1bdzHw4Sly0yBJF1QkBryswsPfv01yNwM2y+pAvgWH5fCSPg7igxs/f51+deGrDlQGgmTNAS5th3ch+GyquRQDWAbKY1i4QQ9wlhvE8AdfSZZDJNIultXYL/B1p6wwxntMQmNW4ZhMIwMBwK1Clth7um7J408fIy/IjiuMEQtgSKbNOtltbK7pJ+wX/41dbvFjJbZq/qQqlABbFUC0T/K4MpXxgnkDrExq2BZ8a/lGeC+nC56mmi66ZFaHwD5jRsWXVlPzlHFoSASmIzvwPCvbltNpjsugYPMlbrJAI+VpApY0lu6yEK45sufKlDTmOM8wn2LZzJ1dKYRnn6yX8+LJ6kd7vyIHy+8xAuwm+2p6PeKkESpqCl3iOJzWhIbL1SJgGeo5uwuLUEaXs88Uyflw3bDlAyfSJCvz+vwQ2MoI+Prerc8XHQ+1FHpwt7ldHlfgp7wjw94vIg8kn5MUGLPTZcU85Cqse1A3/zBl5/Ov3MfnPgFHru7IVkYj2zn2a8mSEfTCGwHFcYXoFQ3ArJAG7K8YpJOe9r2QLlB1C6uYSxMWm8vcYmx/RumKZGxUZWy5CfCoZxTNi0fCszJHx6tBbkHJAqYo=,iv:nl+N1BgwRSCl5634YaNUK1hsB4d5Unsnk5zzVUH+V+w=,tag:+wEs0yRTgu/zR8026TD3QQ==,type:str]
    key: ""
  discovery:
    enabled: true
    registries:
      kubernetes:
        disabled: true
      service: {}
sops:
  kms: []
  gcp_kms: []
  azure_kv: []
  hc_vault: []
  age:
    - recipient: age1jwm8ccjgfy04r9rwh65rehk72j6rkawkpjnf4rcu4ukwlcfyquhq4p2q23
      enc: |
        -----BEGIN AGE ENCRYPTED FILE-----
        YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBnVEFLVXh4UVhJWVZpdzNz
        dlQ1L3BTdEZtQWFneG5yUFFwU1V4amd2TENRCnNLZFF5dWdRb1BlLzBQWWhObEtZ
        R1dVQ3AvSHo5bFphVWVPRnJOVlZnQUkKLS0tIE03blduL2V0b05ZRzVwRG9yU0NY
        ajltUVJ6V2I0c3A5eWVBdEtHcXJ2UXMK0zsKm7kXEsh/B7fEMMpTKz4HWQeIqaU1
        TeeF1VdMkvAn9esQAjHXD0zqZN8iAsoCDtvDip7E0S/1LQabJNUZBQ==
        -----END AGE ENCRYPTED FILE-----
  lastmodified: "2025-01-30T04:11:17Z"
  mac: ENC[AES256_GCM,data:qY1tkASHE44YWEHEwYtX6EijEXnpL1Sqmvuosrt9gNlqFDlq7yhrJABjkT7Qn8GuB1px0noQNpb7V9gWmX1Ba1/vLe0X0rk+iWWC6eeadE/kj+MRZ0g26GLuKaQNZeA22UgtiE16elswPR8/c8xclylLMzwrslsKUmdMo2cA7W4=,iv:jHpDOsDUdnypVXE2mcd6/Y/b6angKx3fjPV43aE9ZSs=,tag:QfPyp5zzkv4ySo2UkNI/8g==,type:str]
  pgp: []
  encrypted_regex: ^(token|crt|key|id|secret|secretboxEncryptionSecret|ca)$
  mac_only_encrypted: true
  version: 3.9.3
