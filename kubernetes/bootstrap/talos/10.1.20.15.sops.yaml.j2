version: v1alpha1
debug: false
persist: true
machine:
  type: worker
  token: ENC[AES256_GCM,data:ii/Cr2ZuI7VG0ArQp0AHSsozMMQi3L4=,iv:kEjLVmVgvLaJWY9uN4657Dn0ObTCm0k/1D3SJriPgiQ=,tag:rEFW5P+/8di+mUqzlQxqfw==,type:str]
  ca:
    crt: ENC[AES256_GCM,data:hQvFNP4K/H4+vRB022geG4Q4chKb6dhWd78u0uhKEQSIZVQfM/OsGuw0a6BIbK7kV8IUwUSsOTyfE011ZZf+vOzyu+ZFazA2Lw1/2WU7UPT+yObG/Up9YeB2NRB4Ri5basEs5vfZFRu9RB3ToJgqPRRolJl90sYHaJj4fj9WWEDgkFf/7udOm9uNmJ3ieNHFhNvdeuirJif35tAL/6ae9HzUUOz0er+WVKktTJRjOOLgkFLr1Irpj7wT9L3STzqUByuIyjumrs9wNM4knOladt/CI4t5l2ZisGmxmbz3ECQ792hvvZ8x7EBnpJejDTtb8fhMn1WFrvbyFFVP6pLPv5OtCyBUl3RmRIhng+4tncKHWxt5G6dESweU1QghJwVvbB+C0qF6yl8H1Z2Nn2090rWhQAsfq1rHKqWOVpcjUs5TrzwvsDIe9m8aPheGBowXyVXOQngdlpo/vMP2QX9nqmxkfytyFwlr6DqVsCbCMVkw6z3BXWbimxLfhdpNCktEzYKPvBJPHMIPRaEXMtkyMLYoLBUV4Ru3YzGVxL8aG3izvPfFJNE2XA4RHWg2sUVpTNy9Ez0Dtqc2K+Q6nNnDHtB7LlaPEnZgLHgY0kJZYCViW8w+LLWItbvAXPhYqyr+ow/PYZfQHDat8TVvMpzZyX3huosByOu8P9LTXZToVL92Ss1U2Leu8YignI51li7YIpwrNj6bUi7XqjfHvD6SFVBOnGOXd0spS4xaV0ACCNxNDBj8qSXkgk8sPeU3scY07SMg7XmQ1Ki+AwuGbcsE852o1yMos96Z8gn+tVS7P+M1OkQRRiLrzme27PvhEjrH3rOVFocJoLST9sQr0IBWysORlFK1ilzcv3pFylh0RT1wmiy+,iv:1KCREXUYSFAHFT9nwrk5rWaQfRKoOU5ItNFo35QcqvM=,tag:ZzFrG1IbwpWc3WCf4IWk8A==,type:str]
    key: ""
  certSANs:
    - 10.1.20.120
    - k8s.robsonhome.cloud
    - 127.0.0.1
  kubelet:
    image: ghcr.io/siderolabs/kubelet:{{ ENV.KUBERNETES_VERSION }}
    extraMounts:
      - destination: /var/openebs/local
        type: bind
        source: /var/openebs/local
        options:
          - bind
          - rshared
          - rw
    extraConfig:
      maxPods: 150
    defaultRuntimeSeccompProfileEnabled: true
    nodeIP:
      validSubnets:
        - 10.1.20.0/24
    disableManifestsDirectory: true
  network:
    hostname: k8s-5
    interfaces:
      - deviceSelector:
          hardwareAddr: 10:62:e5:1a:80:18
        vlans:
          - routes: []
            dhcp: true
            vlanId: 40
            mtu: 1500
            dhcpOptions:
              routeMetric: 4096
        mtu: 9000
        dhcp: true
    nameservers:
      - 10.1.20.43
      - 10.1.20.1
    disableSearchDomain: true
  install:
    disk: /dev/nvme0n1
    extraKernelArgs:
      - apparmor=0
      - init_on_alloc=0
      - init_on_free=0
      - intel_iommu=on
      - iommu=pt
      - mitigations=off
      - security=none
      - net.ifnames=0
    image: factory.talos.dev/installer/520de4225301b3fd080dfa5613482544286ae7a379ccd0744a375799d25bd5fa:{{ ENV.TALOS_VERSION }}
    wipe: false
  files:
    - content: |
        [plugins]
          [plugins."io.containerd.grpc.v1.cri"]
            enable_unprivileged_ports = true
            enable_unprivileged_icmp = true
        [plugins."io.containerd.grpc.v1.cri".containerd]
          discard_unpacked_layers = false
        [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc]
          discard_unpacked_layers = false
      permissions: 0
      path: /etc/cri/conf.d/20-customization.part
      op: create
    - content: |
        [ NFSMount_Global_Options ]
        nfsvers=4.2
        hard=True
        nconnect=16
        noatime=True
      permissions: 420
      path: /etc/nfsmount.conf
      op: overwrite
  time:
    disabled: false
    servers:
      - 10.1.20.1
  sysctls:
    fs.inotify.max_user_instances: "8192"
    fs.inotify.max_user_watches: "1048576"
    net.core.rmem_max: "7500000"
    net.core.wmem_max: "7500000"
  sysfs:
    devices.system.cpu.cpu0.cpufreq.energy_performance_preference: balance_performance
    devices.system.cpu.cpu1.cpufreq.energy_performance_preference: balance_performance
    devices.system.cpu.cpu2.cpufreq.energy_performance_preference: balance_performance
    devices.system.cpu.cpu3.cpufreq.energy_performance_preference: balance_performance
    devices.system.cpu.intel_pstate.hwp_dynamic_boost: "1"
  features:
    rbac: true
    stableHostname: true
    apidCheckExtKeyUsage: true
    diskQuotaSupport: true
    kubePrism:
      enabled: true
      port: 7445
    hostDNS:
      enabled: true
      resolveMemberNames: true
      # Incompatible with Cilium bpf masquerade
      forwardKubeDNSToHost: false
  udev:
    rules:
      # Thunderbolt
      - ACTION=="add", SUBSYSTEM=="thunderbolt", ATTR{authorized}=="0", ATTR{authorized}="1"
      # Coral Edge M.2 TPU
      - SUBSYSTEM=="apex", KERNEL=="apex*", GROUP="44", MODE="0660"
      # Intel GPU
      - SUBSYSTEM=="drm", KERNEL=="renderD*", GROUP="44", MODE="0660"
  nodeLabels:
    topology.kubernetes.io/region: main
    topology.kubernetes.io/zone: w
cluster:
  id: ENC[AES256_GCM,data:l4mt/HhBfJel0xCwYyC9BQErvQSPNeoTG43jvl4+iXw4v5weHjaC3Apg6jA=,iv:PN39FoBID4+8nKu8hboJFtYQn0eMiig5aI6V4W8Jjv4=,tag:+m3t/hxtHp7e/tyLsEzq2Q==,type:str]
  secret: ENC[AES256_GCM,data:xKugxJhytzZ4lQX3M1xtj8GhXflTsTAOMEs5EXwqdEXF9wkdjgLGu3Xa1nc=,iv:WEG8tLPBtNNF0/gGzuGdCbO/dcl1t41FP91xh4A3DJs=,tag:g18uUIgLxaBo8JAcWtXYsg==,type:str]
  controlPlane:
    endpoint: https://10.1.20.120:6443
  clusterName: main
  network:
    cni:
      name: none
    dnsDomain: cluster.local
    podSubnets:
      - 10.42.0.0/16
    serviceSubnets:
      - 10.43.0.0/16
  token: ENC[AES256_GCM,data:lTS+C6c/E06J9uA3kBmm2LADleGmZEs=,iv:e8kqj6/zr1NfI9bs1Pl06oSrm3O20RxZvdCZu1NIifE=,tag:CBZhePy0KznpWQIEyS1Pvw==,type:str]
  ca:
    crt: ENC[AES256_GCM,data:BQ/3tC/bYGTloOm79veyd75kOuAsbPYMwqGMgMyxMaILN5WIp6+c58+It9JImUkodWs3y/ok+BaeSZDK3+XTwP959IDxtnWAnU+KocdjjdTXwwvIlIyH3mOuPVOMTPNZaTReUWwRpwsKRERMBZE40t8ZNv8JMNw65fwpC4yYHS/9/FsSSthMnrxplNDO/vtfqM03tEK3Dr2HfzU0W1O3LikVWioo7kviNI1RuJxzb088IwSl9tv6my3QcqOvIJHyufmz+XFsRVcimVA/+wCLxDYVGCInfnrXww653vWCJzpdawtceI/NWxY/NvbpMP//zyNW9HyUPyXv70QTPeRDbsc2Tn1KOFIMSc6OqEHRFWvkZpHCWmkP9sSyR4nTQZ6XsBUL2UzzEBsuYsOaKYEUfW8OJBjGPsuXkNVow6on6dysxQjINyUtYGFzCIxqkTgWVgdxq9ol64MlJuXZQ3y4drxklFqbZn6DXeZ6FHqpxJiEziEJn4GMkUD8qFMNm/BlwuKUZP8V4wa//azJF4U2U11IQaiprnfwX5ggImtmF/zKuO4ygCCoD1tIY3GS62bJn9wHjMcDMhcRwLNz4bmL9vQA0OPSz24+vpitS1SRJSZLfTXx/6zGEivpM8Dhh2GcwCmPMDtHfXyiS4oHnINBzOmMAgGP1kdzkOJdCK1y5gucWgKD+O39Qng58wSMeQF91WzKlW6xNcP98UOlU1oiF4rK1OqSqCILGA2+yHZ8+TuMFDX+pacp6LzCbJPqh+upTiFpHEgONukao/Or8pWucWaw+m+zHRLFbfEN0anBwSmUeNKyct8E1yOn+8/Y4tszo+c4y7+fk7pNU3lDWHulR2LPMsZO9Qq9MoTZfPdM7oP8BLCB2LR87R7oS7X+jbzfL3FLx4YizWKPOWnZ0tqQv31zqY/3DAUGwhcHZ81Igmuj3taeuDf8N8LuQtKJ5fLt/5utkMsu0beAMxXPEEJLP2Tkey2MxD4c3MScU25rTXsPcR6G1kL34l+wa3vb0AuZqjJkufn3W7x4YenpygL3dmlPhSI=,iv:xicrbalS+LebYfDF08TQ3CuvQ6AXbS1KN++6WaUJz0A=,tag:f6ccthBXP+EWEgJEf7Ugzw==,type:str]
    key: ""
  discovery:
    enabled: true
    registries:
      kubernetes:
        disabled: true
      service: {}
sops:
  kms: []
  gcp_kms: []
  azure_kv: []
  hc_vault: []
  age:
    - recipient: age1jwm8ccjgfy04r9rwh65rehk72j6rkawkpjnf4rcu4ukwlcfyquhq4p2q23
      enc: |
        -----BEGIN AGE ENCRYPTED FILE-----
        YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSB4bUZaUEd0d1BYMkxCS1pS
        NmZURWdjNmtmQnhHMFdWT3VDMHptQ3NRYmhBCmxZTG9Wa1ZINnBrQnkrSjVZWW10
        eE85VndTcXlDa0E5dUhrVmlxSGRhU2cKLS0tIFkwM3V5S3htNVdBSElveUU2bFJD
        aS9QeDNNVFIxaVFXcjRwWUpmV2hIalEK8vFVGqGk8ThvGqrq2TKctYypnWDgcOrE
        NiIq9UULMdVxvwKjwd8VcY+Av9BHryF9fcdfxEltRNy+ioaqIcZAhw==
        -----END AGE ENCRYPTED FILE-----
  lastmodified: "2025-01-30T04:58:49Z"
  mac: ENC[AES256_GCM,data:V8em+gNk8PuKm42YGXrwZKnBdT6VS+j+/R7WReSQ1FOjaZxWHe+nrwq6oNarYDSaYxkemyMAo78o3IkwZNqLAOsYvsPXUczjGEf/kS8y/c5+aHBlqprCCtew+xUgUywHTD7+nTyWRk/1bzMPxLC+Lr2+dy0sSrQU4zA0+tV0xT8=,iv:01KdtQMpgryGQ9g/7r6U4XKoUWvKETdXKkn5smKKgLE=,tag:ZUpLf9/FnsDGnXQu/YiCYw==,type:str]
  pgp: []
  encrypted_regex: ^(token|crt|key|id|secret|secretboxEncryptionSecret|ca)$
  mac_only_encrypted: true
  version: 3.9.3
