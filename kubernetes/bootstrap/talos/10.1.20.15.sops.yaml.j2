version: v1alpha1
debug: false
persist: true
machine:
  type: worker
  token: ENC[AES256_GCM,data:bnFzFcE50fSdkQ3dhYAEnTeW+cX+tZ0=,iv:wbE9IDTeiY4JzofakDW9rjLNxvlCQL5JxptMGoiGI74=,tag:cikmSQnP1405qrANP52FeQ==,type:str]
  ca:
    crt: ENC[AES256_GCM,data:UN+/buSumDZYAz0xybqWJO0Vx4ZbFLpitBtLoOoOFVx2gn4WMup4IFfKQWuo5X0LtpP1zB/tBTYZF13KjJTg81EZMD5VV68FqYfd1vg81IuWODvF6mR7RqY36impB3KambI++CKtGLfWEpr1YzI71skhWVpnidUoKpaNQsjYDQ8RzzdYRImkHM5GIiCEbQ9HftMRGlCx3YfjspMjx/ZY+aet0lFcCTATnhMwtwquLlzo7vStkoZA/lq1011FNyGQ4dgsk0rEh/dxhWqwQUZoev98mqUcPLAb68VVna/+Wz1UB7v/kHOGLPg+crfBfkHkutw5WT2xC/Ci+zZ1dxdxbruZHM/ATv2D5OiqEpfO0Hu2bZriPGX5lBph2xU67ZtbvcvMikWaBC96zm07dxSZmLnsGc9tsxcoBAY3NpqNFnpvtqsL1WruuqK6j7+ZQbJ65tJHoCpXswrbWyBwHnOFcjiP90cgQXwb4PRXqte3qIToLyaesi1xamp7byeLqWExMXu7t3/8+xi0ZbMcQj5h1GRbNHXDe6hZye9R7dwEuvvRNpLcUx+TIqMhj0VUCSzaSQYsPyIo/M1oFJx5rheRApLEcymM7UEmowGlZWimKCA7a8SClob6T16EHntqh6Ju5zbq8Nwn0+D35oWd8i71pgP/aN6qM+nUE5pMkbYiEZfWaJrCxNEmEGhGyiLlOXFzSRIrx5mrvsnjD5eLtskHZeVlzcoI9pOztg7oeGMv9kcwGofLWTG08a8xtkJt7WkhlGNkPnCNetmleIiVY2ZCU3cjOefEBeqRoDI9aMrO+/i2nGY8lTQCLorPdlfEUAqkm4hcHkpGpRs3guuLKdbEfA+4W8xafZvrmUv4M/pb0ALgURmS,iv:1Kd7nXm8q+Zshd2nIAUa71cnnVuaOe5CZkTueQCOavY=,tag:La7At3PXQVG511nJJbczQw==,type:str]
    key: ""
  certSANs:
    - 127.0.0.1
    - 10.1.20.120
  kubelet:
    image: ghcr.io/siderolabs/kubelet:v1.32.2
    extraMounts:
      - destination: /var/openebs/local
        type: bind
        source: /var/openebs/local
        options:
          - bind
          - rshared
          - rw
    extraConfig:
      maxPods: 150
      serializeImagePulls: false
    defaultRuntimeSeccompProfileEnabled: true
    nodeIP:
      validSubnets:
        - 10.1.20.0/24
    disableManifestsDirectory: true
  network:
    hostname: k8s-5
    interfaces:
      - deviceSelector:
          hardwareAddr: 10:62:e5:1a:80:18
        addresses:
          - 10.1.20.15/24
        routes:
          - network: 0.0.0.0/0
            gateway: 10.1.20.1
        mtu: 1500
        dhcp: false
    nameservers:
      - 10.1.20.43
      - 10.1.20.1
    disableSearchDomain: true
  install:
    disk: /dev/nvme0n1
    image: factory.talos.dev/installer/a0b4991356a74f14e884e8b9192ac3864397894fa5223317098564de42ce0a0f:v1.9.4
    wipe: false
  files:
    - op: create
      path: /etc/cri/conf.d/20-customization.part
      content: |
        [plugins."io.containerd.cri.v1.images"]
          discard_unpacked_layers = false
    - op: overwrite
      path: /etc/nfsmount.conf
      permissions: 420
      content: |
        [ NFSMount_Global_Options ]
        nfsvers=4.2
        hard=True
        nconnect=16
        noatime=True
  time:
    disabled: false
    servers:
      - 10.1.20.1
  sysctls:
    fs.inotify.max_user_instances: "8192"
    fs.inotify.max_user_watches: "1048576"
    net.core.rmem_max: "7500000"
    net.core.wmem_max: "7500000"
  features:
    rbac: true
    stableHostname: true
    apidCheckExtKeyUsage: true
    diskQuotaSupport: true
    kubePrism:
      enabled: true
      port: 7445
    hostDNS:
      enabled: true
      forwardKubeDNSToHost: true
  udev:
    rules:
      # Thunderbolt
      - ACTION=="add", SUBSYSTEM=="thunderbolt", ATTR{authorized}=="0", ATTR{authorized}="1"
      # Coral TPU
      - SUBSYSTEM=="apex", KERNEL=="apex*", GROUP="44", MODE="0660"
      # Intel GPU
      - SUBSYSTEM=="drm", KERNEL=="renderD*", GROUP="44", MODE="0660"
  nodeLabels:
    intel.feature.node.kubernetes.io/gpu: "true"
    topology.kubernetes.io/region: main
    topology.kubernetes.io/zone: w
cluster:
  id: ENC[AES256_GCM,data:DPSpsEEqF//s7rxOpzQvfZed++/akOe1/37EZbyfdvd3mRs2IrLCN8G8t9Q=,iv:CWU0NbD7jrw+ANW78eoj/Sz24Y9wdrKBZoOqbiTlTG4=,tag:5ypt4dOVnAUGaokyOItYwg==,type:str]
  secret: ENC[AES256_GCM,data:aEwlOIJZmCXwSMgSG8Jozz2BzMKmQIavf4EM1uVjFBk12eH1e5ULC+5awfw=,iv:QMAyIQ2SUUq6B68zV+NSIpeDUN779DvJbTqM99MJMak=,tag:zfv1aTVsarwt+3Wq1fDXmw==,type:str]
  controlPlane:
    endpoint: https://10.1.20.120:6443
  clusterName: main
  network:
    cni:
      name: none
    dnsDomain: cluster.local
    podSubnets:
      - 10.42.0.0/16
    serviceSubnets:
      - 10.43.0.0/16
  coreDNS:
    disabled: true
  extraManifests:
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_alertmanagerconfigs.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_alertmanagers.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_podmonitors.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_probes.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_prometheusagents.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_prometheuses.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_prometheusrules.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_scrapeconfigs.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_servicemonitors.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_thanosrulers.yaml
  token: ENC[AES256_GCM,data:CnDrDe1sVMdyhxhY7iUX6famky9lK2s=,iv:yz6Fa3XJQHb7/TbS7rtSKpd89cu7SIXRzKyOXSdGhNU=,tag:ZBPOkexKIkujutpxhN4t1Q==,type:str]
  ca:
    crt: ENC[AES256_GCM,data:XCP/zsr8wjN4lBkyhkJLcrvvcuqzMA2P3R8Pr3lI0yfwLVmS9dA9c0jPlJiZfTVC1u6FfhJCOjz/ZAznEyS9+Cm02F0LkiVW6tmwtBQMwQ2xZfgkZtqraBAJoImwWC1CR0aHYff7TSnTwBUDU8sBFf/53hGjGnDbebXECZVP/XvPQwNJwqVjwFdfEpK0IcBPC++pgyyIXG2MSD83OeYwzBRTBC28LVuL6ru4yViQ04SiiwhQMlGOvkBZp9wKmQFQFAWIED8WdJTBE6HNFXnJ4HSQDLEzEW1xcbKoZqACUXE8G+q58AIGNwYTARN+ovsAkbxQSbM1dc6a42dh4HVDKbhRVylC+7a3GKSXHXPOmogECOS5zGhTPHXkfq9PMsExgslRVJbqtaTlLxq3UtS/8D4+L1J8PqNQpNi+sgx2vFc302Z/nBG6v3hYh5SmmUWD6GYWdpqSRjbRcoY3gYNRPZw6lLRpQe39dg58NsmW/3sCAkViaySBcGROlmZpZLPOpGvz6zl6qk8Na5AhovX04/wafptUgPDrTen3H5sBSdxdUuo6G+Ggb8XgQFwdMaH7hxCNrwjv68z9fea+H/Qa4jxi7bLz+JNm+hpM6E5fIqYRO0gR1dDiCmCBBe+OxXaMP1N57t7oRtDr8+53ldRL2SUPvIR7Z5s0lPzgR0WnlmF4WJxy8+mRqk4Zfn+oqpwRCEm7KAEZdLLYFdTFYfn/DDwqUauq1B4vPQlmTDMQw6hMopTxLD8OnHO0yX6kHheiPBzeRSW3NQXic/WKUQCgLYoQp0ZTk/yYJWm1ZFNMXzDS9jbX9jFIeK8vLEbIgjwEiLYgyk+r688hGS1+fJQuoPup3HiUGC496gW6zbJqyFV4dElVy/R+otZ1LgOr9ZQHE20UwwbZ+aYCmcOSf+6NZeUNTIE+IwzVP05opa/fClyW/0JxPZ2E/P8yvcry+etn10wIQ+bai+iiYouEQQ9uYrt9Wfa4yzerci2EHF1HNBkmpBMV/xuLxsAfm2wLcln1sEYDHmvPl50Ue69hx2SgbNZR0U5kMEFFdhjGDg==,iv:rWNgJ/meWYsOIv/BcijbPAFe56MRB2fe46BgRwJkXFE=,tag:ERYIQtdWq4hJKoJLVYb/WA==,type:str]
    key: ""
  discovery:
    enabled: true
    registries:
      kubernetes:
        disabled: true
      service: {}
sops:
  kms: []
  gcp_kms: []
  azure_kv: []
  hc_vault: []
  age:
    - recipient: age109xxk5j8q09kprdd5wta9fw7nwpz8t95phq49eclrefjy3zjncmqa9lgtk
      enc: |
        -----BEGIN AGE ENCRYPTED FILE-----
        YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBUT0tIVTc1OHhxZ3dUVkZn
        VGUvUnQ2WkVYYnREdGRKQmlXUEl6M1NPVmd3CjErcG51Rm1lK1VnYTMyYVVVUHg1
        WUdqNlM1VDU5Zzc1OTFDcDFHcnRHM3cKLS0tIGkyMlU0eVZYUDVWaHY0eGFwZjNB
        YStTc1EvMVd0T2tVSmZyaGY3TjVTQVEKPGqSr+ETcG2ZhI4Ktdgo9MAgEaFl4JMR
        mttFlp++QoL2+37nCwE/YPaQ6jC32y6oR1QhVdCnUPbu3UKRUtmOOw==
        -----END AGE ENCRYPTED FILE-----
  lastmodified: "2025-03-12T21:03:46Z"
  mac: ENC[AES256_GCM,data:mWo/MKMXx4snOc/H9GPx010n1FJXysZzg2eqCdFm5TKzOPO1cYBMSn0qNe6BjvsJ3yQO5OIiSvj/zMfn939GB7TYe/kiIQ9qZKfRAB1JGjHTfrxS0VpZrYIBUrk8CuincWzV6o1bQAxOp8nSA4/5B4Xop93D0T0TO9mijAmAwrU=,iv:6B1mugVMTM7S5ZW2rxzzRPi8XETMvgrxbNU+BYl62tY=,tag:p97/Q4xTBhVQwAjDOL58wQ==,type:str]
  pgp: []
  encrypted_regex: ^(token|crt|key|id|secret|secretboxEncryptionSecret|ca)$
  mac_only_encrypted: true
  version: 3.9.4
