version: v1alpha1
debug: false
persist: true
machine:
  type: worker
  token: ENC[AES256_GCM,data:f1ehqD9RtNafk2yM4A9Xq8iVZxK5SyQ=,iv:pKx5O6FZ0tOVYS35XjEucwV8ooyIckrKF6FVTVzh62g=,tag:zZhV94Y/QGpEDVOjPZ5GAw==,type:str]
  ca:
    crt: ENC[AES256_GCM,data:wZ2QP9CQOp+P8gEAooFn7PjWM7+ZmH9nJl4phDJLcoM6m1U462Ytp7apfZqbKyeG8IgsV4bA/AtFbWZ2xb7+QE00HTG6HohbOAECFkWkMviSKOF5FNIBkr8tx44xQKDBHgr/gxFdiybyo8Fui+KujNFBGlOl/Kv8reYr4+K7P1xktYIeHlShWKvizsli+dMLnyuwQTstdP4kYqi0N0Z7IB6NM/vxDwg7yQTGm8vworoL0PO/dWG7jChsMTPQl1IURGqLN4znATS02lO6fSSKCgxzLdC8o4xsw/TfeVSzHCRFcZx5eXjCCMNjuszcXZsQGtNl4K1X/bH/aWh+5Dbh4kWS3WmMr4gSgjGuDCYkjQmuoBzOflptotgkPTAovnWFSQvgzEyng9vkI4y3LPw3SXdcqHwkrJo1bFcGcsM1MFqxpzsD2t72CZ43p8Ef6Sp3d2Ef/We4ZibowKr7UjK8/Zf3ux4JUgM+k2PXITKnoubWuUI5E6e09Nj7MD6w5W93qA3K6/N0jJwOfgOAQnTEmPoUNQluYNxGR8U1AeTdTPLPG7CCu6FmxpmhpGmficRuPRFjMyu6Rp1QSOpzIusZtKRfRzTtRZLtxGg+RMTbTnNsTBsqZ39vvU3sW0YxbMpfoY/yJQZ6dFyE4gX2VoxSlNZuzVQFU/AWUjMmPBf/JaSdL6Ks3Eg3WX6r3vknl1CS6kymRvFt5ME8hFjv33erRnAW1EVQbvF6huIDTRLa69Sav0jOF0kUP8MZUzp3qRJ3pKO+ybLyhTkSUAaKd0odFGlRY973I62K3Ot5JaUfrx0YTL/gkcWzaPqjpiee0ttbuTPOOfo7RH/xcr0pEwqXIMekaA8xScb87Odz8P3Lw45Ulc2G,iv:p2cPCJHqlc34CMSZPYAB6yMmltMmOk5/hhoc2QmiPm0=,tag:acgWEGLzi5snU3ezXNdyIA==,type:str]
    key: ""
  certSANs:
    - 10.1.20.120
    - k8s.robsonhome.cloud
    - 127.0.0.1
  kubelet:
    image: ghcr.io/siderolabs/kubelet:{{ ENV.KUBERNETES_VERSION }}
    extraMounts:
      - destination: /var/openebs/local
        type: bind
        source: /var/openebs/local
        options:
          - bind
          - rshared
          - rw
    extraConfig:
      maxPods: 150
    defaultRuntimeSeccompProfileEnabled: true
    nodeIP:
      validSubnets:
        - 10.1.20.0/24
    disableManifestsDirectory: true
  network:
    hostname: k8s-5
    interfaces:
      - deviceSelector:
          hardwareAddr: 10:62:e5:1a:80:18
        vlans:
          - routes: []
            dhcp: true
            vlanId: 40
            mtu: 1500
            dhcpOptions:
              routeMetric: 4096
        mtu: 9000
        dhcp: true
    nameservers:
      - 10.1.20.43
      - 10.1.20.1
    disableSearchDomain: true
  install:
    disk: /dev/nvme0n1
    extraKernelArgs:
      - apparmor=0
      - init_on_alloc=0
      - init_on_free=0
      - intel_iommu=on
      - iommu=pt
      - mitigations=off
      - security=none
      - net.ifnames=0
    image: factory.talos.dev/installer/520de4225301b3fd080dfa5613482544286ae7a379ccd0744a375799d25bd5fa:{{ ENV.TALOS_VERSION }}
    wipe: false
  files:
    - op: create
      path: /etc/cri/conf.d/20-customization.part
      content: |
        [plugins."io.containerd.cri.v1.images"]
          discard_unpacked_layers = false
    - op: overwrite
      path: /etc/nfsmount.conf
      permissions: 420
      content: |
        [ NFSMount_Global_Options ]
        nfsvers=4.2
        hard=True
        nconnect=16
        noatime=True
  time:
    disabled: false
    servers:
      - 10.1.20.1
  sysctls:
    fs.inotify.max_user_instances: "8192"
    fs.inotify.max_user_watches: "1048576"
    net.core.rmem_max: "7500000"
    net.core.wmem_max: "7500000"
  sysfs:
    devices.system.cpu.cpu0.cpufreq.energy_performance_preference: balance_performance
    devices.system.cpu.cpu1.cpufreq.energy_performance_preference: balance_performance
    devices.system.cpu.cpu2.cpufreq.energy_performance_preference: balance_performance
    devices.system.cpu.cpu3.cpufreq.energy_performance_preference: balance_performance
    devices.system.cpu.intel_pstate.hwp_dynamic_boost: "1"
  features:
    rbac: true
    stableHostname: true
    apidCheckExtKeyUsage: true
    diskQuotaSupport: true
    kubePrism:
      enabled: true
      port: 7445
    hostDNS:
      enabled: true
      resolveMemberNames: true
      # Incompatible with Cilium bpf masquerade
      forwardKubeDNSToHost: false
  udev:
    rules:
      # Thunderbolt
      - ACTION=="add", SUBSYSTEM=="thunderbolt", ATTR{authorized}=="0", ATTR{authorized}="1"
      # Coral Edge M.2 TPU
      - SUBSYSTEM=="apex", KERNEL=="apex*", GROUP="44", MODE="0660"
      # Intel GPU
      - SUBSYSTEM=="drm", KERNEL=="renderD*", GROUP="44", MODE="0660"
  nodeLabels:
    topology.kubernetes.io/region: main
    topology.kubernetes.io/zone: w
cluster:
  id: ENC[AES256_GCM,data:giSq7wgrLsmXFGYtD6L6uFnQwfl2qGWA1B5anc1nzhMGxgk2rq4huzZFKDM=,iv:EKISJrgoobtkXcYKux9jkBbRJbQ/U6g91JCCsdn4Liw=,tag:6Hf2CMZdBcJq4ezlGsf8EA==,type:str]
  secret: ENC[AES256_GCM,data:ZpZ3b/9BYzuWgIUbzE5yrckBzNjheIQ4PAPTZn4CPCIXqACtflZ/qJCs4+s=,iv:65stqBiUTQPefyZ30UohZhIkl6K6gGE0D4d2qnC5bCA=,tag:FFxu52Vl7lcVSO5XU8O4KA==,type:str]
  controlPlane:
    endpoint: https://10.1.20.120:6443
  clusterName: homelab-ops
  network:
    cni:
      name: none
    dnsDomain: cluster.local
    podSubnets:
      - 10.42.0.0/16
    serviceSubnets:
      - 10.43.0.0/16
  token: ENC[AES256_GCM,data:5VNJSkTKTE1R3klsiK6cRSU4QWQxLvc=,iv:hbwp8pK4pTds95EN4V3BZss3Q4ayDIlkoDW8puypOaU=,tag:xVYTWO9W61o4t/FTDP752w==,type:str]
  ca:
    crt: ENC[AES256_GCM,data:OLM7PLpySTayx+dkY5i2cav9AVdOb9i3UZ0YD7vzE699ccfL+EL2kfNOCB5tkalxkap2i4i66qKThtmZZXmLNMayzIzZoViqn/4wysbFF+0miP6dQX6JKNwvtrJxf7mrqlg7Bd9Q3eFTsBbK46CzqqIpKtGrYowXcjtoE1rBcpnjJUReAwxOxuFbFJx+pIsVUPlzk39P/w8boW21cRfUT8WIAzqEgRwfli+SnDNKQRKot62cR8qkWVjFAgdQLR3NGIsvHCW7/Ng1igHFQm5I9T/kGUs263pD8Os292BFdTTM5iBuPjHuEJefNP2jj6Pr4ZKlsfZYLPpFCwS+upKkfF6CaDHfjKsNA4sdJmzw3eK2BxcpHDmfRZNlDvAuRvbuvwXyAG0qsLFQULiDDCQt8X/dXdQ8tCtPXhT7/7qThkamodFz5p+F02OHGEYwgLSGN3lTdhcH4G6SrC5bGtI5i2NdX7bc29qrDmV1oXCCRhMZpAixL6fyup34G3aoRq0j/3pQ7VPQ7ad3ghB2zyYmd9FjTrbpyvVdO3zOU+AHwtVRfBzrijyHjoR39aW5kZyZ+eNUSEE8avKQaLgOUVdpQ9dva0aaeP+JENK6g75yLx93/zfvwdKxyVfridWrqmkalpiWPZAUcvKHSybCnIusn0GL1qs3JtS3jWS7R+s6NTaqTgWzc/HY4qWKOcywdbKN2Rou5x5rqtcjBECFOM+IUUJ5+567/YzaxULZFZpWWYmbU8YgrTZocisZsXUldR/111bT4Kuhvvz+hVnz6+vNmnAnJ2wyhJ1vp0BDp95w0M1s+qRy+GoEjKYXydzj0k3l4hAO7V73AGsIA4xVws4ukm3Oyupsf7s9JXHcKZRfQMnyNIL/45KmErXQvH/x5XAw6gnCfFMPE8WcOsx6hvbI48ehkIL/HvBaAuftos5Ip3FPVCCzeHBtxffKpT1AqInf5K59FR/msrpXQnUrjXNkTlF3fDSCcdGJsZVrUfOJE2ar0cgzlJhZqWttlJYKSqzRRBNjoRQjKEIMin7fZ5bP/BMwK5c=,iv:O0yPAo2MZqKa9f6NlxOascRmPTS8NMdSrakJwgcETtQ=,tag:beknlGh3Uctrdc2Wa4GOPQ==,type:str]
    key: ""
  discovery:
    enabled: true
    registries:
      kubernetes:
        disabled: true
      service: {}
sops:
  kms: []
  gcp_kms: []
  azure_kv: []
  hc_vault: []
  age:
    - recipient: age1jwm8ccjgfy04r9rwh65rehk72j6rkawkpjnf4rcu4ukwlcfyquhq4p2q23
      enc: |
        -----BEGIN AGE ENCRYPTED FILE-----
        YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBXMjB0NlYrSW1wUWtwL29u
        SnU2cnNxUU9LUFRkN3kvT1EvbWE4eFJuT0FRCjF5TlozbVpXR1JWZHZVRkRPUy9U
        M1RpYW9WbkpUNitzNzQ1UUN5TW03QUEKLS0tIERnaElWNjVPNnJaMVg3V0MxQUgx
        a3kvTENXSkxjZWdmcktUc1FLN09LM2cKXp5AVZ94xoe6SCD386VTFuyna7aj7KOU
        PTKEYHn+V03PuuCad8RZEgfEfi5+6ut/LNFzN5PkPRXD8vEs5UaknQ==
        -----END AGE ENCRYPTED FILE-----
  lastmodified: "2025-01-30T04:27:41Z"
  mac: ENC[AES256_GCM,data:Cr0+WYghyfzLFeltzT8Tdh9L4I8jTlox9JVcUPgO2e8EHNofhg0kLr4KC92DURt/LKOLKuV/4zgI+k2+Zf6lFovnTQgKTs1RK93hKfjw3r+Jkj/wvfuPTGPXc9eUeGF8cOKjnOFRDn7Mj3kL0HLf8AxxXUmYM4qbbo49WUJGrsE=,iv:fyN5j/moKk70nrSIHt1eSLx1uU+eJdddC5GcHCspsgc=,tag:kK6Cyl4KZEaUzy7/E9pR5g==,type:str]
  pgp: []
  encrypted_regex: ^(token|crt|key|id|secret|secretboxEncryptionSecret|ca)$
  mac_only_encrypted: true
  version: 3.9.3
