version: v1alpha1
debug: false
persist: true
machine:
  type: worker
  token: ENC[AES256_GCM,data:0KwN+DybtCzYiCfDRyEXcu0Wor63210=,iv:mzmTZJzjCK45Zr1aOK3MkXCaY6QyPou8ZJ2rK0MznrM=,tag:aA4Ff2AOE+pGeJEDK48Euw==,type:str]
  ca:
    crt: ENC[AES256_GCM,data:8lv5WTqh9GgQekdS+9L+cb1g6ThqJ4FYKBIcDe64vg6P94UYVklAye+XZXjC+T2NiHr4j9RpP6fwsPxgwhO3LM+N4i3gBxkC/Psxcla7DMOI9m/v8xgyHqKLA9EU2jq5zPak3vABNF85IonvmUF6U+/aHdfx1P5ky3mjkWs8Q0o9sRRVGcX3mmWcHfakq6nZGMYVv7PCEVUE0J+21GwGo0cN4HBwfpEP7acOHVyPz7tmMcCFNJCoqsYPbfsfjuYphraPZvk4qyUZG1gWbhCy5Z2J072ruMNlkJYEgXKW0l+TN/Mcs2+/1hvTloDTY3DDmQ/V+YBZ/gG2WiaOokrXOXvXPrsCWnKSxr1WQEuXRW/k6DtUZjtKnngdhhg3BXkAU8XRWTtl97ltgGzOcBcZ6fgmf8XGEl2f2mI/bM1MD3p3TYVNWDIxNUIuPX1VgHetLhJBTYPDJ58L1yKwd82sslM7Pxzq5QsjkhkMwd2WhYqYt6qDpkZ0Ai8khArNVLkzIVTEL3haLMayOYSSolW+HRKLA0Epdi7XRofCxao/fwTjIzRiZqDOLEFQzIAfarbKFajkoY//73AqocwGG9AnSdWCjibVRa7ty7nxICrmoJONcKDKfpaqthZ1eiUxfDJztBeswvLhdHZUPhy+ggqI1ODxL6+er8jyIVYNyfWg75aaQ+L/0M5ESGCS+mH8WUhi3TBM42ePhoHJIpifYiIQAESvCnL0On5TOCv9ZJ/U5+vq/1P3az/jXcrhy5+25jyRlJJEWuogCtsED2ByXMeWNXaKZS19xt+7AMnzGFR2lGSho2fjowwahtHX3w2higHavKqW5YQksJWjhf58DEc5bsXHIFX8Cptk6Eg7kswmu9Xialhq,iv:ExteDPurT6hnUjFx5QP1gc2xrI/CzqolSQoF9Si+fa0=,tag:Sn7TVWYjx31CeGBpBg47sg==,type:str]
    key: ""
  certSANs:
    - 127.0.0.1
    - 10.1.20.120
  kubelet:
    image: ghcr.io/siderolabs/kubelet:v1.32.2
    extraMounts:
      - destination: /var/openebs/local
        type: bind
        source: /var/openebs/local
        options:
          - bind
          - rshared
          - rw
    extraConfig:
      maxPods: 150
      serializeImagePulls: false
    defaultRuntimeSeccompProfileEnabled: true
    nodeIP:
      validSubnets:
        - 10.1.20.0/24
    disableManifestsDirectory: true
  network:
    hostname: k8s-5
    interfaces:
      - deviceSelector:
          hardwareAddr: 10:62:e5:1a:80:18
        addresses:
          - 10.1.20.15/24
        routes:
          - network: 0.0.0.0/0
            gateway: 10.1.20.1
        mtu: 1500
        dhcp: false
    nameservers:
      - 10.1.20.43
      - 10.1.20.1
    disableSearchDomain: true
  install:
    disk: /dev/nvme0n1
    image: factory.talos.dev/installer/a0b4991356a74f14e884e8b9192ac3864397894fa5223317098564de42ce0a0f:v1.9.4
    wipe: false
  files:
    - op: create
      path: /etc/cri/conf.d/20-customization.part
      content: |
        [plugins."io.containerd.cri.v1.images"]
          discard_unpacked_layers = false
    - op: overwrite
      path: /etc/nfsmount.conf
      permissions: 420
      content: |
        [ NFSMount_Global_Options ]
        nfsvers=4.2
        hard=True
        nconnect=16
        noatime=True
  time:
    disabled: false
    servers:
      - 10.1.20.1
  sysctls:
    fs.inotify.max_user_instances: "8192"
    fs.inotify.max_user_watches: "1048576"
    net.core.rmem_max: "7500000"
    net.core.wmem_max: "7500000"
  features:
    rbac: true
    stableHostname: true
    apidCheckExtKeyUsage: true
    diskQuotaSupport: true
    kubePrism:
      enabled: true
      port: 7445
    hostDNS:
      enabled: true
      forwardKubeDNSToHost: true
  udev:
    rules:
      # Thunderbolt
      - ACTION=="add", SUBSYSTEM=="thunderbolt", ATTR{authorized}=="0", ATTR{authorized}="1"
      # Coral TPU
      - SUBSYSTEM=="apex", KERNEL=="apex*", GROUP="44", MODE="0660"
      # Intel GPU
      - SUBSYSTEM=="drm", KERNEL=="renderD*", GROUP="44", MODE="0660"
  nodeLabels:
    intel.feature.node.kubernetes.io/gpu: "true"
    topology.kubernetes.io/region: main
    topology.kubernetes.io/zone: w
cluster:
  id: ENC[AES256_GCM,data:fS+P3w/6fw6WnK9RUk+hhk8z4VFQ89NEn1/77ceD+xwpAyLHVpc5vJc6D8M=,iv:qCQlVy3nd1x6JjYMf1fqAaVclHSLUOUqJWtj9Du52hU=,tag:3Kh8+ieua+jeQg3SqqPUiw==,type:str]
  secret: ENC[AES256_GCM,data:pmNqpXjbHz8AJVnHsL7cc9jSXhgAdoTd0+cUW1MSrLE2jF0Bs0eGjshunUw=,iv:4qTJNmq+mzNdQC2aHPIklN1ccfzutDltFAF4qPNPNd8=,tag:qTT3HpXZVEH7hAG/nRMFKA==,type:str]
  controlPlane:
    endpoint: https://10.1.20.120:6443
  clusterName: main
  network:
    cni:
      name: none
    dnsDomain: cluster.local
    podSubnets:
      - 10.42.0.0/16
    serviceSubnets:
      - 10.43.0.0/16
  coreDNS:
    disabled: true
  extraManifests:
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_alertmanagerconfigs.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_alertmanagers.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_podmonitors.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_probes.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_prometheusagents.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_prometheuses.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_prometheusrules.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_scrapeconfigs.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_servicemonitors.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_thanosrulers.yaml
  token: ENC[AES256_GCM,data:6fZDBwytLwUKWRYtexZj9cvWa0Nk+2Y=,iv:h8+zV1K2Zk2qabBBi4yRv1tblgZKVf9cc8aLQyw/aAw=,tag:FAULAA5KlL7bXhWJaix8pg==,type:str]
  ca:
    crt: ENC[AES256_GCM,data:7P23rn16moEmHILHf6Y2+t0qbYgzbeTVHhJue+5buTtH5rCak5bG70juBZd8TFNnlFHfln9Wm+sI+LNJA7gVvYAAB4Ej9olls+33UtPXygIe85HRnYcEIx9j0ewnTlgdotLT5jS4AMSzZY+VRDJjfiyTV6bIC9TeA+4krDxV458jkrE9ksUU2mWgzMzxynrTxGDJGTD2lREkOe0QApI9GczReY8u3sJ/K+f/eQ4+09AgcmB/bsXaF/r2oGwDshKz6GOPVVq0vjXBHiDOGuH7H+B+pkPFgHOYi8S0DILJ8rEkuAyGoUUBlrpkTLBwLxBwLJTsBtW1JVE1RSP5/qZMqP6ZcCibnBwgZXUSORxX7meYht6NYjyQc+qaEDMsZEh3IjRbLrUWByZp/jJ3xvx+nINyzFV+8c1Crercdq9pgFEH5XaszwjPUjdvMOAjZcZMHVbimILt8HyIXveGasCGAbq9wTL8lCIbZl80Jfc3IAHF5kdkFBHf1bTvtiBvQQXPnGtoN3Uq3kkShAWMZ56OkYMrlMPJgGLfDDFZKK8/m6Vo8Esk0qJZku8uITzljwjG5s3Imk5nit2UovCAlv4a5ZbRH1WReRhi+8eOhJ3+KH8P/GxZLQWDiReObMy+VMW0hCwKrEJi1BVIx2Iqc8EeJVQemGdhClD9QdFPzY3wnzWRSsN+ZSTMbs3jrse2trGX45Fis+ysFgXx/09QUELq0E6E77kaK/7jtZcl96krg6bReIRthSEbH24F3majdqrAgOY/jS7FU/oQP/BAs8lR3RqXR1jHMpmk5VyrvCaWsqYfRZgGlEfhQt/T5Lmh7VbpBzmi3t2QEj/H2DHH3jBEKo5LzHyan82PK2DHAaRD6MPDaVZ1O/XtFAxvbBRPjYJcKsGFqlXXXyd62x4WC89Ndm8Z+JU+KX4RDKfulcPOFfhGiBg/uke1SJmT7RjNT1zTtR/eOdrQp3jDU9PxQ3z9TojQOWqxdqNH9nSCDohht594TwZBqK3NHYW3tEA9YTKK/iLwN2DLUSoAVnBP1WkOo3SEwsdloIS+gJp5cQ==,iv:np57c27RjcA1Z5ZKcyhfAI47Ti3j1CYkkhvY95Wd7xs=,tag:oExGNJcdYCt9+uVsq/hEGw==,type:str]
    key: ""
  discovery:
    enabled: true
    registries:
      kubernetes:
        disabled: true
      service: {}
sops:
  kms: []
  gcp_kms: []
  azure_kv: []
  hc_vault: []
  age:
    - recipient: age109xxk5j8q09kprdd5wta9fw7nwpz8t95phq49eclrefjy3zjncmqa9lgtk
      enc: |
        -----BEGIN AGE ENCRYPTED FILE-----
        YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBydlNCVjVkbkI2cDVuZ3do
        SHQ1Zmttcm9nTWpYRjh0TW0xTkFvNjkxTkNRCnpWTEtYY05MS3k2bSt1anJRckJI
        WU9ma1lnYWlBazR1Y0tQcVBvUWtYeE0KLS0tIEZLbEQyM1VuakFmQnlxQWtNaCtF
        S1dHY1ZIT0tGakw5alM4d2J2clMyMWMKVbCQFMDnS66OjlfeNBxJBnF9WCAgtNid
        XcD7tDM6oRxrp8XOQkag+XERO5UK1NaOIphIJi9giUnc6Z8UA+VRdA==
        -----END AGE ENCRYPTED FILE-----
  lastmodified: "2025-03-13T00:50:26Z"
  mac: ENC[AES256_GCM,data:aWDiKlz5dLUui9a4mwl+MXFFU8KTH++uBtE78tA7UyoYB/pdGHfDyCJ/uc47G+3qhEjBgaRabJjcGkdAK7ZTSgXmrhXAkV9XBG0Netc80+XXiLu2iPOJI5FrCVeI1L/VSWOUFmqRXGiEveSVcdOOyelQTXvVNNljsNvy+pZMXJU=,iv:fl+bvYC3cNwTcWkTwg/l0tBs+pX3nndqXBHyjbyJzj0=,tag:wW4vvpStsurgbIG9gUz+uw==,type:str]
  pgp: []
  encrypted_regex: ^(token|crt|key|id|secret|secretboxEncryptionSecret|ca)$
  mac_only_encrypted: true
  version: 3.9.4
