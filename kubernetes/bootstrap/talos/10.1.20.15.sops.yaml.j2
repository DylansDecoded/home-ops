version: v1alpha1
debug: false
persist: true
machine:
  type: worker
  token: ENC[AES256_GCM,data:HmT2I6T3KCHqkCICiy3uH44ueDpVq04=,iv:4LOa/XW08I8fewTlo3/39J8UpUZwsb0vtNWNDnxhQ7Y=,tag:HtfoYc8AusKoiH5KYXdSIA==,type:str]
  ca:
    crt: ENC[AES256_GCM,data:bVqMUSvU0LU0pIYy301fvuTvRllyVEdUA9oo3Na8G4YHFhKy6xmPjKYauv0y3fARGe9jXB7SOlHCp+76rD6YmwcKz6vr1WDpSEfFwXDWqARyIYaznwf+sE9/Yh5mFoCJz069Scx2oitQ4Mt+yXNvWyqxvzCsyegEFlbq+1i15nRwcIv5L4CEyoRwXkts8PeoqeHbRizOJxzWDYpuWiKdq+wBWvG6Bvcl7lEAQYSv5194ACsNJeo9nPK7XEkqzv7MibEY1ZA2F7rD6CgpMvZKZtc3T+UAbEXPqmoFaqt781iwOL/fQ0YhqEYgQTfCEqJWSSGWVl+OylEV+/k4ppWaXYT9S2bizsXh1Ipy3oAZ5jHiMUFCAUdVa9id1YJxgj7wSkGgrE6yiBRDwKpG7YuBEew/Ztli7XfmpjBXwUAaGSl5plQkMLQKRAL+roFUo6Mn/PNcL0FZdObECTVgOOg8BaxXFlHQFalmJ6y9IsRSP1KvVcSo/UM8vR0/4kHz0pCLGl3ztifzi1mp21B4BVULrfrCCk6J8cc7eQUvmFJFxRrsLpXOlSsljUnm7ZyfZ+Fa6KNKbo4haERPU3X4lHnMy93HTniJ4MikAsIx6ufK6dPDYc6XI+h+NPIGb/Hpf363JgL9AKjCP4IiJtmryaGFxv+DP1I9cbe8WhRwHRcP+XAuQE95Mbxm/wjqoYtbQ7jfuo8+3XCzRkQLNx2kRjPXYPksHAnGv7td1gn47sXSKcfJqIjXhq1Qc5Jwemi1oHazOa5U92bj3g1U3CdAjL137XH7sp1PK21buDjR68LRl0KW2mKkf9J1SFO8P6VEyw5iEVYF6Y/hXGO9vrNQhr8vdyM5kBYYGMLCJRRM46xp7zMAOHWW,iv:mpjAt2ogPAMLq9yUUBblHrkGx5hzfBEpgiIGje8WVSk=,tag:twNijE7YY5pO3uG0R54g8g==,type:str]
    key: ""
  certSANs:
    - 127.0.0.1
    - 10.1.20.120
  kubelet:
    image: ghcr.io/siderolabs/kubelet:v1.32.2
    extraMounts:
      - destination: /var/openebs/local
        type: bind
        source: /var/openebs/local
        options:
          - bind
          - rshared
          - rw
    extraConfig:
      maxPods: 150
      serializeImagePulls: false
    defaultRuntimeSeccompProfileEnabled: true
    nodeIP:
      validSubnets:
        - 10.1.20.0/24
    disableManifestsDirectory: true
  network:
    hostname: k8s-5
    interfaces:
      - deviceSelector:
          hardwareAddr: 10:62:e5:1a:80:18
        addresses:
          - 10.1.20.15/24
        routes:
          - network: 0.0.0.0/0
            gateway: 10.1.20.1
        mtu: 1500
        dhcp: false
    nameservers:
      - 10.1.20.43
      - 10.1.20.1
    disableSearchDomain: true
  install:
    disk: /dev/nvme0n1
    image: factory.talos.dev/installer/a0b4991356a74f14e884e8b9192ac3864397894fa5223317098564de42ce0a0f:v1.9.4
    wipe: false
  files:
    - op: create
      path: /etc/cri/conf.d/20-customization.part
      content: |
        [plugins."io.containerd.cri.v1.images"]
          discard_unpacked_layers = false
    - op: overwrite
      path: /etc/nfsmount.conf
      permissions: 420
      content: |
        [ NFSMount_Global_Options ]
        nfsvers=4.2
        hard=True
        nconnect=16
        noatime=True
  time:
    disabled: false
    servers:
      - 10.1.20.1
  sysctls:
    fs.inotify.max_user_instances: "8192"
    fs.inotify.max_user_watches: "1048576"
    net.core.rmem_max: "7500000"
    net.core.wmem_max: "7500000"
  features:
    rbac: true
    stableHostname: true
    apidCheckExtKeyUsage: true
    diskQuotaSupport: true
    kubePrism:
      enabled: true
      port: 7445
    hostDNS:
      enabled: true
      forwardKubeDNSToHost: true
  udev:
    rules:
      # Thunderbolt
      - ACTION=="add", SUBSYSTEM=="thunderbolt", ATTR{authorized}=="0", ATTR{authorized}="1"
      # Coral TPU
      - SUBSYSTEM=="apex", KERNEL=="apex*", GROUP="44", MODE="0660"
      # Intel GPU
      - SUBSYSTEM=="drm", KERNEL=="renderD*", GROUP="44", MODE="0660"
  nodeLabels:
    intel.feature.node.kubernetes.io/gpu: "true"
    topology.kubernetes.io/region: main
    topology.kubernetes.io/zone: w
cluster:
  id: ENC[AES256_GCM,data:KPZTogGGhrPsYN6jgPauwJAcYI042D/+m3Y3bKae4czFzwj0tXeilPSXOVQ=,iv:CqGd02D5BYPk+1pNlBpY6bLBwndsltAfa9tZV7edJb8=,tag:mdu2YL0hdRIQSeVHLsvdiA==,type:str]
  secret: ENC[AES256_GCM,data:PXgzcQJ6eJhRGPdZu5tqJiUpYh5jNb2FCl4WbEsLJIGtBGAccNvxSJaNZxE=,iv:1+WYpl0n16h4uqpNsEA24oYX8Fl2DkhZSPmLuQV4A1E=,tag:KoCbgaYchWJcdcd+BoXJdA==,type:str]
  controlPlane:
    endpoint: https://10.1.20.120:6443
  clusterName: main
  network:
    cni:
      name: none
    dnsDomain: cluster.local
    podSubnets:
      - 10.42.0.0/16
    serviceSubnets:
      - 10.43.0.0/16
  coreDNS:
    disabled: true
  extraManifests:
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_alertmanagerconfigs.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_alertmanagers.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_podmonitors.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_probes.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_prometheusagents.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_prometheuses.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_prometheusrules.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_scrapeconfigs.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_servicemonitors.yaml
    # renovate: datasource=github-releases depName=prometheus-operator/prometheus-operator
    - https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.1/example/prometheus-operator-crd/monitoring.coreos.com_thanosrulers.yaml
  token: ENC[AES256_GCM,data:8W85yGspabkq3x4GRGXHUHrqkqOa7LA=,iv:1+zpVRA5D07K3YRWt6ZW6oZymW/X78IL0aAsHfiFr5k=,tag:aIJ82sARnZiLhO61i+xuLw==,type:str]
  ca:
    crt: ENC[AES256_GCM,data:8AukQmLJGg91XkEVsEKxAGOnQQPx+LA9/YimxvDZGuxmsOmUSdslIhHepvO/uQ5k9DiZZXVPMDYh1T9Ukm/WS/Aa912X64rtbQhHTVXxNTTNLD3ehRyVpcEct4rMfDBoV321aQv7DYYtFmtLNOxi7tAKYd8UuXBKhB+FtRkQmDIzl1EM9ibiUwbb864s8GtSp6LXHoPojGIzhumS2vUmoHoXlIRWx+1+q4XrsMWMF6GKVxVN6Gzn00Nsy4wR9ghru7QvJB1XrCllP1O5E8tkgmFUiWYAu+jsrpKi8efcUovsCtEiklmA/vXSIWCJac3nN+AAtvSvZBsSWCmWr7EQJepDL8QRAJsNUnuAK7pp60hVQyxFr1ausYpVSeG2LOzrFpIu53gCEg7vdVIWORXeJSwlxXAF3i5+K2xo86Z9fNqURDOgdz1sAi8KqM5ymb8fyJX3ATplruqFsCn54VzcyWmY2bxpCBsEYbKQmH5uTd+1SKnkSsuZ/qMBSFwfo/E4TsA1uq06tLqcykO3H4F78jaNTW0L72GtVifqfzFryg4+qhBstCbbFseuDoT+nIoYUmz9SUAZUB6Pa/VsLEqSHYIOeuZXVRObEuA6xCydRaCdwVZSvPb4uGj/qGDPv0u+jbw4IViQmxflJTUModiv6/WpXTdZc/YmUsAnrY/UVJ6Qdm/sGaEcw3BccgNSz/WiE3noOwYS+bSjLcs3dmw5k0zVXmnPvO6P7AtN4ME19hD/8nsUPrLQyV2TcDK8no9MPlsTDbi/fxdzFzU+h4ITQ6o3H+K42cS8Zd/I86etiISvCx23cmAIHXqPIJjyTExzE7M7YVPh1kLuEVZdUVsKStusJzVEhk5fik1qPLfzjWevMpGXTfO7z/s5NdcrAwGuZ0gLBtwSXQQWfmwXddFKiG//VE+8kYlxGhpNTzUK3qLAFh/8E0AcyHM6wF+qEy2LnMCHE0QUsQkqpKQ2Ow+IJ2Gbbx/fYh05S67jXAhvkNQt1YtEJ5EeN7xpY4yuPS3f/zHYyQZSe8vWibIwYn1Li9KjpIiNVUtdussabA==,iv:rpYGqaQ6KPcslHEqlYGwiafvddx4lcESaAEbKm1ljdU=,tag:7juyJkRd6dNsSlWdthIc4Q==,type:str]
    key: ""
  discovery:
    enabled: true
    registries:
      kubernetes:
        disabled: true
      service: {}
sops:
  kms: []
  gcp_kms: []
  azure_kv: []
  hc_vault: []
  age:
    - recipient: age1jwm8ccjgfy04r9rwh65rehk72j6rkawkpjnf4rcu4ukwlcfyquhq4p2q23
      enc: |
        -----BEGIN AGE ENCRYPTED FILE-----
        YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSA3M0dJYnFRaW5DdjdtbHYv
        UVFFQ2gwdzNLRm5tZXhQOEMybGxzVWJLNVEwCnhMSkoxaE1VVFl1YzRDMi9KM2JZ
        dDl2M1RSWVV0QzN2NUpKWFRzaG9JQkEKLS0tIC9lcUx1cldpR2twKzFvTm16MUpO
        eTRrS0dvSlNPSnU4TkdkUjBkVmJwdzgKto+KjWdqQc3LhC+fsnqayfjOQr+VW5Kp
        B1dA715p/JM08KC3qmZd5WLkeAy8Chk0Jjz1dY6wtx5jXByHjANrgw==
        -----END AGE ENCRYPTED FILE-----
  lastmodified: "2025-03-12T20:27:18Z"
  mac: ENC[AES256_GCM,data:/IaUzyVOJdG3ek8nJffIlZlD8xUweduRKJPBI1SVQwkDoY2QzQfZxUxx68lTVPt/BlP8iTZ17Rg5FUiQGO6t+87KOr5ZGBTHzOLrmPJGC3FsOgezQCp36Fpo3XEkwvtxNkfzq0v219oc5dQ/1ZbaS9PGSSmKmLJAlXmw44my+Lk=,iv:JBI6ww4MN01bS3dtojVkg5AOVwptAgew64RI3ZDyHHE=,tag:9k4kHhknTZ7PurioWvieSw==,type:str]
  pgp: []
  encrypted_regex: ^(token|crt|key|id|secret|secretboxEncryptionSecret|ca)$
  mac_only_encrypted: true
  version: 3.9.4
